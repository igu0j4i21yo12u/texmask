<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TexMask</title>
    <script type="module" src="./assets/index.js"></script>
    <link rel="stylesheet" href="./assets/index.css">
  </head>
  <body>
    <div class="page">
      <header class="masthead">
        <p class="eyebrow" id="brandEyebrow">ブラウザで楽々マスキング！</p>
        <h1 id="brandTitle">TexMask</h1>
        <p class="lede" id="brandLede">
          貼り付けたテキストを、ブラウザ内だけでマスキングします。<br />
          住所辞書の更新以外では外部との通信は行わないしくみなので、ローカルにダウンロードすればインターネット環境がなくても動作します。<br />
          セットアップ方法はGitHubをご確認ください。
        </p>
        <div class="brand-links">
          <p class="brand-links__title">以下のリンクから取得可能です。</p>
          <a id="repoLink" href="" target="_blank" rel="noopener" hidden>GitHubから取得</a>
          <a id="zipLink" href="" target="_blank" rel="noopener" hidden>ZIPでダウンロード</a>
        </div>
      </header>

      <div class="tabs" role="tablist" aria-label="表示タブ">
        <button class="tab is-active" type="button" data-tab="work" role="tab" aria-selected="true">
          マスク
        </button>
<button class="tab" type="button" data-tab="settings" role="tab" aria-selected="false">
          基本設定
        </button>
        <button class="tab" type="button" data-tab="dictionary" role="tab" aria-selected="false">
          任意辞書
        </button>
        <button class="tab" type="button" data-tab="text-dictionary" role="tab" aria-selected="false">
          テキスト辞書
        </button>
        <button class="tab" type="button" data-tab="address" role="tab" aria-selected="false">
          住所辞書
        </button>
      </div>

      <main class="grid">
        <section class="panel input tab-panel is-active" data-tab-panel="work" role="tabpanel">
          <div class="panel-header">
            <h2>マスクなし</h2>
            <div class="actions">
              <label class="inline">
                <span class="sr-only">サンプル</span>
                <select id="sampleSelect">
                  <option value="">サンプルを選択</option>
                  <option value="address">住所例</option>
                  <option value="config">設定サンプル</option>
                  <option value="support">サポート例</option>
                </select>
              </label>
              <button id="clearBtn" class="ghost" type="button">クリア</button>
            </div>
          </div>
          <textarea
            id="inputText"
            wrap="off"
            placeholder="・ここにマスクなしのテキストを入力します。&#10;・ルールや辞書は[設定]、[任意辞書]、[住所辞書]で調整できます。"
          ></textarea>
          <div class="panel-actions">
            <div class="panel-action-row">
              <span class="panel-action-label">テキスト</span>
              <button id="savePlainTextBtn" class="primary small" type="button">ダウンロード</button>
              <button id="plainTextUploadBtn" class="ghost small" type="button">アップロード</button>
            </div>
            <input id="plainTextFile" type="file" accept=".txt,text/plain" hidden />
          </div>
        </section>

        <section class="panel transfer-panel tab-panel is-active" data-tab-panel="work" role="region">
          <h2>変換</h2>
          <div class="transfer-actions">
            <button id="maskForwardBtn" class="primary" type="button">マスク &gt;&gt;</button>
            <button id="unmaskBackwardBtn" class="ghost" type="button">&lt;&lt; マスク解除</button>
          </div>
        </section>

        <section class="panel output tab-panel is-active" data-tab-panel="work" role="tabpanel">
          <div class="panel-header">
            <h2>マスクあり</h2>
            <div class="actions">
              <button id="copyBtn" class="ghost" type="button">コピー</button>
            </div>
          </div>
          <textarea id="outputText" wrap="off" placeholder="・ここにマスク済みのテキストが表示されます。"></textarea>
          <div class="panel-actions">
            <div class="panel-action-row">
              <span class="panel-action-label">テキスト</span>
              <button id="saveMaskedTextBtn" class="primary small" type="button">ダウンロード</button>
              <button id="maskedTextUploadBtn" class="ghost small" type="button">アップロード</button>
            </div>
            <div class="panel-action-row">
              <span class="panel-action-label">マスク解除辞書</span>
              <button id="downloadDictBtn" class="primary small" type="button">ダウンロード</button>
              <button id="unmaskDictUploadBtn" class="ghost small" type="button">アップロード</button>
              <span id="unmaskDictStatus" class="panel-action-note">key: (なし)</span>
            </div>
            <input id="unmaskTextFile" type="file" accept=".txt,text/plain" hidden />
            <input id="unmaskDictFile" type="file" accept=".json,application/json" hidden />
          </div>
        </section>

        <section class="panel stats-panel output-settings tab-panel is-active" data-tab-panel="work" role="region">
          <h2>設定</h2>
          <div class="output-settings-row" id="outputSettingsRow">
            <div class="setting-row">
              <span class="setting-title">ランダムセッションID設定</span>
              <div class="setting-content">
                <div class="setting-controls">
                  <label class="toggle">
                    <input id="useRandomSessionId" type="checkbox" checked />
                    使う
                  </label>
                  <button id="regenSessionId" class="ghost small" type="button">再生成</button>
                </div>
              </div>
            </div>
          </div>
        </section>

<aside class="panel settings tab-panel" data-tab-panel="settings" role="tabpanel">
          <h2>基本設定</h2>
          <p class="lede">
            代表的な文字列について、マスキングするかどうかを選択できます。<br />
            ここで使う判定は目安レベルなので、例えばIPv4アドレスは「500.999.0.1」のような値も検出されます。
          </p>

          <div class="setting-group">
            <div class="group-header">
              <span>ルール</span>
              <div class="inline">
                <button id="toggleAllBtn" class="ghost small" type="button">全部ON/OFF</button>
                <button id="resetOrderBtn" class="ghost small" type="button">推奨順に戻す</button>
              </div>
            </div>
            <div id="ruleList" class="rule-list"></div>
          </div>

        </aside>

        <aside class="panel settings tab-panel" data-tab-panel="dictionary" role="tabpanel">
          <h2>任意辞書</h2>
          <p class="lede">
            ここでは独自のルールを1行ずつ追加できます。<br />
            各行で有効/無効、置換時の接頭子、方式、対象文字列、正規表現の扱いを設定します。
          </p>
          <div class="setting-group">
            <span>辞書(任意)</span>
            <div class="dict-table">
              <div class="dict-header">
                <span>有効</span>
                <span>置換時の接頭子</span>
                <span>対象文字列</span>
                <span>正規表現</span>
                <span>削除</span>
              </div>
              <div id="dictRows" class="dict-rows"></div>
            <div class="dict-actions">
              <button id="dictAddRow" class="ghost small" type="button">行を追加</button>
            </div>
            <div id="dictTableStatus" class="dict-status"></div>
          </div>
            <div class="inline">
              <label for="dictDefaultPrefix">置換時のデフォルト接頭子</label>
              <input id="dictDefaultPrefix" type="text" value="DICT" placeholder="例: NAME" />
            </div>
            <div class="dict-advanced">
              <div class="dict-advanced-header">上級者向け機能</div>
              <div class="dict-actions">
                <button id="dictImportBasic" class="ghost small" type="button">基本設定を転記</button>
              </div>
            </div>
          </div>
        </aside>

        <aside class="panel settings tab-panel" data-tab-panel="text-dictionary" role="tabpanel">
          <h2>テキスト辞書</h2>
          <p class="lede">
            大量のデータを一括マスキングできます。<br />
            - TXT形式: 1行1エントリ<br />
            - CSV形式: 値,ラベル名
          </p>

          <div class="setting-group">
            <button id="textDictAddBtn" class="primary" type="button">辞書の追加</button>

            <!-- インライン展開フォーム -->
            <div id="textDictForm" class="text-dict-form" hidden>
              <h3 id="textDictFormTitle">辞書の追加</h3>

              <div class="form-row">
                <label>登録方法:</label>
                <div class="radio-group">
                  <label>
                    <input type="radio" name="textDictInputMode" value="textarea" checked />
                    テキストエリア入力
                  </label>
                  <label>
                    <input type="radio" name="textDictInputMode" value="file" />
                    ファイルから登録
                  </label>
                </div>
              </div>

              <div id="textDictFileFormatRow" class="form-row" hidden>
                <label>ファイル形式*:</label>
                <div class="radio-group">
                  <label>
                    <input type="radio" name="textDictFileFormat" value="txt" checked />
                    TXT (1行1エントリ)
                  </label>
                  <label>
                    <input type="radio" name="textDictFileFormat" value="csv" />
                    CSV (値,ラベル名)
                  </label>
                </div>
              </div>

              <div id="textDictFileRow" class="form-row" hidden>
                <label for="textDictFileInput">ファイル:</label>
                <input type="file" id="textDictFileInput" accept=".txt,.csv,text/plain,text/csv" />
              </div>

              <div class="form-row">
                <label for="textDictLabel">ラベル名*:</label>
                <input type="text" id="textDictLabel" placeholder="例: IPv4" />
              </div>

              <div class="form-row">
                <label for="textDictPriority">優先度:</label>
                <select id="textDictPriority">
                  <option value="1">1 (High)</option>
                  <option value="2">2</option>
                  <option value="3" selected>3 (Mid)</option>
                  <option value="4">4</option>
                  <option value="5">5 (Low)</option>
                </select>
              </div>

              <div id="textDictTextareaRow" class="form-row">
                <label for="textDictContent">内容（1行1レコード）*:</label>
                <textarea id="textDictContent" rows="10" placeholder="192.168.1.1
192.168.1.2
100,000円
..."></textarea>
              </div>

              <div class="form-notice">
                <strong>⚠️ 注意:</strong><br />
                最大10万件まで登録可能です。<br />
                環境によってはブラウザのパフォーマンスに影響を与える可能性があります。<br />
                フリーズする場合は分割や外部エディタ編集を推奨します。
              </div>

              <div class="form-actions">
                <button id="textDictCancelBtn" class="ghost" type="button">キャンセル</button>
                <button id="textDictSubmitBtn" class="primary" type="button">登録</button>
              </div>
            </div>
          </div>

          <div class="setting-group">
            <span>登録済み辞書一覧</span>
            <div id="textDictList" class="text-dict-list">
              <!-- 動的に生成 -->
            </div>
            <p id="textDictListEmpty" class="dict-status">登録された辞書はありません</p>
          </div>
        </aside>

        <aside class="panel settings tab-panel" data-tab-panel="address" role="tabpanel">
          <h2>住所辞書</h2>
          <p class="lede">
            住所（都道府県・市区町村）を自動検出してマスキングします。<br />
            データは<a href="https://geolonia.github.io/japanese-addresses/" target="_blank" rel="noopener">Geolonia 住所データ</a>（CC BY 4.0）を使用し、都道府県+市区町村の辞書に加工しています。
          </p>

          <div class="setting-group">
            <label class="toggle">
              <input id="useAddressDict" type="checkbox" checked />
              住所辞書を使用する
            </label>
            <label class="toggle">
              <input id="useAddressBlock" type="checkbox" checked />
              住所ブロック（番地まで）をマスクする
            </label>

            <div class="address-dict-info">
              <div class="info-row">
                <span class="info-label">現在のバージョン:</span>
                <strong id="addressDictVersion">読み込み中...</strong>
              </div>
              <div class="info-row">
                <span class="info-label">データソース:</span>
                <span id="addressDictSource">ローカル同梱</span>
              </div>
              <div class="info-row">
                <span class="info-label">データ件数:</span>
                <span id="addressDictCount">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">最終更新:</span>
                <span id="addressDictUpdated">-</span>
              </div>
              <div class="info-row">
                <span class="info-label">町丁目辞書:</span>
                <span id="addressTownDictStatus">読み込み中...</span>
              </div>
            </div>

            <div class="inline">
              <button id="updateAddressDict" class="ghost small" type="button">最新版に更新</button>
              <button id="resetAddressDict" class="ghost small" type="button">初期版に戻す</button>
            </div>

            <p class="dict-status">※ 更新にはインターネット接続が必要です。更新データはブラウザに保存されます。</p>
          </div>
          <div class="setting-group">
            <span>都道府県フィルタ</span>
            <div class="inline address-pref-controls">
              <button id="addressPrefAll" class="ghost small" type="button">全部ON</button>
              <button id="addressPrefNone" class="ghost small" type="button">全部OFF</button>
            </div>
            <div id="addressPrefectureList" class="address-prefecture-list"></div>
            <p class="dict-status">※初期状態はすべてONです。</p>
          </div>

          <div class="setting-group">
            <span>住所検索</span>
            <div class="address-search">
              <input id="addressSearchInput" type="text" placeholder="例: 千代田" />
              <div id="addressSearchResults" class="address-preview" aria-live="polite"></div>
              <p class="dict-status">※部分一致で最大50件を表示</p>
            </div>
          </div>
        </aside>
      </main>
    </div>
    <div class="app-stats" id="appStats" aria-live="polite">
      <div id="stats" class="stats"></div>
    </div>

    <div id="presetDock" class="floating-preset" aria-label="マイ設定">
      <button
        id="presetToggle"
        class="floating-preset-toggle"
        type="button"
        aria-expanded="false"
      >
        マイ設定
        <span class="floating-handle" aria-hidden="true">⋮⋮</span>
      </button>
      <div id="presetPanel" class="floating-preset-panel" aria-hidden="true">
        <div class="floating-preset-header">
          <strong>マイ設定</strong>
          <button id="presetClose" class="ghost small" type="button">閉じる</button>
        </div>
        <div class="floating-preset-body">
          <div class="inline">
            <select id="presetSelect">
              <option value="">保存した設定を選択</option>
            </select>
            <button id="presetLoad" class="ghost small" type="button">保存した設定を呼び出す</button>
            <button id="presetDelete" class="ghost small" type="button">削除</button>
          </div>
          <div class="inline">
            <input id="presetName" type="text" placeholder="設定名(ex. configマスク用設定)" />
            <button id="presetSave" class="ghost small" type="button">現在の設定を保存</button>
          </div>
          <div class="inline">
            <button id="presetExport" class="ghost small" type="button">JSONに保存</button>
            <button id="presetImport" class="ghost small" type="button">JSONを読み込み</button>
            <input id="presetImportFile" type="file" accept=".json,application/json" hidden />
          </div>
          <div id="presetStatus" class="preset-status" role="status"></div>
        </div>
      </div>
    </div>
    <footer class="app-footer">
      <span id="footerText">© 2026</span>
      <a id="footerLink" href="" target="_blank" rel="noopener" hidden>TexMask</a>
    </footer>
  </body>
</html>
