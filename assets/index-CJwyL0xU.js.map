{"version":3,"file":"index-CJwyL0xU.js","sources":["../../src/modules/ui.js","../../src/brand-configs/personal.js","../../src/modules/brand.js","../../src/modules/constants.js","../../src/modules/state.js","../../src/modules/io.js","../../src/modules/unmask.js","../../src/modules/samples.js","../../src/modules/rules.js","../../src/modules/dictionary.js","../../src/modules/address.js","../../src/modules/preset.js","../../patterns.js","../../src/modules/masking.js","../../src/main.js"],"sourcesContent":["/**\n * UI Module - DOM要素の参照とUI操作\n */\n\n// DOM要素の参照\nexport const ui = {\n  inputText: document.getElementById(\"inputText\"),\n  outputText: document.getElementById(\"outputText\"),\n  maskForwardBtn: document.getElementById(\"maskForwardBtn\"),\n  unmaskBackwardBtn: document.getElementById(\"unmaskBackwardBtn\"),\n  savePlainTextBtn: document.getElementById(\"savePlainTextBtn\"),\n  plainTextUploadBtn: document.getElementById(\"plainTextUploadBtn\"),\n  plainTextFile: document.getElementById(\"plainTextFile\"),\n  maskedTextUploadBtn: document.getElementById(\"maskedTextUploadBtn\"),\n  unmaskDictUploadBtn: document.getElementById(\"unmaskDictUploadBtn\"),\n  unmaskDictStatus: document.getElementById(\"unmaskDictStatus\"),\n  copyBtn: document.getElementById(\"copyBtn\"),\n  clearBtn: document.getElementById(\"clearBtn\"),\n  sampleSelect: document.getElementById(\"sampleSelect\"),\n  numberWidthRow: document.getElementById(\"numberWidthRow\"),\n  numberWidth: document.getElementById(\"numberWidth\"),\n  useRandomSessionId: document.getElementById(\"useRandomSessionId\"),\n  regenSessionId: document.getElementById(\"regenSessionId\"),\n  dictDefaultPrefix: document.getElementById(\"dictDefaultPrefix\"),\n  dictRows: document.getElementById(\"dictRows\"),\n  dictAddRow: document.getElementById(\"dictAddRow\"),\n  dictImportBasic: document.getElementById(\"dictImportBasic\"),\n  dictTableStatus: document.getElementById(\"dictTableStatus\"),\n  ruleList: document.getElementById(\"ruleList\"),\n  toggleAllBtn: document.getElementById(\"toggleAllBtn\"),\n  resetOrderBtn: document.getElementById(\"resetOrderBtn\"),\n  presetSelect: document.getElementById(\"presetSelect\"),\n  presetLoad: document.getElementById(\"presetLoad\"),\n  presetDelete: document.getElementById(\"presetDelete\"),\n  presetName: document.getElementById(\"presetName\"),\n  presetSave: document.getElementById(\"presetSave\"),\n  presetDock: document.getElementById(\"presetDock\"),\n  presetToggle: document.getElementById(\"presetToggle\"),\n  presetPanel: document.getElementById(\"presetPanel\"),\n  presetClose: document.getElementById(\"presetClose\"),\n  presetExport: document.getElementById(\"presetExport\"),\n  presetImport: document.getElementById(\"presetImport\"),\n  presetImportFile: document.getElementById(\"presetImportFile\"),\n  presetStatus: document.getElementById(\"presetStatus\"),\n  stats: document.getElementById(\"stats\"),\n  appStats: document.getElementById(\"appStats\"),\n  saveMaskedTextBtn: document.getElementById(\"saveMaskedTextBtn\"),\n  tabs: document.querySelectorAll(\".tab\"),\n  tabPanels: document.querySelectorAll(\".tab-panel\"),\n  useAddressDict: document.getElementById(\"useAddressDict\"),\n  addressDictVersion: document.getElementById(\"addressDictVersion\"),\n  addressDictSource: document.getElementById(\"addressDictSource\"),\n  addressDictCount: document.getElementById(\"addressDictCount\"),\n  addressDictUpdated: document.getElementById(\"addressDictUpdated\"),\n  addressTownDictStatus: document.getElementById(\"addressTownDictStatus\"),\n  addressPrefectureList: document.getElementById(\"addressPrefectureList\"),\n  addressPrefAll: document.getElementById(\"addressPrefAll\"),\n  addressPrefNone: document.getElementById(\"addressPrefNone\"),\n  addressSearchInput: document.getElementById(\"addressSearchInput\"),\n  addressSearchResults: document.getElementById(\"addressSearchResults\"),\n  updateAddressDict: document.getElementById(\"updateAddressDict\"),\n  resetAddressDict: document.getElementById(\"resetAddressDict\"),\n  downloadDictBtn: document.getElementById(\"downloadDictBtn\"),\n  unmaskTextFile: document.getElementById(\"unmaskTextFile\"),\n  unmaskTextDrop: document.getElementById(\"unmaskTextDrop\"),\n  unmaskDictFile: document.getElementById(\"unmaskDictFile\"),\n  unmaskDictDrop: document.getElementById(\"unmaskDictDrop\"),\n  unmaskStats: document.getElementById(\"unmaskStats\"),\n};\n\n// UI操作関数\nexport function updateStatusDisplay(message, isError = false) {\n  ui.stats.textContent = message;\n  ui.stats.classList.toggle(\"error\", isError);\n}\n\nexport function updateDictTableStatusDisplay(message) {\n  if (!ui.dictTableStatus) {\n    return;\n  }\n  ui.dictTableStatus.textContent = message || \"\";\n}\n\nexport function updatePresetStatusDisplay(message, isError = false) {\n  if (!ui.presetStatus) {\n    return;\n  }\n  ui.presetStatus.textContent = message || \"\";\n  ui.presetStatus.classList.toggle(\"error\", isError);\n}\n","export const brandConfig = {\n  productName: \"TexMask\",\n  pageTitle: \"TexMask - ブラウザで楽々マスキング！\",\n  logoText: \"TexMask\",\n  eyebrow: \"ブラウザで楽々マスキング！\",\n  ledeLines: [\n    \"AIに秘匿情報を送ったりしていませんか？\",\n    \"このツールで秘匿化してから送ったほうが安心ですよ！\",\n    \"外部へのデータ送信は行っておりませんので、ローカルにダウンロードしたりインターネット接続がなくても動作します。\",\n  ],\n  demoUrl: \"https://igu0j4i21yo12u.github.io/texmask/\",\n  demoLabel: \"デモサイト\",\n  repoUrl: \"https://github.com/igu0j4i21yo12u/texmask\",\n  repoLabel: \"GitHub\",\n  footerText: \"@igu0j4i21yo12u\",\n  footerLinkUrl: \"https://x.com/igu0j4i21yo12u\",\n  footerLinkLabel: \"@igu0j4i21yo12u\",\n};\n","/**\n * Brand Module - ブランド適用ロジック\n */\n\nimport { brandConfig } from \"@brand-config\";\n\n/**\n * 現在のブランド設定を取得\n * @returns {Object} ブランド設定\n */\nexport function getBrandConfig() {\n  return brandConfig || {};\n}\n\n/**\n * ファイル名のベース名を取得（ダウンロード時に使用）\n * @returns {string} プロダクト名\n */\nexport function getAppFilenameBase() {\n  const config = getBrandConfig();\n  return config.productName || \"TexMask\";\n}\n\n/**\n * DOM要素にテキストを設定\n * @param {string} id - 要素ID\n * @param {string} value - 設定する値\n */\nfunction setText(id, value) {\n  if (!value) {\n    return;\n  }\n  const el = document.getElementById(id);\n  if (el) {\n    el.textContent = value;\n  }\n}\n\n/**\n * リンク要素を設定\n * @param {string} id - 要素ID\n * @param {string} url - リンクURL\n * @param {string} label - リンクラベル\n */\nfunction setLink(id, url, label) {\n  const el = document.getElementById(id);\n  if (!el) {\n    return;\n  }\n  if (!url) {\n    el.hidden = true;\n    return;\n  }\n  el.href = url;\n  if (label) {\n    el.textContent = label;\n  }\n  el.hidden = false;\n}\n\n/**\n * ブランド設定をDOMに適用\n */\nexport function applyBrandConfig() {\n  const config = getBrandConfig();\n\n  // ページタイトル\n  document.title = config.pageTitle || config.productName || document.title;\n\n  // ヘッダー\n  setText(\"brandTitle\", config.logoText || config.productName);\n  setText(\"brandEyebrow\", config.eyebrow);\n\n  // リード文\n  const lede = document.getElementById(\"brandLede\");\n  if (lede && Array.isArray(config.ledeLines)) {\n    lede.textContent = config.ledeLines.join(\"\\n\");\n  }\n\n  // リンク\n  setLink(\"demoLink\", config.demoUrl, config.demoLabel || \"デモサイト\");\n  setLink(\"repoLink\", config.repoUrl, config.repoLabel || \"GitHub\");\n\n  // フッター\n  setText(\"footerText\", config.footerText);\n  setLink(\"footerLink\", config.footerLinkUrl, config.footerLinkLabel);\n}\n","/**\n * Constants Module - 定数定義\n */\n\n// Storage Keys\nexport const STORAGE_KEY = \"masking-web-state-v1\";\nexport const PRESET_KEY = \"masking-web-presets-v1\";\nexport const ADDRESS_DICT_CUSTOM_KEY = \"masking-web-address-dict-custom-v1\";\nexport const HMAC_KEY_STORAGE = \"masking-web-hmac-key-v1\";\nexport const ADDRESS_PREF_SELECTION_KEY = \"masking-web-address-pref-selection-v1\";\n\n// URLs\nexport const ADDRESS_DICT_LOCAL_URL = \"address-dict.json\";\nexport const ADDRESS_TOWN_DICT_URL = \"address-town-dict.json\";\nexport const GEOLONIA_API_URL = \"https://geolonia.github.io/japanese-addresses/api/ja.json\";\n\n// Timing\nexport const MASK_DELAY_MS = 180;\nexport const ASYNC_MASK_THRESHOLD = 20000;\nexport const COPY_FEEDBACK_DURATION_MS = 1200;\n\n// Configuration\nexport const SESSION_ID_LENGTH = 4;\nexport const ADDRESS_PATTERN_CHUNK_SIZE = 2000;\nexport const ADDRESS_SEARCH_LIMIT = 50;\nexport const DICT_IMPORT_BACKUP_PREFIX = \"転記前バックアップ\";\n\n// Address Prefectures\nexport const ADDRESS_PREFECTURES = [\n  \"北海道\",\n  \"青森県\",\n  \"岩手県\",\n  \"宮城県\",\n  \"秋田県\",\n  \"山形県\",\n  \"福島県\",\n  \"茨城県\",\n  \"栃木県\",\n  \"群馬県\",\n  \"埼玉県\",\n  \"千葉県\",\n  \"東京都\",\n  \"神奈川県\",\n  \"新潟県\",\n  \"富山県\",\n  \"石川県\",\n  \"福井県\",\n  \"山梨県\",\n  \"長野県\",\n  \"岐阜県\",\n  \"静岡県\",\n  \"愛知県\",\n  \"三重県\",\n  \"滋賀県\",\n  \"京都府\",\n  \"大阪府\",\n  \"兵庫県\",\n  \"奈良県\",\n  \"和歌山県\",\n  \"鳥取県\",\n  \"島根県\",\n  \"岡山県\",\n  \"広島県\",\n  \"山口県\",\n  \"徳島県\",\n  \"香川県\",\n  \"愛媛県\",\n  \"高知県\",\n  \"福岡県\",\n  \"佐賀県\",\n  \"長崎県\",\n  \"熊本県\",\n  \"大分県\",\n  \"宮崎県\",\n  \"鹿児島県\",\n  \"沖縄県\",\n];\n\nexport const ADDRESS_PREFECTURES_SORTED = [...ADDRESS_PREFECTURES].sort(\n  (left, right) => right.length - left.length\n);\n","/**\n * State Module - 状態管理\n */\n\nimport { ui } from \"./ui.js\";\nimport { STORAGE_KEY } from \"./constants.js\";\n\n// グローバル変数 (export let で他モジュールから参照・更新可能)\nexport let addressPatterns = null; // 住所パターンのキャッシュ\nexport let addressPatternChunks = [];\nexport let addressCityPatterns = null;\nexport let addressCityPatternsByPref = new Map();\nexport let addressTownPatternsByPref = null;\nexport let addressTownPrefectures = null;\nexport let addressDictLoadPromise = null;\nexport let addressTownDictLoadPromise = null;\nexport let addressSelectedPrefs = null;\nexport let currentSessionId = null; // 現在のセッションID\nexport let currentMaskDictionary = null; // 現在のマスク辞書\nexport let currentUnmaskDictionary = null; // 復号用辞書\nexport let maskRunId = 0;\n\n// 状態オブジェクト (初期値は空配列、baseRules は rules.js で設定される)\nexport const state = {\n  rules: [],\n};\n\n/**\n * 現在の状態をペイロード形式で取得\n * @param {Function} readDictRows - 辞書行を読み取る関数 (dictionary.js から渡される)\n * @returns {Object} 状態ペイロード\n */\nexport function buildStatePayload(readDictRows) {\n  return {\n    inputText: ui.inputText.value,\n    sampleSelect: ui.sampleSelect.value,\n    useRandomSessionId: ui.useRandomSessionId?.checked ?? true,\n    numberWidth: ui.numberWidth.value,\n    dictDefaultPrefix: ui.dictDefaultPrefix.value,\n    dictRows: readDictRows ? readDictRows() : [],\n    rules: state.rules.map((rule) => ({\n      name: rule.name,\n      enabled: rule.enabled,\n    })),\n    rulesOrder: state.rules.map((rule) => rule.name),\n  };\n}\n\n/**\n * ペイロードから状態を復元\n * 注意: この関数は UI フォーム値と state.rules を更新するが、\n * renderDictRows() や renderRules() は呼び出さない(循環依存回避)。\n * 呼び出し側で必要に応じてレンダリング関数を呼ぶこと。\n * @param {Object} payload - 状態ペイロード\n * @param {Array} baseRules - ベースルール配列 (rules.js から渡される)\n * @returns {Object} 復元結果 { dictRowsData, needsRulesRender }\n */\nexport function applyStatePayload(payload, baseRules) {\n  if (!payload || typeof payload !== \"object\") {\n    return { dictRowsData: null, needsRulesRender: false };\n  }\n\n  let dictRowsData = null;\n  let needsRulesRender = false;\n\n  if (typeof payload.inputText === \"string\") {\n    ui.inputText.value = payload.inputText;\n  }\n  if (typeof payload.sampleSelect === \"string\") {\n    ui.sampleSelect.value = payload.sampleSelect;\n  }\n  if (typeof payload.useRandomSessionId === \"boolean\" && ui.useRandomSessionId) {\n    ui.useRandomSessionId.checked = payload.useRandomSessionId;\n  }\n  if (typeof payload.numberWidth === \"string\") {\n    ui.numberWidth.value = payload.numberWidth;\n  }\n  if (typeof payload.dictDefaultPrefix === \"string\") {\n    ui.dictDefaultPrefix.value = payload.dictDefaultPrefix;\n  }\n  if (Array.isArray(payload.dictRows)) {\n    dictRowsData = payload.dictRows; // 呼び出し側で renderDictRows() を呼ぶ\n  }\n  if (Array.isArray(payload.rules) && baseRules) {\n    const enabledMap = new Map(\n      payload.rules.map((rule) => [rule.name, rule.enabled])\n    );\n    state.rules = baseRules.map((rule) => ({\n      ...rule,\n      enabled: enabledMap.has(rule.name) ? enabledMap.get(rule.name) : true,\n    }));\n    needsRulesRender = true;\n  }\n  if (Array.isArray(payload.rulesOrder)) {\n    const orderMap = new Map(\n      payload.rulesOrder.map((name, idx) => [name, idx])\n    );\n    state.rules.sort((a, b) => {\n      const aPos = orderMap.has(a.name)\n        ? orderMap.get(a.name)\n        : Number.MAX_SAFE_INTEGER;\n      const bPos = orderMap.has(b.name)\n        ? orderMap.get(b.name)\n        : Number.MAX_SAFE_INTEGER;\n      return aPos - bPos;\n    });\n  }\n\n  return { dictRowsData, needsRulesRender };\n}\n\n/**\n * プリセット用ペイロード作成 (入力テキストを除外)\n * @param {Function} readDictRows - 辞書行を読み取る関数\n * @returns {Object} プリセットペイロード\n */\nexport function buildPresetPayload(readDictRows) {\n  const payload = buildStatePayload(readDictRows);\n  payload.inputText = \"\";\n  payload.sampleSelect = \"\";\n  return payload;\n}\n\n/**\n * 状態を localStorage に保存\n * @param {Function} readDictRows - 辞書行を読み取る関数\n */\nexport function persistState(readDictRows) {\n  try {\n    const payload = buildStatePayload(readDictRows);\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));\n  } catch (err) {\n    // Ignore storage failures (private mode, disabled storage).\n    console.warn(\"Failed to persist state to localStorage:\", err);\n  }\n}\n\n/**\n * localStorage から状態を復元\n * 注意: この関数は applyStatePayload() を呼び出すが、レンダリングは行わない。\n * @param {Array} baseRules - ベースルール配列\n * @returns {Object} 復元結果 { dictRowsData, needsRulesRender }\n */\nexport function restoreState(baseRules) {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) {\n      return { dictRowsData: null, needsRulesRender: false };\n    }\n    const payload = JSON.parse(raw);\n    return applyStatePayload(payload, baseRules);\n  } catch (err) {\n    // Ignore parse/storage failures.\n    console.warn(\"Failed to restore state from localStorage:\", err);\n    return { dictRowsData: null, needsRulesRender: false };\n  }\n}\n\n// グローバル変数の更新用ヘルパー (他モジュールから import * as state を使って更新)\nexport function setAddressPatterns(value) {\n  addressPatterns = value;\n}\n\nexport function setAddressPatternChunks(value) {\n  addressPatternChunks = value;\n}\n\nexport function setAddressCityPatterns(value) {\n  addressCityPatterns = value;\n}\n\nexport function setAddressCityPatternsByPref(value) {\n  addressCityPatternsByPref = value;\n}\n\nexport function setAddressTownPatternsByPref(value) {\n  addressTownPatternsByPref = value;\n}\n\nexport function setAddressTownPrefectures(value) {\n  addressTownPrefectures = value;\n}\n\nexport function setAddressDictLoadPromise(value) {\n  addressDictLoadPromise = value;\n}\n\nexport function setAddressTownDictLoadPromise(value) {\n  addressTownDictLoadPromise = value;\n}\n\nexport function setAddressSelectedPrefs(value) {\n  addressSelectedPrefs = value;\n}\n\nexport function setCurrentSessionId(value) {\n  currentSessionId = value;\n}\n\nexport function setCurrentMaskDictionary(value) {\n  currentMaskDictionary = value;\n}\n\nexport function setCurrentUnmaskDictionary(value) {\n  currentUnmaskDictionary = value;\n}\n\nexport function incrementMaskRunId() {\n  maskRunId++;\n  return maskRunId;\n}\n","/**\n * IO Module - ファイル入出力とクリップボード操作\n */\n\nimport { ui, updateStatusDisplay } from \"./ui.js\";\nimport { state, persistState, applyStatePayload, buildPresetPayload } from \"./state.js\";\nimport { COPY_FEEDBACK_DURATION_MS } from \"./constants.js\";\nimport { getAppFilenameBase } from \"./brand.js\";\n\n/**\n * ファイル名をサニタイズ\n * @param {string} name - 元のファイル名\n * @returns {string} サニタイズされたファイル名\n */\nexport function sanitizeFileName(name) {\n  return name.replace(/[\\\\/:*?\"<>|]/g, \"_\").trim() || \"config\";\n}\n\n/**\n * ファイル名用タイムスタンプをフォーマット\n * @param {Date} date - 日付オブジェクト\n * @returns {string} YYYYmmdd-HHMM 形式のタイムスタンプ\n */\nexport function formatTimestampForFilename(date) {\n  const pad = (value) => String(value).padStart(2, \"0\");\n  return `${date.getFullYear()}${pad(date.getMonth() + 1)}${pad(\n    date.getDate()\n  )}-${pad(date.getHours())}${pad(date.getMinutes())}`;\n}\n\n/**\n * マスク後のテキストをファイルに保存\n */\nexport function saveMaskedOutput() {\n  const value = ui.outputText.value;\n  if (!value) {\n    updateStatusDisplay(\"保存するテキストがありません。\", true);\n    return;\n  }\n  const timestamp = formatTimestampForFilename(new Date());\n  const baseName = getAppFilenameBase();\n  const blob = new Blob([value], { type: \"text/plain\" });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = url;\n  link.download = `${baseName}_${timestamp}_masked.txt`;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n  updateStatusDisplay(\"マスク後テキストを保存しました。\");\n}\n\n/**\n * マスク前のテキストをファイルに保存\n */\nexport function savePlainOutput() {\n  const value = ui.inputText.value;\n  if (!value) {\n    updateStatusDisplay(\"保存するテキストがありません。\", true);\n    return;\n  }\n  const timestamp = formatTimestampForFilename(new Date());\n  const baseName = getAppFilenameBase();\n  const blob = new Blob([value], { type: \"text/plain\" });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = url;\n  link.download = `${baseName}_${timestamp}_plain.txt`;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n  updateStatusDisplay(\"テキストを保存しました。\");\n}\n\n/**\n * プレーンテキストファイルを読み込み\n * @param {File} file - ファイルオブジェクト\n * @param {Function} readDictRows - 辞書行読み取り関数\n */\nexport function loadPlainTextFile(file, readDictRows) {\n  if (!file) {\n    return;\n  }\n  const reader = new FileReader();\n  reader.onload = () => {\n    const content = typeof reader.result === \"string\" ? reader.result : \"\";\n    ui.inputText.value = content;\n    persistState(readDictRows);\n  };\n  reader.onerror = () => {\n    updateStatusDisplay(\"ファイルの読み込みに失敗しました。\", true);\n  };\n  reader.readAsText(file, \"utf-8\");\n}\n\n/**\n * インポートされたペイロードをパース\n * @param {Object} raw - インポートされたデータ\n * @returns {Object|null} { name, payload } または null\n */\nexport function parseImportedPayload(raw) {\n  if (!raw || typeof raw !== \"object\") {\n    return null;\n  }\n  if (raw.payload && typeof raw.payload === \"object\") {\n    return { name: raw.name || \"\", payload: raw.payload };\n  }\n  return { name: raw.name || \"\", payload: raw };\n}\n\n/**\n * プリセットをJSONファイルにエクスポート\n * @param {Function} resolveExportName - エクスポート名を解決する関数\n * @param {Function} readDictRows - 辞書行読み取り関数\n */\nexport function exportPresetToFile(resolveExportName, readDictRows) {\n  const name = resolveExportName();\n  if (!name) {\n    updateStatusDisplay(\"設定名を入力してください。\", true);\n    return;\n  }\n\n  const payload = buildPresetPayload(readDictRows);\n  const exportPayload = {\n    name,\n    exportedAt: new Date().toISOString(),\n    payload,\n  };\n  const blob = new Blob([JSON.stringify(exportPayload, null, 2)], {\n    type: \"application/json\",\n  });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = url;\n  link.download = `${sanitizeFileName(name)}.json`;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n  updateStatusDisplay(`設定「${name}」をJSONに保存しました。`);\n}\n\n/**\n * JSONファイルからプリセットをインポート\n * @param {File} file - ファイルオブジェクト\n * @param {Array} baseRules - ベースルール配列\n * @param {Function} renderRules - ルール描画関数\n * @param {Function} renderDictRows - 辞書行描画関数\n * @param {Function} readDictRows - 辞書行読み取り関数\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function importPresetFromFile(\n  file,\n  baseRules,\n  renderRules,\n  renderDictRows,\n  readDictRows,\n  scheduleMask\n) {\n  if (!file) {\n    return;\n  }\n  const reader = new FileReader();\n  reader.onload = () => {\n    try {\n      const data = JSON.parse(reader.result);\n      const parsed = parseImportedPayload(data);\n      if (!parsed || !parsed.payload) {\n        throw new Error(\"invalid payload\");\n      }\n\n      const result = applyStatePayload(parsed.payload, baseRules);\n\n      // 辞書行を復元\n      if (result.dictRowsData && renderDictRows) {\n        renderDictRows(result.dictRowsData, scheduleMask);\n      }\n\n      // ルールを再描画\n      if (result.needsRulesRender && renderRules) {\n        renderRules(readDictRows, scheduleMask);\n      }\n\n      persistState(readDictRows);\n      if (scheduleMask) scheduleMask();\n\n      if (parsed.name) {\n        ui.presetName.value = parsed.name;\n      } else {\n        ui.presetName.value = \"\";\n      }\n      updateStatusDisplay(\"JSON設定を読み込みました。\");\n    } catch (err) {\n      updateStatusDisplay(\"JSONの読み込みに失敗しました。\", true);\n    } finally {\n      ui.presetImportFile.value = \"\";\n    }\n  };\n  reader.onerror = () => {\n    updateStatusDisplay(\"JSONの読み込みに失敗しました。\", true);\n    ui.presetImportFile.value = \"\";\n  };\n  reader.readAsText(file, \"utf-8\");\n}\n\n/**\n * 出力テキストをクリップボードにコピー\n */\nexport async function copyOutput() {\n  const value = ui.outputText.value;\n  if (!value) {\n    return;\n  }\n  try {\n    await navigator.clipboard.writeText(value);\n    ui.copyBtn.textContent = \"コピー済み\";\n    setTimeout(() => {\n      ui.copyBtn.textContent = \"コピー\";\n    }, COPY_FEEDBACK_DURATION_MS);\n  } catch (err) {\n    console.warn(\"Failed to copy to clipboard:\", err);\n    ui.copyBtn.textContent = \"失敗\";\n    setTimeout(() => {\n      ui.copyBtn.textContent = \"コピー\";\n    }, COPY_FEEDBACK_DURATION_MS);\n  }\n}\n","/**\n * Unmask Module - マスク解除機能\n */\n\nimport { ui, updateStatusDisplay } from \"./ui.js\";\nimport * as stateVars from \"./state.js\";\nimport { setCurrentUnmaskDictionary } from \"./state.js\";\nimport { getAppFilenameBase } from \"./brand.js\";\nimport { formatTimestampForFilename } from \"./io.js\";\n\n/**\n * 辞書をJSONファイルとしてダウンロード\n */\nasync function downloadDictionary() {\n  if (!stateVars.currentMaskDictionary) {\n    updateStatusDisplay(\"マスク実行後に辞書をダウンロードできます。\", true);\n    return;\n  }\n\n  try {\n    // 署名が未生成の場合は生成\n    if (\n      !stateVars.currentMaskDictionary.signature &&\n      window.MaskingEngine?.computeDictionarySignature\n    ) {\n      const signature = await window.MaskingEngine.computeDictionarySignature(\n        stateVars.currentMaskDictionary\n      );\n      if (signature) {\n        stateVars.currentMaskDictionary.signature = signature;\n        updateUnmaskDictStatus(stateVars.currentMaskDictionary);\n      }\n    }\n\n    const blob = new Blob(\n      [JSON.stringify(stateVars.currentMaskDictionary, null, 2)],\n      { type: \"application/json\" }\n    );\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    const baseName = getAppFilenameBase();\n    link.download = `${baseName}_${formatTimestampForFilename(new Date())}_unmask.json`;\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n\n    updateStatusDisplay(\"辞書をダウンロードしました。\");\n  } catch (err) {\n    updateStatusDisplay(\"辞書のダウンロードに失敗しました。\", true);\n    console.error(\"Dictionary download failed:\", err);\n  }\n}\n\n/**\n * マスク解除元のテキストエリアを取得\n * @returns {HTMLTextAreaElement}\n */\nfunction getUnmaskSource() {\n  return ui.outputText;\n}\n\n/**\n * マスク解除先のテキストエリアを取得\n * @returns {HTMLTextAreaElement}\n */\nfunction getUnmaskTarget() {\n  return ui.inputText;\n}\n\n/**\n * マスク解除処理\n * @param {Object} dictionary - マスク解除辞書\n */\nfunction unmaskText(dictionary) {\n  const source = getUnmaskSource();\n  const target = getUnmaskTarget();\n  if (!source || !target) {\n    return;\n  }\n  const input = source.value || \"\";\n  if (!input.trim()) {\n    target.value = \"\";\n    updateUnmaskStatusDisplay(\"入力テキストが空です。\");\n    return;\n  }\n\n  if (!dictionary || !dictionary.mappings) {\n    target.value = \"\";\n    updateUnmaskStatusDisplay(\"辞書が読み込まれていません。\", true);\n    updateUnmaskDictStatus(null);\n    return;\n  }\n\n  let output = input;\n  const stats = [];\n\n  // マスク解除処理\n  for (const [mask, original] of Object.entries(dictionary.mappings)) {\n    const escapedMask = window.MaskingEngine.escapeRegExp(mask);\n    const regex = new RegExp(escapedMask, \"g\");\n    const matches = output.match(regex);\n    if (matches) {\n      stats.push({ mask, original, count: matches.length });\n      output = output.replace(regex, original);\n    }\n  }\n\n  const totalCount = stats.reduce((sum, s) => sum + s.count, 0);\n\n  target.value = output;\n  updateUnmaskStatusDisplay(`マスク解除件数: ${totalCount}`);\n  updateUnmaskDictStatus(dictionary);\n}\n\n/**\n * マスク解除ステータス表示を更新\n * @param {string} message - メッセージ\n * @param {boolean} isError - エラーかどうか\n */\nfunction updateUnmaskStatusDisplay(message, isError = false) {\n  if (ui.unmaskStats) {\n    ui.unmaskStats.textContent = message;\n    ui.unmaskStats.classList.toggle(\"error\", isError);\n  }\n}\n\n/**\n * マスク解除辞書のステータス表示を更新\n * @param {Object} dict - 辞書オブジェクト\n */\nfunction updateUnmaskDictStatus(dict) {\n  if (!ui.unmaskDictStatus) {\n    return;\n  }\n  if (!dict) {\n    ui.unmaskDictStatus.textContent = \"ID: (なし)\";\n    return;\n  }\n  if (typeof dict.session_id === \"string\" && dict.session_id) {\n    ui.unmaskDictStatus.textContent = `ID: ${dict.session_id}`;\n    return;\n  }\n  const signature = dict.signature;\n  if (typeof signature === \"string\" && signature.length > 0) {\n    const normalized = signature.replace(/^sha256:/, \"\");\n    ui.unmaskDictStatus.textContent = `ID: ${normalized.slice(0, 8)}`;\n    return;\n  }\n  ui.unmaskDictStatus.textContent = \"ID: (なし)\";\n}\n\n/**\n * マスク済みテキストファイルを読み込み\n * @param {File} file - ファイル\n */\nfunction loadUnmaskTextFile(file) {\n  if (!file) {\n    return;\n  }\n  const reader = new FileReader();\n  reader.onload = () => {\n    const content = typeof reader.result === \"string\" ? reader.result : \"\";\n    const source = getUnmaskSource();\n    if (source) {\n      source.value = content;\n    }\n    if (stateVars.currentUnmaskDictionary) {\n      unmaskText(stateVars.currentUnmaskDictionary);\n    }\n  };\n  reader.onerror = () => {\n    updateUnmaskStatusDisplay(\"テキストファイルの読み込みに失敗しました。\", true);\n  };\n  reader.readAsText(file, \"utf-8\");\n}\n\n/**\n * 辞書ファイルを読み込み\n * @param {File} file - ファイル\n */\nasync function loadDictionaryFile(file) {\n  if (!file) {\n    return;\n  }\n\n  const reader = new FileReader();\n  reader.onload = async () => {\n    try {\n      const data = JSON.parse(reader.result);\n\n      // 辞書の基本的な検証\n      if (!data.mappings || typeof data.mappings !== \"object\") {\n        throw new Error(\"辞書フォーマットが不正です\");\n      }\n\n      // 署名の検証\n      if (data.signature) {\n        if (window.MaskingEngine?.computeDictionarySignature) {\n          const computed = await window.MaskingEngine.computeDictionarySignature(\n            data\n          );\n          if (!computed || computed !== data.signature) {\n            throw new Error(\"辞書の署名が一致しません\");\n          }\n        } else {\n          updateUnmaskStatusDisplay(\"署名の検証に対応していません。\", true);\n        }\n      }\n\n      // 辞書を保存して復号実行\n      setCurrentUnmaskDictionary(data);\n      unmaskText(data);\n      updateUnmaskDictStatus(data);\n\n      updateUnmaskStatusDisplay(\"辞書を読み込みました。\");\n    } catch (err) {\n      updateUnmaskStatusDisplay(\"辞書の読み込みに失敗しました。\", true);\n      console.error(\"Dictionary load failed:\", err);\n      if (ui.unmaskDictFile) {\n        ui.unmaskDictFile.value = \"\";\n      }\n    }\n  };\n\n  reader.onerror = () => {\n    updateUnmaskStatusDisplay(\"辞書の読み込みに失敗しました。\", true);\n    if (ui.unmaskDictFile) {\n      ui.unmaskDictFile.value = \"\";\n    }\n  };\n\n  reader.readAsText(file, \"utf-8\");\n}\n\n/**\n * ドロップゾーンを設定\n * @param {HTMLElement} zone - ドロップゾーン要素\n * @param {HTMLInputElement} input - ファイル入力要素\n * @param {Function} handler - ファイル処理関数\n */\nfunction setupDropZone(zone, input, handler) {\n  if (!zone || !input) {\n    return;\n  }\n  const onDragOver = (event) => {\n    event.preventDefault();\n    zone.classList.add(\"is-dragover\");\n  };\n  const onDragLeave = () => {\n    zone.classList.remove(\"is-dragover\");\n  };\n  const onDrop = (event) => {\n    event.preventDefault();\n    zone.classList.remove(\"is-dragover\");\n    const file = event.dataTransfer?.files?.[0];\n    if (file) {\n      handler(file);\n    }\n  };\n  zone.addEventListener(\"dragover\", onDragOver);\n  zone.addEventListener(\"dragleave\", onDragLeave);\n  zone.addEventListener(\"drop\", onDrop);\n  zone.addEventListener(\"click\", () => input.click());\n  zone.addEventListener(\"keydown\", (event) => {\n    if (event.key === \"Enter\" || event.key === \" \") {\n      event.preventDefault();\n      input.click();\n    }\n  });\n}\n\n/**\n * マスク解除機能の初期化\n */\nexport function initUnmaskFeatures() {\n  // 辞書ダウンロード\n  if (ui.downloadDictBtn) {\n    ui.downloadDictBtn.addEventListener(\"click\", downloadDictionary);\n  }\n\n  // マスク済みテキストのアップロード\n  if (ui.maskedTextUploadBtn && ui.unmaskTextFile) {\n    ui.maskedTextUploadBtn.addEventListener(\"click\", () => {\n      ui.unmaskTextFile.click();\n    });\n  }\n\n  // 辞書のアップロード\n  if (ui.unmaskDictUploadBtn && ui.unmaskDictFile) {\n    ui.unmaskDictUploadBtn.addEventListener(\"click\", () => {\n      ui.unmaskDictFile.click();\n    });\n  }\n\n  // ファイル選択イベント\n  if (ui.unmaskTextFile) {\n    ui.unmaskTextFile.addEventListener(\"change\", () => {\n      loadUnmaskTextFile(ui.unmaskTextFile.files?.[0]);\n      ui.unmaskTextFile.value = \"\";\n    });\n  }\n\n  if (ui.unmaskDictFile) {\n    ui.unmaskDictFile.addEventListener(\"change\", () => {\n      loadDictionaryFile(ui.unmaskDictFile.files?.[0]);\n      ui.unmaskDictFile.value = \"\";\n    });\n  }\n\n  // ドロップゾーンの設定\n  setupDropZone(ui.unmaskTextDrop, ui.unmaskTextFile, loadUnmaskTextFile);\n  setupDropZone(ui.unmaskDictDrop, ui.unmaskDictFile, loadDictionaryFile);\n\n  // 初期状態の表示\n  updateUnmaskDictStatus(stateVars.currentUnmaskDictionary);\n}\n\n/**\n * マスク解除機能をエクスポート（main.jsから呼び出すため）\n */\nexport { unmaskText, updateUnmaskDictStatus };\n","/**\n * Samples Module - サンプルデータと例\n */\n\n// ルールごとの例文\nexport const RULE_EXAMPLES = {\n  ipv4_subnet_pair: \"192.168.0.1 255.255.255.0\",\n  aws_account_id: \"123456789012\",\n  azure_subscription_id: \"1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d\",\n  jwt_token: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxx.yyy\",\n  cidr_ipv4: \"10.0.0.0/24 / 192.168.1.0/25\",\n  cidr_ipv6: \"2001:db8::/32 / 2001:db8:1::/48 / 2001:0db8:85a3::/64\",\n  ipv6_address: \"2001:db8::1 / fe80::1 / 2001:0db8:85a3:0000:0000:8a2e:0370:7334\",\n  ip_address: \"192.168.0.10 / 10.0.5.12\",\n  email: \"user@example.com / ops+alert@example.co.jp\",\n  fqdn: \"app.internal.example.com / db-01.prod.example.co.jp\",\n  contract_number: \"AB-1234 / XYZ-98765\",\n  phone_jp: \"03-1234-5678 / 03 1234 5678 / (03)1234-5678 / 0120-123-456 / 090-1234-5678\",\n  phone_intl: \"+1 212 555 1234 / +44 20 7946 0958 / +81 3 1234 5678 / +49-30-1234-5678\",\n  api_key: \"XyZ123abcDEF456ghiJKL789mnoPQR012 / abcDEF1234567890GHIJklmnopQRSTuv\",\n  gcp_project_id: \"sample-prod-001 / personal-ops-2024\",\n  postal_code_jp: \"100-0001 / 123-4567\",\n};\n\n// サンプルデータ集\nexport const SAMPLE_DATA = {\n  address: [\n    \"顧客: さくら情報システム\",\n    \"担当: 佐藤 太郎 <taro.sato@example.com>\",\n    \"所在地: 〒100-0001 東京都千代田区千代田1-1\",\n    \"電話: 03-1234-5678\",\n    \"サーバー: web-01.internal.example.com (192.168.0.10)\",\n    \"\",\n    \"顧客: みずほデータサービス\",\n    \"担当: 鈴木 花子 <hanako.suzuki@example.com>\",\n    \"所在地: 〒150-0002 東京都渋谷区渋谷2-2\",\n    \"電話: 03-5678-9012\",\n    \"サーバー: app-02.internal.example.com (10.0.5.12)\",\n    \"\",\n    \"顧客: こだまソリューションズ\",\n    \"担当: 高橋 健 <ken.takahashi@example.com>\",\n    \"所在地: 〒530-0001 大阪府大阪市北区梅田1-1\",\n    \"電話: 06-1234-5678\",\n    \"サーバー: db-01.internal.example.com (172.16.10.20)\",\n    \"\",\n    \"顧客: しらさぎネットワーク\",\n    \"担当: 伊藤 愛 <ai.ito@example.com>\",\n    \"所在地: 〒060-0001 北海道札幌市中央区北1条西1丁目\",\n    \"電話: 011-234-5678\",\n    \"サーバー: cache-03.internal.example.com (192.168.1.25)\",\n    \"\",\n    \"顧客: つばさ工業\",\n    \"担当: 渡辺 翔 <sho.watanabe@example.com>\",\n    \"所在地: 〒460-0002 愛知県名古屋市中区丸の内2-2\",\n    \"電話: 052-123-4567\",\n    \"サーバー: api-01.internal.example.com (10.1.2.3)\",\n    \"\",\n    \"顧客: ひかり情報サービス\",\n    \"担当: 中村 彩 <aya.nakamura@example.com>\",\n    \"所在地: 〒730-0001 広島県広島市中区基町1-1\",\n    \"電話: 082-987-6543\",\n    \"サーバー: app-10.internal.example.com (192.168.10.10)\",\n    \"\",\n    \"顧客: さつきリサーチ\",\n    \"担当: 小林 優 <yu.kobayashi@example.com>\",\n    \"所在地: 〒980-0001 宮城県仙台市青葉区中央1-1\",\n    \"電話: 022-555-0101\",\n    \"サーバー: web-08.internal.example.com (10.2.3.4)\",\n    \"\",\n    \"顧客: みなみ物流\",\n    \"担当: 加藤 海 <kai.kato@example.com>\",\n    \"所在地: 〒900-0001 沖縄県那覇市久茂地1-1\",\n    \"電話: 098-123-4567\",\n    \"サーバー: log-05.internal.example.com (172.20.0.5)\",\n    \"\",\n    \"顧客: やまと通信\",\n    \"担当: 吉田 凛 <rin.yoshida@example.com>\",\n    \"所在地: 〒810-0001 福岡県福岡市中央区天神1-1\",\n    \"電話: 092-111-2222\",\n    \"サーバー: proxy-02.internal.example.com (192.168.5.5)\",\n    \"\",\n    \"顧客: もみじテクノ\",\n    \"担当: 山本 悠 <haruka.yamamoto@example.com>\",\n    \"所在地: 〒220-0001 神奈川県横浜市西区みなとみらい1-1\",\n    \"電話: 045-333-4444\",\n    \"サーバー: gateway-01.internal.example.com (10.10.10.10)\",\n  ].join(\"\\n\"),\n  config: [\n    \"primary_host=app.internal.example.com\",\n    \"primary_ip=10.0.5.12\",\n    \"backup_cidr=10.0.0.0/24\",\n    \"support_email=helpdesk@example.com\",\n    \"contract=AB-1234\",\n    \"office_phone=03-9999-0000\",\n    \"ipv6_host=2001:db8::1\",\n    \"\",\n    \"auth_host=auth.internal.example.com\",\n    \"auth_ip=172.16.0.15\",\n    \"api_cidr=192.168.10.0/24\",\n    \"incident_mail=ops@example.com\",\n    \"contract=ZX-7788\",\n    \"office_phone=06-2222-3333\",\n    \"ipv6_host=2001:db8:abcd::5\",\n    \"\",\n    \"log_host=log.internal.example.com\",\n    \"log_ip=10.2.3.4\",\n    \"backup_cidr=172.20.0.0/16\",\n    \"support_email=desk@example.com\",\n    \"contract=CD-5678\",\n    \"office_phone=052-111-2222\",\n    \"ipv6_host=2001:db8:1::7\",\n    \"\",\n    \"vpn_host=vpn.internal.example.com\",\n    \"vpn_ip=203.0.113.14\",\n    \"backup_cidr=192.0.2.0/24\",\n    \"support_email=netops@example.com\",\n    \"contract=EF-9012\",\n    \"office_phone=045-123-9876\",\n    \"ipv6_host=2001:db8:2::9\",\n    \"\",\n    \"db_host=db.internal.example.com\",\n    \"db_ip=192.168.1.25\",\n    \"backup_cidr=10.1.0.0/16\",\n    \"support_email=db-support@example.com\",\n    \"contract=GH-3456\",\n    \"office_phone=092-555-0101\",\n    \"ipv6_host=2001:db8:3::11\",\n    \"\",\n    \"cache_host=cache.internal.example.com\",\n    \"cache_ip=10.10.10.10\",\n    \"backup_cidr=172.18.0.0/16\",\n    \"support_email=cache@example.com\",\n    \"contract=JK-7890\",\n    \"office_phone=011-777-8888\",\n    \"ipv6_host=2001:db8:4::13\",\n    \"\",\n    \"proxy_host=proxy.internal.example.com\",\n    \"proxy_ip=192.168.5.5\",\n    \"backup_cidr=10.3.0.0/16\",\n    \"support_email=proxy@example.com\",\n    \"contract=LM-2468\",\n    \"office_phone=098-333-4444\",\n    \"ipv6_host=2001:db8:5::15\",\n    \"\",\n    \"report_host=report.internal.example.com\",\n    \"report_ip=172.16.10.20\",\n    \"backup_cidr=192.168.20.0/24\",\n    \"support_email=report@example.com\",\n    \"contract=NP-1357\",\n    \"office_phone=022-111-2222\",\n    \"ipv6_host=2001:db8:6::17\",\n    \"\",\n    \"batch_host=batch.internal.example.com\",\n    \"batch_ip=10.4.5.6\",\n    \"backup_cidr=10.5.0.0/16\",\n    \"support_email=batch@example.com\",\n    \"contract=QR-9753\",\n    \"office_phone=082-555-6677\",\n    \"ipv6_host=2001:db8:7::19\",\n    \"\",\n    \"edge_host=edge.internal.example.com\",\n    \"edge_ip=203.0.113.120\",\n    \"backup_cidr=198.51.100.0/24\",\n    \"support_email=edge@example.com\",\n    \"contract=ST-8642\",\n    \"office_phone=03-5555-6666\",\n    \"ipv6_host=2001:db8:8::21\",\n  ].join(\"\\n\"),\n  support: [\n    \"件名: VPN接続不具合\",\n    \"申請者: 山田 花子 <hanako.yamada@example.com>\",\n    \"会社: ひまわりソフト\",\n    \"対象IP: 203.0.113.14\",\n    \"連絡先: 080-1111-2222\",\n    \"FQDN: vpn.support.example.com\",\n    \"発生時刻: 2024-06-18 09:15\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 斎藤 修 <osamu.saito@example.com>\",\n    \"会社: きらりテクノ\",\n    \"対象IP: 198.51.100.45\",\n    \"連絡先: 090-3333-4444\",\n    \"FQDN: vpn.kirari.example.com\",\n    \"発生時刻: 2024-06-18 10:42\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 井上 直 <nao.inoue@example.com>\",\n    \"会社: みなと通信\",\n    \"対象IP: 192.0.2.23\",\n    \"連絡先: 070-5555-6666\",\n    \"FQDN: vpn.minato.example.com\",\n    \"発生時刻: 2024-06-18 11:05\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 森 結衣 <yui.mori@example.com>\",\n    \"会社: さくら情報システム\",\n    \"対象IP: 203.0.113.88\",\n    \"連絡先: 080-7777-8888\",\n    \"FQDN: vpn.sakura.example.com\",\n    \"発生時刻: 2024-06-18 11:47\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 山口 慧 <kei.yamaguchi@example.com>\",\n    \"会社: こだまソリューションズ\",\n    \"対象IP: 198.51.100.99\",\n    \"連絡先: 090-9999-0000\",\n    \"FQDN: vpn.kodama.example.com\",\n    \"発生時刻: 2024-06-18 12:30\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 木村 光 <hikaru.kimura@example.com>\",\n    \"会社: みずほデータサービス\",\n    \"対象IP: 192.0.2.77\",\n    \"連絡先: 070-1111-2222\",\n    \"FQDN: vpn.mizuho.example.com\",\n    \"発生時刻: 2024-06-18 13:05\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 池田 玲 <rei.ikeda@example.com>\",\n    \"会社: さつきリサーチ\",\n    \"対象IP: 203.0.113.150\",\n    \"連絡先: 080-2222-3333\",\n    \"FQDN: vpn.satsuki.example.com\",\n    \"発生時刻: 2024-06-18 13:42\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 石井 新 <arata.ishii@example.com>\",\n    \"会社: しらさぎネットワーク\",\n    \"対象IP: 198.51.100.10\",\n    \"連絡先: 090-4444-5555\",\n    \"FQDN: vpn.shirasagi.example.com\",\n    \"発生時刻: 2024-06-18 14:25\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 小川 渚 <nagisa.ogawa@example.com>\",\n    \"会社: つばさ工業\",\n    \"対象IP: 192.0.2.100\",\n    \"連絡先: 080-6666-7777\",\n    \"FQDN: vpn.tsubasa.example.com\",\n    \"発生時刻: 2024-06-18 15:10\",\n    \"\",\n    \"件名: VPN接続不具合\",\n    \"申請者: 高田 陸 <riku.takada@example.com>\",\n    \"会社: ひかり情報サービス\",\n    \"対象IP: 203.0.113.200\",\n    \"連絡先: 090-8888-9999\",\n    \"FQDN: vpn.hikari.example.com\",\n    \"発生時刻: 2024-06-18 16:00\",\n  ].join(\"\\n\"),\n};\n","/**\n * Rules Module - ルール管理\n */\n\nimport { ui } from \"./ui.js\";\nimport { state, persistState, setCurrentSessionId } from \"./state.js\";\nimport { RULE_EXAMPLES } from \"./samples.js\";\nimport { SESSION_ID_LENGTH } from \"./constants.js\";\n\n// ベースルール定義\nexport const baseRules = [\n  {\n    name: \"ipv4_subnet_pair\",\n    label: \"IPv4 + Subnet\",\n    pattern:\n      \"\\\\b(?:\\\\d{1,3}\\\\.){3}\\\\d{1,3}\\\\s+(?:255|254|252|248|240|224|192|128|0)\\\\.(?:255|254|252|248|240|224|192|128|0)\\\\.(?:255|254|252|248|240|224|192|128|0)\\\\.(?:255|254|252|248|240|224|192|128|0)\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"SUBNET\",\n  },\n  {\n    name: \"cidr_ipv4\",\n    label: \"CIDR v4\",\n    pattern: \"\\\\b(?:\\\\d{1,3}\\\\.){3}\\\\d{1,3}/\\\\d{1,2}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"CIDR\",\n  },\n  {\n    name: \"cidr_ipv6\",\n    label: \"CIDR v6\",\n    pattern:\n      \"(?i)(?<![A-F0-9:])(?:(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,7}:|(?:[A-F0-9]{1,4}:){1,6}:[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,5}(?::[A-F0-9]{1,4}){1,2}|(?:[A-F0-9]{1,4}:){1,4}(?::[A-F0-9]{1,4}){1,3}|(?:[A-F0-9]{1,4}:){1,3}(?::[A-F0-9]{1,4}){1,4}|(?:[A-F0-9]{1,4}:){1,2}(?::[A-F0-9]{1,4}){1,5}|[A-F0-9]{1,4}:(?:(?::[A-F0-9]{1,4}){1,6})|:(?:(?::[A-F0-9]{1,4}){1,7}|:))/\\\\d{1,3}(?![A-F0-9:])\",\n    mode: \"pseudonymize\",\n    prefix: \"CIDR6\",\n  },\n  {\n    name: \"ipv6_address\",\n    label: \"IPv6\",\n    pattern:\n      \"(?i)(?<![A-F0-9:])(?:(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,7}:|(?:[A-F0-9]{1,4}:){1,6}:[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,5}(?::[A-F0-9]{1,4}){1,2}|(?:[A-F0-9]{1,4}:){1,4}(?::[A-F0-9]{1,4}){1,3}|(?:[A-F0-9]{1,4}:){1,3}(?::[A-F0-9]{1,4}){1,4}|(?:[A-F0-9]{1,4}:){1,2}(?::[A-F0-9]{1,4}){1,5}|[A-F0-9]{1,4}:(?:(?::[A-F0-9]{1,4}){1,6})|:(?:(?::[A-F0-9]{1,4}){1,7}|:))(?![A-F0-9:])\",\n    mode: \"pseudonymize\",\n    prefix: \"IPV6\",\n  },\n  {\n    name: \"ip_address\",\n    label: \"IPv4\",\n    pattern: \"\\\\b(?:\\\\d{1,3}\\\\.){3}\\\\d{1,3}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"IPv4\",\n  },\n  {\n    name: \"email\",\n    label: \"Email\",\n    pattern: \"(?i)[A-Z0-9._%+-]+@[A-Z0-9.-]+\\\\.[A-Z]{2,}\",\n    mode: \"pseudonymize\",\n    prefix: \"EMAIL\",\n  },\n  {\n    name: \"fqdn\",\n    label: \"FQDN\",\n    pattern: \"(?i)\\\\b(?:[A-Z0-9-]+\\\\.)+[A-Z]{2,}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"FQDN\",\n  },\n  {\n    name: \"contract_number\",\n    label: \"Contract No.\",\n    pattern: \"\\\\b[A-Z]{2,4}-\\\\d{4,}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"CONTRACT\",\n  },\n  {\n    name: \"phone_jp\",\n    label: \"電話番号・日本\",\n    pattern:\n      \"(?<![\\\\d:])(?:\\\\(0\\\\d{1,4}\\\\)[\\\\s-]?\\\\d{2,4}[\\\\s-]?\\\\d{4}|0\\\\d{1,4}\\\\(\\\\d{2,4}\\\\)\\\\d{4}|0\\\\d{1,4}[\\\\s-]?\\\\d{2,4}[\\\\s-]?\\\\d{4}|(?:0120|0800|0570)[\\\\s-]?\\\\d{3}[\\\\s-]?\\\\d{3})(?![\\\\d:])\",\n    mode: \"pseudonymize\",\n    prefix: \"PHONEJP\",\n  },\n  {\n    name: \"phone_intl\",\n    label: \"電話番号・国番号形式\",\n    pattern: \"(?<![\\\\d:])\\\\+\\\\d{1,3}(?:[\\\\s-]?\\\\(0\\\\))?(?:[\\\\s-]?\\\\d){9,14}(?![\\\\d:])\",\n    mode: \"pseudonymize\",\n    prefix: \"PHONEINTL\",\n  },\n  {\n    name: \"azure_subscription_id\",\n    label: \"Azure Subscription ID\",\n    pattern: \"\\\\b[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"AZURE\",\n  },\n  {\n    name: \"jwt_token\",\n    label: \"JWT\",\n    pattern: \"eyJ[A-Za-z0-9_-]+\\\\.[A-Za-z0-9_-]+\\\\.[A-Za-z0-9_-]+\",\n    mode: \"pseudonymize\",\n    prefix: \"JWT\",\n  },\n  {\n    name: \"api_key\",\n    label: \"API Key\",\n    pattern: \"\\\\b[A-Za-z0-9_-]{32,}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"API\",\n  },\n  {\n    name: \"gcp_project_id\",\n    label: \"GCP Project ID\",\n    pattern: \"\\\\b[a-z][a-z0-9-]{4,28}[a-z0-9]\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"GCP\",\n  },\n  {\n    name: \"postal_code_jp\",\n    label: \"郵便番号\",\n    pattern: \"\\\\b\\\\d{3}-?\\\\d{4}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"ZIP\",\n  },\n  {\n    name: \"aws_account_id\",\n    label: \"AWS Account ID\",\n    pattern: \"\\\\b\\\\d{12}\\\\b\",\n    mode: \"pseudonymize\",\n    prefix: \"AWS\",\n  },\n];\n\n/**\n * ルールのリストをUIに描画\n * @param {Function} readDictRows - 辞書行読み取り関数\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function renderRules(readDictRows, scheduleMask) {\n  ui.ruleList.innerHTML = \"\";\n  const fragment = document.createDocumentFragment();\n  state.rules.forEach((rule, index) => {\n    const wrapper = document.createElement(\"label\");\n    wrapper.className = \"rule-item\";\n    wrapper.draggable = true;\n    wrapper.dataset.index = String(index);\n    const handle = document.createElement(\"span\");\n    handle.className = \"rule-handle\";\n    handle.textContent = \"⋮⋮\";\n    const checkbox = document.createElement(\"input\");\n    checkbox.type = \"checkbox\";\n    checkbox.checked = rule.enabled;\n    checkbox.addEventListener(\"change\", () => {\n      state.rules[index].enabled = checkbox.checked;\n      persistState(readDictRows);\n      if (scheduleMask) scheduleMask();\n    });\n    const span = document.createElement(\"strong\");\n    span.className = \"rule-label\";\n    span.textContent = rule.label;\n    const example = document.createElement(\"span\");\n    example.className = \"rule-example\";\n    const exampleText = RULE_EXAMPLES[rule.name] || \"\";\n    if (exampleText) {\n      example.textContent = ` (ex. ${exampleText})`;\n    }\n    wrapper.appendChild(handle);\n    wrapper.appendChild(checkbox);\n    wrapper.appendChild(span);\n    if (exampleText) {\n      wrapper.appendChild(example);\n    }\n    fragment.appendChild(wrapper);\n  });\n  ui.ruleList.appendChild(fragment);\n\n  initRuleDrag(readDictRows, scheduleMask);\n}\n\n/**\n * ルールのドラッグ&ドロップを初期化\n * @param {Function} readDictRows - 辞書行読み取り関数\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function initRuleDrag(readDictRows, scheduleMask) {\n  const items = Array.from(ui.ruleList.querySelectorAll(\".rule-item\"));\n  if (items.length === 0) {\n    return;\n  }\n  let dragIndex = null;\n  let placeholder = null;\n  let lastDropIndex = null;\n  let lastInsertBefore = true;\n\n  const ensurePlaceholder = () => {\n    if (placeholder) {\n      return placeholder;\n    }\n    placeholder = document.createElement(\"div\");\n    placeholder.className = \"rule-placeholder\";\n    return placeholder;\n  };\n\n  const removePlaceholder = () => {\n    if (placeholder && placeholder.parentNode) {\n      placeholder.parentNode.removeChild(placeholder);\n    }\n    placeholder = null;\n  };\n\n  const clearIndicators = () => {\n    items.forEach((node) => {\n      node.classList.remove(\"drop-target\", \"drop-before\", \"drop-after\");\n    });\n  };\n  items.forEach((item) => {\n    item.addEventListener(\"dragstart\", (event) => {\n      dragIndex = Number(item.dataset.index);\n      item.classList.add(\"dragging\");\n      event.dataTransfer.effectAllowed = \"move\";\n    });\n    item.addEventListener(\"dragend\", () => {\n      item.classList.remove(\"dragging\");\n      item.classList.remove(\"drop-target\", \"drop-before\", \"drop-after\");\n      removePlaceholder();\n      dragIndex = null;\n      lastDropIndex = null;\n    });\n    item.addEventListener(\"dragover\", (event) => {\n      event.preventDefault();\n      event.dataTransfer.dropEffect = \"move\";\n      clearIndicators();\n      const rect = item.getBoundingClientRect();\n      const isBefore = event.clientY < rect.top + rect.height / 2;\n      item.classList.add(\"drop-target\");\n      item.classList.add(isBefore ? \"drop-before\" : \"drop-after\");\n      const dropIndex = Number(item.dataset.index);\n      const insertTarget = ensurePlaceholder();\n      if (isBefore) {\n        item.parentNode.insertBefore(insertTarget, item);\n      } else {\n        item.parentNode.insertBefore(insertTarget, item.nextSibling);\n      }\n      lastDropIndex = dropIndex;\n      lastInsertBefore = isBefore;\n    });\n    item.addEventListener(\"dragleave\", () => {\n      item.classList.remove(\"drop-target\", \"drop-before\", \"drop-after\");\n    });\n    item.addEventListener(\"drop\", (event) => {\n      event.preventDefault();\n      item.classList.remove(\"drop-target\", \"drop-before\", \"drop-after\");\n      const dropIndex = Number(item.dataset.index);\n      if (Number.isNaN(dragIndex) || Number.isNaN(dropIndex) || dragIndex === dropIndex) {\n        removePlaceholder();\n        return;\n      }\n      const isBefore = lastDropIndex === dropIndex ? lastInsertBefore : true;\n      const [moved] = state.rules.splice(dragIndex, 1);\n      let insertIndex = dropIndex;\n      if (dragIndex < dropIndex) {\n        insertIndex = isBefore ? dropIndex - 1 : dropIndex;\n      } else {\n        insertIndex = isBefore ? dropIndex : dropIndex + 1;\n      }\n      state.rules.splice(insertIndex, 0, moved);\n      removePlaceholder();\n      persistState(readDictRows);\n      renderRules(readDictRows, scheduleMask);\n      if (scheduleMask) scheduleMask();\n    });\n  });\n\n  ui.ruleList.addEventListener(\"dragover\", (event) => {\n    event.preventDefault();\n  });\n\n  ui.ruleList.addEventListener(\"drop\", (event) => {\n    event.preventDefault();\n    if (Number.isNaN(dragIndex) || dragIndex === null) {\n      removePlaceholder();\n      return;\n    }\n    if (lastDropIndex === null || Number.isNaN(lastDropIndex)) {\n      removePlaceholder();\n      return;\n    }\n    const [moved] = state.rules.splice(dragIndex, 1);\n    let insertIndex = lastDropIndex;\n    if (dragIndex < lastDropIndex) {\n      insertIndex = lastInsertBefore ? lastDropIndex - 1 : lastDropIndex;\n    } else {\n      insertIndex = lastInsertBefore ? lastDropIndex : lastDropIndex + 1;\n    }\n    state.rules.splice(insertIndex, 0, moved);\n    removePlaceholder();\n    persistState(readDictRows);\n    renderRules(readDictRows, scheduleMask);\n    if (scheduleMask) scheduleMask();\n  });\n}\n\n/**\n * 全ルールの有効/無効を切り替え\n * @param {Function} readDictRows - 辞書行読み取り関数\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function toggleAllRules(readDictRows, scheduleMask) {\n  const shouldEnable = state.rules.some((rule) => !rule.enabled);\n  state.rules = state.rules.map((rule) => ({ ...rule, enabled: shouldEnable }));\n  renderRules(readDictRows, scheduleMask);\n  persistState(readDictRows);\n  if (scheduleMask) scheduleMask();\n}\n\n/**\n * ルールの順序を推奨順にリセット\n * @param {Function} readDictRows - 辞書行読み取り関数\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function resetRuleOrder(readDictRows, scheduleMask) {\n  state.rules = baseRules.map((rule) => {\n    const existing = state.rules.find((item) => item.name === rule.name);\n    return {\n      ...rule,\n      enabled: existing ? existing.enabled : true,\n    };\n  });\n  persistState(readDictRows);\n  renderRules(readDictRows, scheduleMask);\n  if (scheduleMask) scheduleMask();\n}\n\n/**\n * セッションIDを生成\n * @returns {string} ランダムなセッションID\n */\nexport function generateSessionId() {\n  const chars = \"abcdefghijklmnopqrstuvwxyz0123456789\";\n  let result = \"\";\n  for (let i = 0; i < SESSION_ID_LENGTH; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\n/**\n * 連番桁数を取得\n * @returns {number} 連番の桁数\n */\nexport function getNumberWidth() {\n  const parsed = Number.parseInt(ui.numberWidth.value, 10);\n  return Number.isFinite(parsed) ? parsed : 3;\n}\n\n/**\n * セッションIDを再生成してマスク実行\n * @param {Function} maskText - マスク実行関数\n */\nexport function regenerateSessionId(maskText) {\n  const newId = generateSessionId();\n  setCurrentSessionId(newId);\n  if (maskText) maskText();\n}\n\n/**\n * セッションID再生成ボタンの有効/無効を更新\n */\nexport function updateSessionIdControls() {\n  if (!ui.regenSessionId || !ui.useRandomSessionId) {\n    return;\n  }\n  ui.regenSessionId.disabled = !ui.useRandomSessionId.checked;\n}\n","/**\n * Dictionary Module - 任意辞書管理\n */\n\nimport { ui, updateDictTableStatusDisplay, updateStatusDisplay } from \"./ui.js\";\nimport { state, persistState } from \"./state.js\";\nimport { DICT_IMPORT_BACKUP_PREFIX } from \"./constants.js\";\n\n/**\n * MaskingEngine からエスケープ関数を取得\n */\nconst MaskingEngine = window.MaskingEngine;\nif (!MaskingEngine) {\n  throw new Error(\"masking-engine.js is not loaded.\");\n}\nconst { normalizeRegexPattern, escapeRegExp } = MaskingEngine;\n\n/**\n * 辞書行を読み取る\n * @returns {Array<Object>} 辞書エントリの配列\n */\nexport function readDictRows() {\n  if (!ui.dictRows) {\n    return [];\n  }\n  return Array.from(ui.dictRows.querySelectorAll(\".dict-row\")).map((row) => ({\n    enabled: row.querySelector(\".dict-enabled\")?.checked ?? true,\n    prefix: row.querySelector(\".dict-prefix\")?.value?.trim() || \"\",\n    pattern: row.querySelector(\".dict-pattern\")?.value?.trim() || \"\",\n    regex: row.querySelector(\".dict-regex\")?.checked ?? false,\n  }));\n}\n\n/**\n * 辞書のデフォルトプレフィックスを取得\n * @returns {string} デフォルトプレフィックス\n */\nexport function getDictDefaultPrefix() {\n  const raw = ui.dictDefaultPrefix?.value || \"DICT\";\n  const trimmed = raw.trim();\n  return trimmed ? trimmed.toUpperCase() : \"DICT\";\n}\n\n/**\n * 正規表現パターンを検証\n * @param {string} pattern - 検証するパターン\n * @returns {Object} { valid: boolean, error?: string }\n */\nexport function validatePattern(pattern) {\n  try {\n    const normalized = normalizeRegexPattern(pattern);\n    new RegExp(normalized.value, normalized.flags);\n    return { valid: true };\n  } catch (err) {\n    return { valid: false, error: err.message };\n  }\n}\n\n/**\n * 辞書エントリからマスキングルールを構築\n * @returns {Array<Object>|null} ルール配列、エラー時はnull\n */\nexport function buildDictionaryRules() {\n  const entries = readDictRows();\n  const rules = [];\n  updateDictTableStatusDisplay(\"\");\n  const defaultPrefix = getDictDefaultPrefix();\n  let hasError = false;\n\n  entries.forEach((entry, index) => {\n    if (!entry.enabled || !entry.pattern) {\n      return;\n    }\n    if (entry.regex) {\n      const check = validatePattern(entry.pattern);\n      if (!check.valid) {\n        updateDictTableStatusDisplay(`辞書の正規表現が不正です。(行 ${index + 1})`);\n        hasError = true;\n        return;\n      }\n    }\n    const pattern = entry.regex ? entry.pattern : escapeRegExp(entry.pattern);\n    rules.push({\n      name: `dictionary_${index}`,\n      label: \"辞書\",\n      pattern,\n      isDictionary: true,\n      prefix: (entry.prefix || defaultPrefix).toUpperCase(),\n    });\n  });\n\n  if (hasError) {\n    return null;\n  }\n  return rules;\n}\n\n/**\n * 辞書行のDOM要素を作成\n * @param {Object} entry - 辞書エントリ\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n * @returns {HTMLElement} 辞書行のDOM要素\n */\nexport function createDictRow(entry = {}, scheduleMask) {\n  const row = document.createElement(\"div\");\n  row.className = \"dict-row\";\n\n  const enabled = document.createElement(\"input\");\n  enabled.type = \"checkbox\";\n  enabled.className = \"dict-enabled\";\n  enabled.checked = entry.enabled ?? true;\n\n  const prefix = document.createElement(\"input\");\n  prefix.type = \"text\";\n  prefix.className = \"dict-prefix\";\n  prefix.placeholder = \"例: NAME\";\n  prefix.value = entry.prefix || \"\";\n\n  const pattern = document.createElement(\"input\");\n  pattern.type = \"text\";\n  pattern.className = \"dict-pattern\";\n  pattern.placeholder = \"例: さくら情報システム / \\\\d{12}\";\n  pattern.value = entry.pattern || \"\";\n\n  const regexLabel = document.createElement(\"label\");\n  regexLabel.className = \"toggle\";\n  const regex = document.createElement(\"input\");\n  regex.type = \"checkbox\";\n  regex.className = \"dict-regex\";\n  regex.checked = entry.regex ?? false;\n  regexLabel.appendChild(regex);\n\n  const removeBtn = document.createElement(\"button\");\n  removeBtn.type = \"button\";\n  removeBtn.className = \"ghost small dict-remove\";\n  removeBtn.textContent = \"削除\";\n  removeBtn.addEventListener(\"click\", () => {\n    row.remove();\n    persistState(readDictRows);\n  });\n\n  const attach = (node, eventName = \"input\") => {\n    node.addEventListener(eventName, () => {\n      persistState(readDictRows);\n      if (scheduleMask) scheduleMask();\n    });\n  };\n\n  attach(enabled, \"change\");\n  attach(prefix);\n  attach(pattern);\n  attach(regex, \"change\");\n\n  row.appendChild(enabled);\n  row.appendChild(prefix);\n  row.appendChild(pattern);\n  row.appendChild(regexLabel);\n  row.appendChild(removeBtn);\n  return row;\n}\n\n/**\n * 辞書行をUIに描画\n * @param {Array<Object>} entries - 辞書エントリの配列\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function renderDictRows(entries = [], scheduleMask) {\n  if (!ui.dictRows) {\n    return;\n  }\n  ui.dictRows.innerHTML = \"\";\n  const fragment = document.createDocumentFragment();\n  const rows = entries.length\n    ? entries\n    : [{ enabled: true, prefix: \"\", pattern: \"\", regex: false }];\n  rows.forEach((entry) => {\n    fragment.appendChild(createDictRow(entry, scheduleMask));\n  });\n  ui.dictRows.appendChild(fragment);\n}\n\n/**\n * 辞書行を追加\n * @param {Object} entry - 辞書エントリ\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function addDictRow(entry = {}, scheduleMask) {\n  if (!ui.dictRows) {\n    return;\n  }\n  ui.dictRows.appendChild(createDictRow(entry, scheduleMask));\n  persistState(readDictRows);\n  if (scheduleMask) scheduleMask();\n}\n\n/**\n * 基本設定を辞書へ転記\n * @param {Function} renderRules - ルール描画関数\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n * @param {Function} savePreset - プリセット保存関数 (preset.js から渡される)\n * @param {Function} buildStatePayload - 状態ペイロード構築関数\n */\nexport function importBasicRulesToDict(\n  renderRules,\n  scheduleMask,\n  savePreset,\n  buildStatePayload\n) {\n  const ok = window.confirm(\n    \"・基本設定の各項目が、正規表現として任意辞書の末尾にコピーされます。\\n・基本設定の各項目がオフになります。\\n・転記前の設定が以下の名前でマイ設定に保存されます。\\n　　転記前バックアップ_YYYYmmdd-HHMM\\n・以上、よろしければ「OK」を押してください。\"\n  );\n  if (!ok) {\n    return;\n  }\n\n  // バックアッププリセットを保存\n  saveImportBackupPreset(savePreset, buildStatePayload);\n\n  // 基本ルールを辞書形式に変換\n  const entries = state.rules.map((rule) => ({\n    enabled: rule.enabled,\n    prefix: rule.prefix || \"\",\n    pattern: rule.pattern || \"\",\n    regex: true,\n  }));\n\n  // 現在の辞書に追加\n  const current = readDictRows();\n  renderDictRows([...current, ...entries], scheduleMask);\n\n  // 基本ルールを全てオフにする\n  state.rules = state.rules.map((rule) => ({ ...rule, enabled: false }));\n  if (renderRules) renderRules(readDictRows, scheduleMask);\n\n  persistState(readDictRows);\n  if (scheduleMask) scheduleMask();\n  updateStatusDisplay(\"基本設定を辞書へ転記しました。\");\n}\n\n/**\n * 転記前のバックアッププリセットを保存\n * @param {Function} savePreset - プリセット保存関数\n * @param {Function} buildStatePayload - 状態ペイロード構築関数\n */\nfunction saveImportBackupPreset(savePreset, buildStatePayload) {\n  const payload = buildStatePayload(readDictRows);\n  const timestamp = formatBackupTimestamp(new Date());\n  const name = `${DICT_IMPORT_BACKUP_PREFIX}_${timestamp}`;\n\n  // savePreset は preset.js から渡される関数を使う\n  // ここでは直接 localStorage を操作\n  if (savePreset) {\n    savePreset(name, payload);\n  }\n}\n\n/**\n * バックアップ用タイムスタンプをフォーマット\n * @param {Date} date - 日付オブジェクト\n * @returns {string} YYYYmmdd-HHMM 形式のタイムスタンプ\n */\nfunction formatBackupTimestamp(date) {\n  const pad = (value) => String(value).padStart(2, \"0\");\n  const year = date.getFullYear();\n  const month = pad(date.getMonth() + 1);\n  const day = pad(date.getDate());\n  const hours = pad(date.getHours());\n  const minutes = pad(date.getMinutes());\n  return `${year}${month}${day}-${hours}${minutes}`;\n}\n","/**\n * Address Module - 住所辞書管理\n */\n\nimport { ui, updateStatusDisplay } from \"./ui.js\";\nimport * as stateVars from \"./state.js\";\nimport {\n  setAddressPatterns,\n  setAddressPatternChunks,\n  setAddressCityPatterns,\n  setAddressCityPatternsByPref,\n  setAddressTownPatternsByPref,\n  setAddressTownPrefectures,\n  setAddressDictLoadPromise,\n  setAddressTownDictLoadPromise,\n  setAddressSelectedPrefs,\n} from \"./state.js\";\nimport {\n  ADDRESS_DICT_LOCAL_URL,\n  ADDRESS_TOWN_DICT_URL,\n  ADDRESS_DICT_CUSTOM_KEY,\n  ADDRESS_PREF_SELECTION_KEY,\n  ADDRESS_PATTERN_CHUNK_SIZE,\n  ADDRESS_SEARCH_LIMIT,\n  ADDRESS_PREFECTURES,\n  ADDRESS_PREFECTURES_SORTED,\n  GEOLONIA_API_URL,\n} from \"./constants.js\";\n\nconst DEFAULT_FETCH_IDLE_TIMEOUT_MS = 10_000;\n\nasync function fetchJsonWithTimeout(url, timeoutMs) {\n  const controller = new AbortController();\n  const timer = setTimeout(() => controller.abort(), timeoutMs);\n  try {\n    const response = await fetch(url, { signal: controller.signal });\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}`);\n    }\n    return await response.json();\n  } finally {\n    clearTimeout(timer);\n  }\n}\n\nasync function fetchJsonWithIdleTimeout(url, idleTimeoutMs) {\n  if (\n    typeof ReadableStream === \"undefined\" ||\n    typeof TextDecoder === \"undefined\"\n  ) {\n    return fetchJsonWithTimeout(url, idleTimeoutMs);\n  }\n  const controller = new AbortController();\n  const response = await fetch(url, { signal: controller.signal });\n  if (!response.ok) {\n    throw new Error(`HTTP ${response.status}`);\n  }\n  if (!response.body || typeof response.body.getReader !== \"function\") {\n    return fetchJsonWithTimeout(url, idleTimeoutMs);\n  }\n  const reader = response.body.getReader();\n  const chunks = [];\n  let total = 0;\n  let idleTimer = null;\n  const resetIdleTimer = () => {\n    if (idleTimer) {\n      clearTimeout(idleTimer);\n    }\n    idleTimer = setTimeout(() => controller.abort(), idleTimeoutMs);\n  };\n  resetIdleTimer();\n  try {\n    while (true) {\n      const { done, value } = await reader.read();\n      if (done) {\n        break;\n      }\n      if (value) {\n        chunks.push(value);\n        total += value.length;\n      }\n      resetIdleTimer();\n    }\n  } finally {\n    if (idleTimer) {\n      clearTimeout(idleTimer);\n    }\n  }\n  const buffer = new Uint8Array(total);\n  let offset = 0;\n  for (const chunk of chunks) {\n    buffer.set(chunk, offset);\n    offset += chunk.length;\n  }\n  const text = new TextDecoder(\"utf-8\").decode(buffer);\n  return JSON.parse(text);\n}\n\n/**\n * MaskingEngine からエスケープ関数を取得\n */\nconst MaskingEngine = window.MaskingEngine;\nif (!MaskingEngine) {\n  throw new Error(\"masking-engine.js is not loaded.\");\n}\nconst { escapeRegExp } = MaskingEngine;\n\n/**\n * 都道府県リストを取得 (町域辞書から優先、なければデフォルト)\n * @returns {Array<string>} 都道府県リスト\n */\nexport function getPrefectureList() {\n  return Array.isArray(stateVars.addressTownPrefectures) && stateVars.addressTownPrefectures.length\n    ? stateVars.addressTownPrefectures\n    : ADDRESS_PREFECTURES;\n}\n\n/**\n * localStorage から都道府県選択状態を読み込み\n * @param {Array<string>} prefectures - 都道府県リスト\n * @returns {Set<string>} 選択された都道府県のSet\n */\nexport function loadAddressPrefSelection(prefectures) {\n  try {\n    const raw = localStorage.getItem(ADDRESS_PREF_SELECTION_KEY);\n    if (!raw) {\n      return new Set(prefectures);\n    }\n    const data = JSON.parse(raw);\n    if (!Array.isArray(data) || data.length === 0) {\n      return new Set(prefectures);\n    }\n    const valid = new Set(prefectures);\n    const filtered = data.filter((pref) => valid.has(pref));\n    return filtered.length ? new Set(filtered) : new Set(prefectures);\n  } catch (err) {\n    return new Set(prefectures);\n  }\n}\n\n/**\n * 都道府県選択状態を localStorage に保存\n * @param {Array<string>} selection - 選択された都道府県の配列\n */\nexport function saveAddressPrefSelection(selection) {\n  try {\n    localStorage.setItem(ADDRESS_PREF_SELECTION_KEY, JSON.stringify(selection));\n  } catch (err) {\n    // Ignore storage failures.\n  }\n}\n\n/**\n * 都道府県選択状態を同期 (初回読み込みまたは辞書更新時)\n * @param {Array<string>} prefectures - 都道府県リスト\n */\nexport function syncAddressPrefectureSelection(prefectures) {\n  if (!stateVars.addressSelectedPrefs) {\n    setAddressSelectedPrefs(loadAddressPrefSelection(prefectures));\n  } else {\n    const valid = new Set(prefectures);\n    const filtered = Array.from(stateVars.addressSelectedPrefs).filter((pref) =>\n      valid.has(pref)\n    );\n    setAddressSelectedPrefs(\n      filtered.length ? new Set(filtered) : new Set(prefectures)\n    );\n  }\n  saveAddressPrefSelection(Array.from(stateVars.addressSelectedPrefs));\n  renderAddressPrefectureFilters();\n}\n\n/**\n * 都道府県フィルターのチェックボックスを描画\n */\nexport function renderAddressPrefectureFilters() {\n  if (!ui.addressPrefectureList) {\n    return;\n  }\n  const prefectures = getPrefectureList();\n  if (!stateVars.addressSelectedPrefs) {\n    setAddressSelectedPrefs(loadAddressPrefSelection(prefectures));\n  }\n  ui.addressPrefectureList.innerHTML = \"\";\n  const fragment = document.createDocumentFragment();\n  prefectures.forEach((prefecture) => {\n    const label = document.createElement(\"label\");\n    label.className = \"pref-option\";\n    const input = document.createElement(\"input\");\n    input.type = \"checkbox\";\n    input.value = prefecture;\n    input.checked = stateVars.addressSelectedPrefs.has(prefecture);\n    input.dataset.prefecture = prefecture;\n    const text = document.createElement(\"span\");\n    text.textContent = prefecture;\n    label.appendChild(input);\n    label.appendChild(text);\n    fragment.appendChild(label);\n  });\n  ui.addressPrefectureList.appendChild(fragment);\n}\n\n/**\n * 都道府県選択変更を処理\n * @param {string} prefecture - 都道府県名\n * @param {boolean} isSelected - 選択状態\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function handlePrefectureSelectionChange(prefecture, isSelected, scheduleMask) {\n  if (!stateVars.addressSelectedPrefs) {\n    setAddressSelectedPrefs(new Set(getPrefectureList()));\n  }\n  if (isSelected) {\n    stateVars.addressSelectedPrefs.add(prefecture);\n  } else {\n    stateVars.addressSelectedPrefs.delete(prefecture);\n  }\n  saveAddressPrefSelection(Array.from(stateVars.addressSelectedPrefs));\n  applyAddressPrefectureFilters(scheduleMask);\n}\n\n/**\n * 全都道府県を一括選択/解除\n * @param {boolean} isSelected - 選択状態\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function setAllPrefecturesSelection(isSelected, scheduleMask) {\n  const prefectures = getPrefectureList();\n  setAddressSelectedPrefs(isSelected ? new Set(prefectures) : new Set());\n  saveAddressPrefSelection(Array.from(stateVars.addressSelectedPrefs));\n  renderAddressPrefectureFilters();\n  applyAddressPrefectureFilters(scheduleMask);\n}\n\n/**\n * パターンから都道府県を抽出\n * @param {string} pattern - 住所パターン\n * @returns {string|null} 都道府県名\n */\nfunction getPrefectureFromPattern(pattern) {\n  for (const prefecture of ADDRESS_PREFECTURES_SORTED) {\n    if (pattern.startsWith(prefecture)) {\n      return prefecture;\n    }\n  }\n  return null;\n}\n\n/**\n * 市区町村パターンを都道府県別にインデックス化\n * @param {Array<string>} patterns - 住所パターン配列\n */\nexport function indexAddressCityPatterns(patterns) {\n  const map = new Map();\n  patterns.forEach((pattern) => {\n    const prefecture = getPrefectureFromPattern(pattern);\n    if (!prefecture) {\n      return;\n    }\n    if (!map.has(prefecture)) {\n      map.set(prefecture, []);\n    }\n    map.get(prefecture).push(pattern);\n  });\n  setAddressCityPatternsByPref(map);\n}\n\n/**\n * 選択された都道府県の市区町村パターンを収集\n * @param {Set<string>} selection - 選択された都道府県のSet\n * @returns {Array<string>} パターン配列\n */\nfunction collectAddressCityPatterns(selection) {\n  const patterns = [];\n  selection.forEach((prefecture) => {\n    const values = stateVars.addressCityPatternsByPref.get(prefecture);\n    if (values) {\n      patterns.push(...values);\n    }\n  });\n  return patterns;\n}\n\n/**\n * 選択された都道府県の町域パターンを収集\n * @param {Set<string>} selection - 選択された都道府県のSet\n * @returns {Array<string>} パターン配列\n */\nfunction collectAddressTownPatterns(selection) {\n  if (!stateVars.addressTownPatternsByPref) {\n    return [];\n  }\n  const patterns = [];\n  selection.forEach((prefecture) => {\n    const values = stateVars.addressTownPatternsByPref[prefecture];\n    if (values) {\n      patterns.push(...values);\n    }\n  });\n  return patterns;\n}\n\n/**\n * 住所パターンをチャンクに分割 (正規表現の長さ制限対策)\n * @param {Array<string>} patterns - 住所パターン配列\n * @returns {Array<string>} チャンク配列\n */\nfunction buildAddressPatternChunks(patterns) {\n  if (!Array.isArray(patterns) || patterns.length === 0) {\n    return [];\n  }\n  const escapedPatterns = patterns.map((addr) => escapeRegExp(addr));\n  const chunks = [];\n  for (let i = 0; i < escapedPatterns.length; i += ADDRESS_PATTERN_CHUNK_SIZE) {\n    chunks.push(\n      escapedPatterns.slice(i, i + ADDRESS_PATTERN_CHUNK_SIZE).join(\"|\")\n    );\n  }\n  return chunks;\n}\n\n/**\n * 都道府県フィルターを適用してパターンを更新\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function applyAddressPrefectureFilters(scheduleMask) {\n  const selection = stateVars.addressSelectedPrefs ?? new Set(getPrefectureList());\n  const cityPatterns = collectAddressCityPatterns(selection);\n  const townPatterns = collectAddressTownPatterns(selection);\n  setAddressPatterns([...cityPatterns, ...townPatterns]);\n  setAddressPatternChunks(buildAddressPatternChunks(stateVars.addressPatterns));\n  renderAddressSearchResults();\n  if (ui.useAddressDict?.checked && scheduleMask) {\n    scheduleMask();\n  }\n}\n\n/**\n * 住所辞書を読み込み (ローカルファイルまたはカスタム)\n */\nexport async function loadAddressDict() {\n  // localStorageのカスタム辞書を先に適用\n  const custom = loadCustomAddressDict();\n  if (custom) {\n    setAddressCityPatterns(custom.patterns);\n    indexAddressCityPatterns(stateVars.addressCityPatterns);\n    renderAddressDictStatus(custom);\n    syncAddressPrefectureSelection(getPrefectureList());\n    applyAddressPrefectureFilters();\n    return;\n  }\n\n  // 読み込み中表示\n  if (ui.addressDictVersion) {\n    ui.addressDictVersion.textContent = \"読み込み中...\";\n  }\n\n  try {\n    if (!stateVars.addressDictLoadPromise) {\n      setAddressDictLoadPromise(\n        fetch(ADDRESS_DICT_LOCAL_URL).then((response) => {\n          if (!response.ok) {\n            throw new Error(`HTTP ${response.status}`);\n          }\n          return response.json();\n        })\n      );\n    }\n    const data = await stateVars.addressDictLoadPromise;\n    if (!data || !Array.isArray(data.patterns)) {\n      throw new Error(\"invalid address dict\");\n    }\n    setAddressCityPatterns(data.patterns);\n    indexAddressCityPatterns(stateVars.addressCityPatterns);\n    renderAddressDictStatus({\n      version: data.version || \"unknown\",\n      updated: data.updated || \"-\",\n      count: Number.isFinite(data.count)\n        ? data.count\n        : stateVars.addressCityPatterns.length,\n      source: \"local\",\n    });\n    syncAddressPrefectureSelection(getPrefectureList());\n    applyAddressPrefectureFilters();\n  } catch (err) {\n    console.warn(\"Failed to load address dictionary from JSON:\", err);\n    setAddressDictLoadPromise(null);\n    try {\n      const fallback = await loadLocalAddressDictFromScript();\n      setAddressCityPatterns(fallback.patterns);\n      indexAddressCityPatterns(stateVars.addressCityPatterns);\n      renderAddressDictStatus({\n        version: fallback.version || \"unknown\",\n        updated: fallback.updated || \"-\",\n        count: Number.isFinite(fallback.count)\n          ? fallback.count\n          : stateVars.addressCityPatterns.length,\n        source: \"local\",\n      });\n      syncAddressPrefectureSelection(getPrefectureList());\n      applyAddressPrefectureFilters();\n    } catch (fallbackErr) {\n      console.error(\"Failed to load address dictionary (all methods):\", fallbackErr);\n      ui.addressDictVersion.textContent = \"エラー\";\n      ui.addressDictSource.textContent = \"データが見つかりません\";\n      setAddressCityPatterns([]);\n      setAddressCityPatternsByPref(new Map());\n      applyAddressPrefectureFilters();\n    }\n  }\n}\n\n/**\n * 町域辞書を読み込み\n */\nexport async function loadTownAddressDict() {\n  if (!ui.addressTownDictStatus) {\n    return;\n  }\n  ui.addressTownDictStatus.textContent = \"読み込み中...\";\n  try {\n    if (!stateVars.addressTownDictLoadPromise) {\n      setAddressTownDictLoadPromise(\n        fetch(ADDRESS_TOWN_DICT_URL).then((response) => {\n          if (!response.ok) {\n            throw new Error(`HTTP ${response.status}`);\n          }\n          return response.json();\n        })\n      );\n    }\n    const data = await stateVars.addressTownDictLoadPromise;\n    if (!data || typeof data !== \"object\") {\n      throw new Error(\"invalid town dict\");\n    }\n    setAddressTownPatternsByPref(data.patternsByPrefecture || {});\n    setAddressTownPrefectures(\n      Array.isArray(data.prefectures) ? data.prefectures : null\n    );\n    const totalCount = Number.isFinite(data.totalCount)\n      ? data.totalCount\n      : Object.values(stateVars.addressTownPatternsByPref).reduce(\n          (sum, list) => sum + (Array.isArray(list) ? list.length : 0),\n          0\n        );\n    ui.addressTownDictStatus.textContent = `読み込み済み (${totalCount.toLocaleString()}件)`;\n    syncAddressPrefectureSelection(getPrefectureList());\n    applyAddressPrefectureFilters();\n  } catch (err) {\n    console.warn(\"Failed to load town address dictionary:\", err);\n    setAddressTownDictLoadPromise(null);\n    ui.addressTownDictStatus.textContent = \"読み込み失敗\";\n  }\n}\n\n/**\n * スクリプトタグから住所辞書を読み込み (フォールバック)\n * @returns {Promise<Object>} 辞書データ\n */\nfunction loadLocalAddressDictFromScript() {\n  if (\n    typeof ADDRESS_PATTERNS !== \"undefined\" &&\n    Array.isArray(ADDRESS_PATTERNS)\n  ) {\n    return Promise.resolve({\n      version: ADDRESS_DICT_VERSION,\n      updated: ADDRESS_DICT_UPDATED,\n      count: ADDRESS_DICT_COUNT,\n      patterns: ADDRESS_PATTERNS,\n    });\n  }\n  return new Promise((resolve, reject) => {\n    const script = document.createElement(\"script\");\n    script.src = \"address-dict.js\";\n    script.onload = () => {\n      if (\n        typeof ADDRESS_PATTERNS !== \"undefined\" &&\n        Array.isArray(ADDRESS_PATTERNS)\n      ) {\n        resolve({\n          version: ADDRESS_DICT_VERSION,\n          updated: ADDRESS_DICT_UPDATED,\n          count: ADDRESS_DICT_COUNT,\n          patterns: ADDRESS_PATTERNS,\n        });\n      } else {\n        reject(new Error(\"address dict missing\"));\n      }\n    };\n    script.onerror = () => reject(new Error(\"address dict load failed\"));\n    document.head.appendChild(script);\n  });\n}\n\n/**\n * localStorage からカスタム住所辞書を読み込み\n * @returns {Object|null} カスタム辞書データ\n */\nfunction loadCustomAddressDict() {\n  try {\n    const raw = localStorage.getItem(ADDRESS_DICT_CUSTOM_KEY);\n    if (!raw) {\n      return null;\n    }\n    const data = JSON.parse(raw);\n    if (!data || !Array.isArray(data.patterns)) {\n      return null;\n    }\n    return {\n      version: data.version || \"unknown\",\n      updated: data.updated || \"-\",\n      count: data.patterns.length,\n      source: \"custom\",\n      patterns: data.patterns,\n    };\n  } catch (err) {\n    return null;\n  }\n}\n\n/**\n * 住所辞書のステータスを描画\n * @param {Object} info - 辞書情報 { version, updated, count, source }\n */\nfunction renderAddressDictStatus(info) {\n  if (!info) return;\n\n  ui.addressDictVersion.textContent = formatAddressDictVersion(info.version);\n  ui.addressDictCount.textContent = info.count.toLocaleString();\n  ui.addressDictUpdated.textContent = info.updated;\n\n  if (info.source === \"custom\") {\n    ui.addressDictSource.textContent = \"オンライン更新\";\n  } else {\n    ui.addressDictSource.textContent = \"ローカル同梱\";\n  }\n\n  renderAddressSearchResults();\n}\n\n/**\n * 辞書バージョンをフォーマット\n * @param {string} version - バージョン文字列\n * @returns {string} フォーマット済みバージョン\n */\nfunction formatAddressDictVersion(version) {\n  // \"2025-12\" -> \"2025年12月版\"\n  if (!version || version === \"unknown\") return \"-\";\n  const match = version.match(/^(\\d{4})-(\\d{2})$/);\n  if (match) {\n    return `${match[1]}年${parseInt(match[2], 10)}月版`;\n  }\n  return version;\n}\n\n/**\n * 住所検索結果を描画\n * @param {string} query - 検索クエリ (省略時は入力欄から取得)\n */\nexport function renderAddressSearchResults(query) {\n  if (!ui.addressSearchResults) {\n    return;\n  }\n  const patterns = stateVars.addressPatterns;\n  if (!patterns) {\n    ui.addressSearchResults.textContent = \"辞書を読み込み中...\";\n    return;\n  }\n  const raw = query ?? ui.addressSearchInput?.value ?? \"\";\n  const trimmed = raw.trim();\n  if (!trimmed) {\n    ui.addressSearchResults.textContent = \"検索結果はここに表示されます。\";\n    return;\n  }\n  const results = patterns.filter((pattern) => pattern.includes(trimmed));\n  const limited = results.slice(0, ADDRESS_SEARCH_LIMIT);\n  if (limited.length === 0) {\n    ui.addressSearchResults.textContent = \"一致する住所がありません。\";\n    return;\n  }\n  const suffix = results.length > ADDRESS_SEARCH_LIMIT ? \"\\n...\" : \"\";\n  ui.addressSearchResults.textContent = limited.join(\"\\n\") + suffix;\n}\n\n/**\n * オンラインから住所辞書を更新\n */\nexport async function updateAddressDict() {\n  ui.updateAddressDict.disabled = true;\n  ui.updateAddressDict.textContent = \"更新中...\";\n\n  try {\n    const data = await fetchJsonWithIdleTimeout(\n      GEOLONIA_API_URL,\n      DEFAULT_FETCH_IDLE_TIMEOUT_MS\n    );\n    const patterns = buildAddressPatternsFromGeolonia(data);\n\n    const now = new Date();\n    const version = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(\n      2,\n      \"0\"\n    )}`;\n    const updated = now.toISOString().split(\"T\")[0];\n\n    const payload = {\n      version,\n      updated,\n      patterns,\n      source: \"geolonia\",\n    };\n\n    localStorage.setItem(ADDRESS_DICT_CUSTOM_KEY, JSON.stringify(payload));\n    setAddressCityPatterns(patterns);\n    indexAddressCityPatterns(stateVars.addressCityPatterns);\n\n    renderAddressDictStatus({\n      version,\n      updated,\n      count: patterns.length,\n      source: \"custom\",\n    });\n\n    syncAddressPrefectureSelection(getPrefectureList());\n    applyAddressPrefectureFilters();\n    updateStatusDisplay(\"住所辞書を更新しました。\");\n  } catch (err) {\n    updateStatusDisplay(\"住所辞書の更新に失敗しました。\", true);\n    console.error(\"Address dict update failed:\", err);\n  } finally {\n    ui.updateAddressDict.disabled = false;\n    ui.updateAddressDict.textContent = \"更新\";\n  }\n}\n\n/**\n * Geolonia APIのデータから住所パターンを構築\n * @param {Object} data - Geolonia APIのレスポンス\n * @returns {Array<string>} 住所パターン配列\n */\nfunction buildAddressPatternsFromGeolonia(data) {\n  const patterns = [];\n\n  for (const [prefecture, cities] of Object.entries(data)) {\n    cities.forEach((city) => {\n      patterns.push(`${prefecture}${city}`);\n    });\n  }\n\n  return patterns;\n}\n\n/**\n * 住所辞書をローカル同梱版にリセット\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function resetAddressDict(scheduleMask) {\n  const ok = window.confirm(\n    \"住所辞書をローカル同梱版に戻しますか？\\nオンラインで更新した辞書データは削除されます。\"\n  );\n  if (!ok) {\n    return;\n  }\n\n  try {\n    localStorage.removeItem(ADDRESS_DICT_CUSTOM_KEY);\n    loadAddressDict();\n    updateStatusDisplay(\"住所辞書を初期版に戻しました。\");\n    if (scheduleMask) scheduleMask();\n  } catch (err) {\n    updateStatusDisplay(\"住所辞書のリセットに失敗しました。\", true);\n  }\n}\n\n/**\n * 住所辞書からマスキングルールを構築\n * @returns {Array<Object>} ルール配列\n */\nexport function buildAddressRules() {\n  if (!ui.useAddressDict.checked) {\n    return [];\n  }\n\n  const rules = [];\n\n  // 都道府県+市区町村+町域のパターン\n  if (stateVars.addressPatternChunks.length) {\n    stateVars.addressPatternChunks.forEach((prefectureCity) => {\n      rules.push({\n        name: \"address_prefecture_city\",\n        label: \"住所・地域\",\n        pattern: prefectureCity,\n        mode: \"pseudonymize\",\n        prefix: \"ADDRESS\",\n      });\n    });\n  }\n\n  return rules;\n}\n","/**\n * Preset Module - マイ設定の保存・読み込み・管理\n */\n\nimport { ui, updatePresetStatusDisplay } from \"./ui.js\";\nimport { state, persistState, applyStatePayload, buildPresetPayload } from \"./state.js\";\nimport { PRESET_KEY } from \"./constants.js\";\n\n/**\n * プリセット一覧を読み込み\n * @returns {Array<Object>} プリセット配列\n */\nexport function loadPresets() {\n  try {\n    const raw = localStorage.getItem(PRESET_KEY);\n    if (!raw) {\n      return [];\n    }\n    const data = JSON.parse(raw);\n    return Array.isArray(data) ? data : [];\n  } catch (err) {\n    console.warn(\"Failed to load presets from localStorage:\", err);\n    return [];\n  }\n}\n\n/**\n * プリセット一覧を保存\n * @param {Array<Object>} list - プリセット配列\n */\nexport function savePresets(list) {\n  try {\n    localStorage.setItem(PRESET_KEY, JSON.stringify(list));\n  } catch (err) {\n    // Ignore storage failures.\n    console.warn(\"Failed to save presets to localStorage:\", err);\n  }\n}\n\n/**\n * プリセット選択ドロップダウンを描画\n */\nexport function renderPresetOptions() {\n  const presets = loadPresets();\n  ui.presetSelect.innerHTML = \"\";\n  const empty = document.createElement(\"option\");\n  empty.value = \"\";\n  empty.textContent = \"保存した設定を選択\";\n  ui.presetSelect.appendChild(empty);\n  presets.forEach((preset) => {\n    const option = document.createElement(\"option\");\n    option.value = preset.name;\n    option.textContent = preset.name;\n    ui.presetSelect.appendChild(option);\n  });\n}\n\n/**\n * 現在の設定をプリセットとして保存\n * @param {Function} readDictRows - 辞書行読み取り関数\n */\nexport function savePreset(readDictRows) {\n  const name = ui.presetName.value.trim();\n  if (!name) {\n    updatePresetStatusDisplay(\"設定名を入力してください。\", true);\n    return;\n  }\n  const presets = loadPresets();\n  const existing = presets.find((preset) => preset.name === name);\n  if (existing) {\n    const ok = window.confirm(\"同名の設定を上書きしますか？\");\n    if (!ok) {\n      return;\n    }\n    existing.payload = buildPresetPayload(readDictRows);\n    existing.updatedAt = new Date().toISOString();\n  } else {\n    presets.push({\n      name,\n      payload: buildPresetPayload(readDictRows),\n      updatedAt: new Date().toISOString(),\n    });\n  }\n  savePresets(presets);\n  renderPresetOptions();\n  ui.presetSelect.value = name;\n  updatePresetStatusDisplay(\"\");\n}\n\n/**\n * 指定した名前のプリセットを保存 (importBasicRulesToDict 用)\n * @param {string} name - プリセット名\n * @param {Object} payload - 状態ペイロード\n */\nexport function savePresetWithPayload(name, payload) {\n  const presets = loadPresets();\n  presets.push({\n    name,\n    payload,\n    updatedAt: new Date().toISOString(),\n  });\n  savePresets(presets);\n  renderPresetOptions();\n}\n\n/**\n * 選択したプリセットを読み込み\n * @param {Array} baseRules - ベースルール配列\n * @param {Function} renderRules - ルール描画関数\n * @param {Function} renderDictRows - 辞書行描画関数\n * @param {Function} readDictRows - 辞書行読み取り関数\n * @param {Function} scheduleMask - マスク処理スケジュール関数\n */\nexport function loadPreset(\n  baseRules,\n  renderRules,\n  renderDictRows,\n  readDictRows,\n  scheduleMask\n) {\n  const name = ui.presetSelect.value;\n  if (!name) {\n    updatePresetStatusDisplay(\"保存した設定を選択してください。\", true);\n    return;\n  }\n  const presets = loadPresets();\n  const target = presets.find((preset) => preset.name === name);\n  if (!target) {\n    return;\n  }\n\n  const result = applyStatePayload(target.payload, baseRules);\n\n  // 辞書行を復元\n  if (result.dictRowsData && renderDictRows) {\n    renderDictRows(result.dictRowsData, scheduleMask);\n  }\n\n  // ルールを再描画\n  if (result.needsRulesRender && renderRules) {\n    renderRules(readDictRows, scheduleMask);\n  }\n\n  persistState(readDictRows);\n  if (scheduleMask) scheduleMask();\n  updatePresetStatusDisplay(\"\");\n}\n\n/**\n * 選択したプリセットを削除\n */\nexport function deletePreset() {\n  const name = ui.presetSelect.value;\n  if (!name) {\n    updatePresetStatusDisplay(\"削除する設定を選択してください。\", true);\n    return;\n  }\n  const ok = window.confirm(`設定「${name}」を削除しますか？`);\n  if (!ok) {\n    return;\n  }\n  const presets = loadPresets().filter((preset) => preset.name !== name);\n  savePresets(presets);\n  renderPresetOptions();\n  updatePresetStatusDisplay(\"\");\n}\n\n/**\n * エクスポート名を解決 (入力欄または選択欄から取得)\n * @returns {string|null} エクスポート名\n */\nexport function resolveExportName() {\n  const name = ui.presetName.value.trim() || ui.presetSelect.value.trim();\n  if (!name) {\n    return null;\n  }\n  return name;\n}\n","export const ADDRESS_BLOCK_PATTERN =\n  '(?:' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目\\s*' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}番\\s*' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}号?' +\n  '|' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目\\s*' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}(?:番|号)' +\n  '|' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目' +\n  '|' +\n  '[東西南北]?[0-9０-９一二三四五六七八九十百千〇零]{1,3}条' +\n  '[東西南北]?[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目?' +\n  '|' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}' +\n  '(?:[-‐ー－]|の)' +\n  '[0-9０-９一二三四五六七八九十百千〇零]{1,3}' +\n  '(?:(?:[-‐ー－]|の)[0-9０-９一二三四五六七八九十百千〇零]{1,3})?' +\n  ')(?![0-9０-９])';\n","/**\n * Masking Module - マスキング実行エンジン\n */\n\nimport { ui, updateStatusDisplay } from \"./ui.js\";\nimport * as stateVars from \"./state.js\";\nimport { state, setCurrentSessionId, setCurrentMaskDictionary, setCurrentUnmaskDictionary, incrementMaskRunId } from \"./state.js\";\nimport { generateSessionId, getNumberWidth } from \"./rules.js\";\nimport { ASYNC_MASK_THRESHOLD, MASK_DELAY_MS } from \"./constants.js\";\nimport { ADDRESS_BLOCK_PATTERN } from \"../../patterns.js\";\n\n/**\n * MaskingEngine から関数を取得\n */\nconst MaskingEngine = window.MaskingEngine;\nif (!MaskingEngine) {\n  throw new Error(\"masking-engine.js is not loaded.\");\n}\nconst { buildRuleRegex, PlaceholderMap, computeDictionarySignature } = MaskingEngine;\n\n/**\n * 単一ルールを適用\n * @param {string} text - 対象テキスト\n * @param {Object} rule - マスキングルール\n * @param {PlaceholderMap} placeholders - プレースホルダーマップ\n * @param {Object} counts - カウント記録用オブジェクト\n * @returns {string} マスク後のテキスト\n */\nexport function applyRule(text, rule, placeholders, counts) {\n  if (!rule.pattern) {\n    return text;\n  }\n  const numberWidth = getNumberWidth();\n  const regex = rule._compiledRegex || (rule._compiledRegex = buildRuleRegex(rule));\n  let hits = 0;\n  const replaced = text.replace(regex, (match) => {\n    hits += 1;\n    return placeholders.get(rule.name, match, rule.prefix, numberWidth);\n  });\n  if (hits) {\n    counts[rule.name] = (counts[rule.name] || 0) + hits;\n  }\n  return replaced;\n}\n\n/**\n * 住所ブロックルールを適用 (複数行にまたがる住所)\n * @param {string} text - 対象テキスト\n * @param {PlaceholderMap} placeholders - プレースホルダーマップ\n * @param {Object} counts - カウント記録用オブジェクト\n * @returns {string} マスク後のテキスト\n */\nexport function applyAddressBlockRules(text, placeholders, counts) {\n  if (!stateVars.addressPatternChunks.length) {\n    return text;\n  }\n  const numberWidth = getNumberWidth();\n  const blockRegex = new RegExp(ADDRESS_BLOCK_PATTERN, \"g\");\n  const chunkRegexes = stateVars.addressPatternChunks.map((chunk) => new RegExp(chunk));\n  const addressPlaceholderRegex = /\\{\\{[^}]*:ADDRESS:\\d+\\}\\}/;\n  const lines = text.split(/\\r?\\n/);\n  let changed = false;\n  const updated = lines.map((line) => {\n    // \"所在地\" を含む行のみ処理\n    if (\n      !line.includes(\"所在地\") &&\n      !line.includes(\"所在地：\") &&\n      !line.includes(\"所在地:\")\n    ) {\n      return line;\n    }\n    // 住所パターンまたは既にマスクされたADDRESSプレースホルダーを含むか確認\n    const hasRegion =\n      addressPlaceholderRegex.test(line) ||\n      chunkRegexes.some((regex) => regex.test(line));\n    if (!hasRegion) {\n      return line;\n    }\n    // 住所ブロックパターンを適用\n    let hits = 0;\n    const replaced = line.replace(blockRegex, (match) => {\n      hits += 1;\n      return placeholders.get(\n        \"address_block\",\n        match,\n        \"ADDRESS_BLOCK\",\n        numberWidth\n      );\n    });\n    // 正規化: 郵便番号と住所の間の空白を削除\n    const normalized = replaced\n      .replace(/(\\{\\{[^}]*:ZIP:\\d+\\}\\})\\s+(?=\\{\\{[^}]*:ADDRESS:\\d+\\}\\})/g, \"$1\")\n      .replace(\n        /(\\{\\{[^}]*:ADDRESS:\\d+\\}\\})([^\\s\\{]{1,30})(\\{\\{[^}]*:ADDRESS_BLOCK:\\d+\\}\\})/g,\n        (match, head, middle, tail) => {\n          const masked = placeholders.get(\n            \"address_mid\",\n            middle,\n            \"ADDRESS_MID\",\n            numberWidth\n          );\n          counts.address_mid = (counts.address_mid || 0) + 1;\n          return `${head}${masked}${tail}`;\n        }\n      );\n    if (hits) {\n      counts.address_block = (counts.address_block || 0) + hits;\n      changed = true;\n    }\n    return normalized;\n  });\n  return changed ? updated.join(\"\\n\") : text;\n}\n\n/**\n * 統計情報を描画\n * @param {Object} counts - カウント記録\n */\nfunction renderStats(counts) {\n  const allEntries = [];\n\n  // 基本ルール\n  state.rules\n    .filter((rule) => counts[rule.name])\n    .forEach((rule) => {\n      allEntries.push(`${rule.label}: ${counts[rule.name]}`);\n    });\n\n  // その他のルール（辞書、住所など）\n  for (const [key, count] of Object.entries(counts)) {\n    // 基本ルールに含まれないものを追加\n    const isBaseRule = state.rules.some((rule) => rule.name === key);\n    if (!isBaseRule) {\n      // キー名から適切なラベルを生成\n      let label = key;\n      if (key.startsWith(\"dictionary_\")) {\n        label = \"辞書\";\n      } else if (key.startsWith(\"address_\")) {\n        label = \"住所\";\n      }\n      allEntries.push(`${label}: ${count}`);\n    }\n  }\n\n  const total = Object.values(counts).reduce((sum, value) => sum + value, 0);\n  const breakdown = allEntries.length ? allEntries.join(\" / \") : \"なし\";\n\n  updateStatusDisplay(`総マスク数: ${total} （内訳: ${breakdown}）`);\n}\n\nasync function attachDictionarySignature(dict) {\n  if (!computeDictionarySignature || !dict) {\n    return;\n  }\n  const signature = await computeDictionarySignature(dict);\n  if (!signature) {\n    return;\n  }\n  dict.signature = signature;\n  setCurrentMaskDictionary(dict);\n  setCurrentUnmaskDictionary(dict);\n  if (typeof window.updateUnmaskDictStatus === \"function\") {\n    window.updateUnmaskDictStatus(dict);\n  }\n}\n\n/**\n * マスク処理 (同期版)\n * @param {string} source - 入力テキスト\n * @param {Function} buildDictionaryRules - 辞書ルール構築関数\n * @param {Function} buildAddressRules - 住所ルール構築関数\n * @returns {boolean} 成功時true、エラー時false\n */\nfunction maskTextSync(source, buildDictionaryRules, buildAddressRules) {\n  // 新しいセッションIDを生成\n  if (!stateVars.currentSessionId) {\n    setCurrentSessionId(generateSessionId());\n  }\n  const includeSessionId = ui.useRandomSessionId?.checked ?? true;\n  const placeholders = new PlaceholderMap(stateVars.currentSessionId, includeSessionId);\n  const counts = {};\n  let result = source;\n  try {\n    // 任意辞書\n    const dictRules = buildDictionaryRules();\n    if (dictRules === null) {\n      return false;\n    }\n    dictRules.forEach((dictRule) => {\n      result = applyRule(result, dictRule, placeholders, counts);\n    });\n\n    // 住所辞書（基本ルールより先に適用）\n    const addressRules = buildAddressRules();\n    addressRules.forEach((addressRule) => {\n      result = applyRule(result, addressRule, placeholders, counts);\n    });\n    result = applyAddressBlockRules(result, placeholders, counts);\n\n    // 基本ルール\n    state.rules.forEach((rule) => {\n      if (!rule.enabled) {\n        return;\n      }\n      result = applyRule(result, rule, placeholders, counts);\n    });\n\n    ui.outputText.value = result;\n    renderStats(counts);\n\n    // 辞書を保存\n    const dict = placeholders.getDictionary();\n    setCurrentMaskDictionary(dict);\n    setCurrentUnmaskDictionary(dict);\n    if (typeof window.updateUnmaskDictStatus === \"function\") {\n      window.updateUnmaskDictStatus(dict);\n    }\n    attachDictionarySignature(dict);\n    return true;\n  } catch (err) {\n    updateStatusDisplay(\"正規表現の形式が不正です。\", true);\n    return false;\n  }\n}\n\n/**\n * マスク処理 (非同期版)\n * @param {string} source - 入力テキスト\n * @param {number} runId - 実行ID\n * @param {Function} buildDictionaryRules - 辞書ルール構築関数\n * @param {Function} buildAddressRules - 住所ルール構築関数\n */\nasync function maskTextAsync(\n  source,\n  runId,\n  buildDictionaryRules,\n  buildAddressRules\n) {\n  const shouldYield = source.length > ASYNC_MASK_THRESHOLD;\n  const yieldToBrowser = () => new Promise((resolve) => setTimeout(resolve, 0));\n  const isLatest = () => runId === stateVars.maskRunId;\n\n  // 新しいセッションIDを生成\n  if (!stateVars.currentSessionId) {\n    setCurrentSessionId(generateSessionId());\n  }\n  const includeSessionId = ui.useRandomSessionId?.checked ?? true;\n  const placeholders = new PlaceholderMap(stateVars.currentSessionId, includeSessionId);\n  const counts = {};\n  let result = source;\n  try {\n    const dictRules = buildDictionaryRules();\n    if (dictRules === null) {\n      return;\n    }\n    for (const dictRule of dictRules) {\n      result = applyRule(result, dictRule, placeholders, counts);\n      if (shouldYield) {\n        await yieldToBrowser();\n        if (!isLatest()) return;\n      }\n    }\n\n    const addressRules = buildAddressRules();\n    for (const addressRule of addressRules) {\n      result = applyRule(result, addressRule, placeholders, counts);\n      if (shouldYield) {\n        await yieldToBrowser();\n        if (!isLatest()) return;\n      }\n    }\n    result = applyAddressBlockRules(result, placeholders, counts);\n\n    for (const rule of state.rules) {\n      if (!rule.enabled) {\n        continue;\n      }\n      result = applyRule(result, rule, placeholders, counts);\n      if (shouldYield) {\n        await yieldToBrowser();\n        if (!isLatest()) return;\n      }\n    }\n\n    if (!isLatest()) return;\n    ui.outputText.value = result;\n    renderStats(counts);\n    const dict = placeholders.getDictionary();\n    setCurrentMaskDictionary(dict);\n    setCurrentUnmaskDictionary(dict);\n    if (typeof window.updateUnmaskDictStatus === \"function\") {\n      window.updateUnmaskDictStatus(dict);\n    }\n    attachDictionarySignature(dict);\n  } catch (err) {\n    updateStatusDisplay(\"正規表現の形式が不正です。\", true);\n  }\n}\n\n/**\n * マスク処理のエントリーポイント\n * @param {Function} buildDictionaryRules - 辞書ルール構築関数\n * @param {Function} buildAddressRules - 住所ルール構築関数\n */\nexport function maskText(buildDictionaryRules, buildAddressRules) {\n  const source = ui.inputText.value || \"\";\n  const runId = incrementMaskRunId();\n  if (!source.trim()) {\n    ui.outputText.value = \"\";\n    updateStatusDisplay(\"入力テキストが空です。\");\n    setCurrentMaskDictionary(null);\n    setCurrentUnmaskDictionary(null);\n    if (typeof window.updateUnmaskDictStatus === \"function\") {\n      window.updateUnmaskDictStatus(null);\n    }\n    return;\n  }\n\n  if (source.length > ASYNC_MASK_THRESHOLD) {\n    updateStatusDisplay(\"マスク処理中...\");\n    maskTextAsync(source, runId, buildDictionaryRules, buildAddressRules);\n    return;\n  }\n\n  maskTextSync(source, buildDictionaryRules, buildAddressRules);\n}\n\n/**\n * マスク処理をスケジュール (現在は自動マスクを無効化しているため何もしない)\n */\nexport function scheduleMask() {\n  // Auto masking disabled. Use explicit mask action.\n  return;\n}\n","/**\n * Main Entry Point - アプリケーションのエントリーポイント\n */\n\n// すべてのモジュールをインポート\nimport { ui, updateStatusDisplay } from \"./modules/ui.js\";\nimport { applyBrandConfig, getAppFilenameBase } from \"./modules/brand.js\";\nimport { initUnmaskFeatures, unmaskText, updateUnmaskDictStatus } from \"./modules/unmask.js\";\nimport { SAMPLE_DATA } from \"./modules/samples.js\";\nimport * as stateVars from \"./modules/state.js\";\nimport {\n  state,\n  buildStatePayload,\n  persistState,\n  restoreState,\n  setCurrentMaskDictionary,\n  setCurrentUnmaskDictionary,\n} from \"./modules/state.js\";\nimport {\n  baseRules,\n  renderRules,\n  toggleAllRules,\n  resetRuleOrder,\n  regenerateSessionId,\n  updateSessionIdControls,\n} from \"./modules/rules.js\";\nimport {\n  readDictRows,\n  renderDictRows,\n  addDictRow,\n  importBasicRulesToDict,\n  buildDictionaryRules,\n} from \"./modules/dictionary.js\";\nimport {\n  loadAddressDict,\n  loadTownAddressDict,\n  renderAddressPrefectureFilters,\n  updateAddressDict,\n  resetAddressDict,\n  renderAddressSearchResults,\n  handlePrefectureSelectionChange,\n  setAllPrefecturesSelection,\n  buildAddressRules,\n} from \"./modules/address.js\";\nimport {\n  renderPresetOptions,\n  savePreset,\n  savePresetWithPayload,\n  loadPreset,\n  deletePreset,\n  resolveExportName,\n} from \"./modules/preset.js\";\nimport {\n  exportPresetToFile,\n  importPresetFromFile,\n  saveMaskedOutput,\n  savePlainOutput,\n  loadPlainTextFile,\n  copyOutput,\n} from \"./modules/io.js\";\nimport { maskText, scheduleMask } from \"./modules/masking.js\";\n\n/**\n * 入力欄をクリア\n */\nfunction clearInput() {\n  ui.inputText.value = \"\";\n  ui.outputText.value = \"\";\n  if (ui.sampleSelect) {\n    ui.sampleSelect.value = \"\";\n  }\n  updateStatusDisplay(\"\");\n  persistState(readDictRows);\n  setCurrentMaskDictionary(null);\n  setCurrentUnmaskDictionary(null);\n  updateUnmaskDictStatus(null);\n}\n\n/**\n * テキストエリアの高さを同期\n */\nfunction initTextareaSync() {\n  if (!ui.inputText || !ui.outputText) {\n    return;\n  }\n  let syncing = false;\n  const applyHeight = (source, target) => {\n    if (syncing) {\n      return;\n    }\n    syncing = true;\n    target.style.height = `${source.offsetHeight}px`;\n    syncing = false;\n  };\n\n  if (typeof ResizeObserver !== \"undefined\") {\n    const observer = new ResizeObserver((entries) => {\n      entries.forEach((entry) => {\n        if (entry.target === ui.inputText) {\n          applyHeight(ui.inputText, ui.outputText);\n        } else if (entry.target === ui.outputText) {\n          applyHeight(ui.outputText, ui.inputText);\n        }\n      });\n    });\n    observer.observe(ui.inputText);\n    observer.observe(ui.outputText);\n  } else {\n    ui.inputText.addEventListener(\"mouseup\", () =>\n      applyHeight(ui.inputText, ui.outputText)\n    );\n    ui.outputText.addEventListener(\"mouseup\", () =>\n      applyHeight(ui.outputText, ui.inputText)\n    );\n    ui.inputText.addEventListener(\"touchend\", () =>\n      applyHeight(ui.inputText, ui.outputText)\n    );\n    ui.outputText.addEventListener(\"touchend\", () =>\n      applyHeight(ui.outputText, ui.inputText)\n    );\n  }\n}\n\n/**\n * テキストエリアのスクロールを同期\n */\nfunction initScrollSync() {\n  if (!ui.inputText || !ui.outputText) {\n    return;\n  }\n  let syncing = false;\n  const syncScroll = (source, target) => {\n    if (syncing) {\n      return;\n    }\n    syncing = true;\n    target.scrollTop = source.scrollTop;\n    target.scrollLeft = source.scrollLeft;\n    syncing = false;\n  };\n\n  ui.inputText.addEventListener(\"scroll\", () =>\n    syncScroll(ui.inputText, ui.outputText)\n  );\n  ui.outputText.addEventListener(\"scroll\", () =>\n    syncScroll(ui.outputText, ui.inputText)\n  );\n}\n\n/**\n * タブの切り替えを初期化\n */\nfunction initTabs() {\n  ui.tabs.forEach((tab) => {\n    tab.addEventListener(\"click\", () => {\n      const target = tab.dataset.tab;\n      ui.tabs.forEach((btn) => {\n        btn.classList.toggle(\"is-active\", btn === tab);\n        btn.setAttribute(\"aria-selected\", btn === tab ? \"true\" : \"false\");\n      });\n      ui.tabPanels.forEach((panel) => {\n        panel.classList.toggle(\"is-active\", panel.dataset.tabPanel === target);\n      });\n      if (ui.appStats) {\n        ui.appStats.classList.toggle(\"is-hidden\", target !== \"work\");\n      }\n      if (target !== \"work\") {\n        updateStatusDisplay(\"\");\n      }\n    });\n  });\n}\n\n/**\n * プリセットパネルの開閉\n * @param {boolean} isOpen - 開くかどうか\n */\nfunction setPresetPanelOpen(isOpen) {\n  if (!ui.presetDock || !ui.presetToggle || !ui.presetPanel) {\n    return;\n  }\n  ui.presetDock.classList.toggle(\"is-open\", Boolean(isOpen));\n  ui.presetToggle.setAttribute(\"aria-expanded\", isOpen ? \"true\" : \"false\");\n  ui.presetPanel.setAttribute(\"aria-hidden\", isOpen ? \"false\" : \"true\");\n}\n\n/**\n * アプリケーション初期化\n */\nfunction init() {\n  // ブランド設定を適用\n  applyBrandConfig();\n\n  // 動的に値を取得できるようにgetterを定義（masking.js で使用）\n  Object.defineProperty(window, 'currentMaskDictionary', {\n    get: () => stateVars.currentMaskDictionary,\n    set: (value) => setCurrentMaskDictionary(value)\n  });\n\n  Object.defineProperty(window, 'currentUnmaskDictionary', {\n    get: () => stateVars.currentUnmaskDictionary,\n    set: (value) => setCurrentUnmaskDictionary(value)\n  });\n\n  // masking.js から参照されるため、グローバルに公開\n  window.updateUnmaskDictStatus = updateUnmaskDictStatus;\n\n  // state.rules を baseRules で初期化\n  state.rules = baseRules.map((rule) => ({ ...rule, enabled: true }));\n\n  // 状態の復元\n  const { dictRowsData, needsRulesRender } = restoreState(baseRules);\n\n  // 辞書行の復元\n  if (ui.dictRows && ui.dictRows.children.length === 0) {\n    renderDictRows(dictRowsData || [], scheduleMask);\n  }\n\n  // ルールの描画\n  renderRules(readDictRows, scheduleMask);\n\n  // プリセットオプションの描画\n  renderPresetOptions();\n\n  // 住所都道府県フィルターの描画\n  renderAddressPrefectureFilters();\n\n  // 住所辞書の初期化\n  loadAddressDict();\n  loadTownAddressDict();\n\n  // マスク/マスク解除ボタン\n  if (ui.maskForwardBtn) {\n    ui.maskForwardBtn.addEventListener(\"click\", () => maskText(buildDictionaryRules, buildAddressRules));\n  }\n  if (ui.unmaskBackwardBtn) {\n    ui.unmaskBackwardBtn.addEventListener(\"click\", () => {\n      unmaskText(stateVars.currentUnmaskDictionary);\n    });\n  }\n\n  // コピー/クリアボタン\n  if (ui.copyBtn) {\n    ui.copyBtn.addEventListener(\"click\", copyOutput);\n  }\n  if (ui.clearBtn) {\n    ui.clearBtn.addEventListener(\"click\", clearInput);\n  }\n\n  // テキストエリア同期\n  initTextareaSync();\n  initScrollSync();\n\n  // サンプル選択\n  if (ui.sampleSelect) {\n    ui.sampleSelect.addEventListener(\"change\", () => {\n      const key = ui.sampleSelect.value;\n      if (key && SAMPLE_DATA[key]) {\n        ui.inputText.value = SAMPLE_DATA[key];\n        persistState(readDictRows);\n      }\n    });\n  }\n\n  // プリセット管理\n  ui.presetSave.addEventListener(\"click\", () =>\n    savePreset(readDictRows)\n  );\n  ui.presetLoad.addEventListener(\"click\", () =>\n    loadPreset(\n      baseRules,\n      renderRules,\n      renderDictRows,\n      readDictRows,\n      scheduleMask\n    )\n  );\n  ui.presetDelete.addEventListener(\"click\", deletePreset);\n  ui.presetExport.addEventListener(\"click\", () =>\n    exportPresetToFile(resolveExportName, readDictRows)\n  );\n  ui.presetImport.addEventListener(\"click\", () => ui.presetImportFile.click());\n  ui.presetImportFile.addEventListener(\"change\", () => {\n    importPresetFromFile(\n      ui.presetImportFile.files?.[0],\n      baseRules,\n      renderRules,\n      renderDictRows,\n      readDictRows,\n      scheduleMask\n    );\n  });\n  ui.presetSelect.addEventListener(\"change\", () => {\n    ui.presetName.value = ui.presetSelect.value;\n  });\n\n  // 入力テキスト変更時\n  ui.inputText.addEventListener(\"input\", () => {\n    persistState(readDictRows);\n  });\n\n  // 連番桁数変更時\n  ui.numberWidth.addEventListener(\"change\", () => {\n    persistState(readDictRows);\n    scheduleMask();\n  });\n\n  // ランダムセッションID設定\n  if (ui.useRandomSessionId) {\n    ui.useRandomSessionId.addEventListener(\"change\", () => {\n      updateSessionIdControls();\n      persistState(readDictRows);\n      scheduleMask();\n    });\n  }\n  if (ui.regenSessionId) {\n    ui.regenSessionId.addEventListener(\"click\", () =>\n      regenerateSessionId(maskText)\n    );\n  }\n\n  // 保存ボタン\n  if (ui.saveMaskedTextBtn) {\n    ui.saveMaskedTextBtn.addEventListener(\"click\", saveMaskedOutput);\n  }\n  if (ui.savePlainTextBtn) {\n    ui.savePlainTextBtn.addEventListener(\"click\", savePlainOutput);\n  }\n\n  // テキストファイル読み込み\n  if (ui.plainTextUploadBtn && ui.plainTextFile) {\n    ui.plainTextUploadBtn.addEventListener(\"click\", () => {\n      ui.plainTextFile.click();\n    });\n    ui.plainTextFile.addEventListener(\"change\", () => {\n      loadPlainTextFile(ui.plainTextFile.files?.[0], readDictRows);\n      ui.plainTextFile.value = \"\";\n    });\n  }\n\n  // 辞書管理\n  if (ui.dictAddRow) {\n    ui.dictAddRow.addEventListener(\"click\", () => {\n      addDictRow(\n        { enabled: true, prefix: \"\", pattern: \"\", regex: false },\n        scheduleMask\n      );\n    });\n  }\n  if (ui.dictImportBasic) {\n    ui.dictImportBasic.addEventListener(\"click\", () =>\n      importBasicRulesToDict(\n        renderRules,\n        scheduleMask,\n        savePresetWithPayload,\n        buildStatePayload\n      )\n    );\n  }\n  ui.dictDefaultPrefix.addEventListener(\"input\", () => {\n    persistState(readDictRows);\n    scheduleMask();\n  });\n\n  // ルール管理\n  ui.toggleAllBtn.addEventListener(\"click\", () =>\n    toggleAllRules(readDictRows, scheduleMask)\n  );\n  ui.resetOrderBtn.addEventListener(\"click\", () =>\n    resetRuleOrder(readDictRows, scheduleMask)\n  );\n\n  // 住所辞書のイベントリスナー\n  if (ui.useAddressDict) {\n    ui.useAddressDict.addEventListener(\"change\", scheduleMask);\n  }\n  if (ui.updateAddressDict) {\n    ui.updateAddressDict.addEventListener(\"click\", () =>\n      updateAddressDict()\n    );\n  }\n  if (ui.resetAddressDict) {\n    ui.resetAddressDict.addEventListener(\"click\", () =>\n      resetAddressDict(scheduleMask)\n    );\n  }\n  if (ui.addressSearchInput) {\n    ui.addressSearchInput.addEventListener(\"input\", () => {\n      renderAddressSearchResults();\n    });\n  }\n  if (ui.addressPrefectureList) {\n    ui.addressPrefectureList.addEventListener(\"change\", (event) => {\n      const target = event.target;\n      if (target instanceof HTMLInputElement && target.dataset.prefecture) {\n        handlePrefectureSelectionChange(\n          target.dataset.prefecture,\n          target.checked,\n          scheduleMask\n        );\n      }\n    });\n  }\n  if (ui.addressPrefAll) {\n    ui.addressPrefAll.addEventListener(\"click\", () => {\n      setAllPrefecturesSelection(true, scheduleMask);\n    });\n  }\n  if (ui.addressPrefNone) {\n    ui.addressPrefNone.addEventListener(\"click\", () => {\n      setAllPrefecturesSelection(false, scheduleMask);\n    });\n  }\n\n  // プリセットパネル\n  if (ui.presetToggle) {\n    ui.presetToggle.addEventListener(\"click\", () => {\n      const isOpen = ui.presetDock?.classList.contains(\"is-open\");\n      setPresetPanelOpen(!isOpen);\n    });\n  }\n  if (ui.presetClose) {\n    ui.presetClose.addEventListener(\"click\", () => {\n      setPresetPanelOpen(false);\n    });\n  }\n\n  // 状態保存とマスク実行\n  persistState(readDictRows);\n  scheduleMask();\n\n  // タブ初期化\n  initTabs();\n\n  // セッションIDコントロール更新\n  updateSessionIdControls();\n\n  // マスク解除機能の初期化\n  initUnmaskFeatures();\n}\n\n// DOMContentLoadedで初期化\nif (document.readyState === \"loading\") {\n  document.addEventListener(\"DOMContentLoaded\", init);\n} else {\n  init();\n}\n"],"names":["ui","updateStatusDisplay","message","isError","updateDictTableStatusDisplay","updatePresetStatusDisplay","brandConfig","getBrandConfig","getAppFilenameBase","setText","id","value","el","setLink","url","label","applyBrandConfig","config","lede","STORAGE_KEY","PRESET_KEY","ADDRESS_DICT_CUSTOM_KEY","ADDRESS_PREF_SELECTION_KEY","ADDRESS_DICT_LOCAL_URL","ADDRESS_TOWN_DICT_URL","GEOLONIA_API_URL","ASYNC_MASK_THRESHOLD","COPY_FEEDBACK_DURATION_MS","SESSION_ID_LENGTH","ADDRESS_PATTERN_CHUNK_SIZE","ADDRESS_SEARCH_LIMIT","DICT_IMPORT_BACKUP_PREFIX","ADDRESS_PREFECTURES","ADDRESS_PREFECTURES_SORTED","left","right","addressPatterns","addressPatternChunks","addressCityPatterns","addressCityPatternsByPref","addressTownPatternsByPref","addressTownPrefectures","addressDictLoadPromise","addressTownDictLoadPromise","addressSelectedPrefs","currentSessionId","currentMaskDictionary","currentUnmaskDictionary","maskRunId","state","buildStatePayload","readDictRows","_a","rule","applyStatePayload","payload","baseRules","dictRowsData","needsRulesRender","enabledMap","orderMap","name","idx","a","b","aPos","bPos","buildPresetPayload","persistState","err","restoreState","raw","setAddressPatterns","setAddressPatternChunks","setAddressCityPatterns","setAddressCityPatternsByPref","setAddressTownPatternsByPref","setAddressTownPrefectures","setAddressDictLoadPromise","setAddressTownDictLoadPromise","setAddressSelectedPrefs","setCurrentSessionId","setCurrentMaskDictionary","setCurrentUnmaskDictionary","incrementMaskRunId","sanitizeFileName","formatTimestampForFilename","date","pad","saveMaskedOutput","timestamp","baseName","blob","link","savePlainOutput","loadPlainTextFile","file","reader","content","parseImportedPayload","exportPresetToFile","resolveExportName","exportPayload","importPresetFromFile","renderRules","renderDictRows","scheduleMask","data","parsed","result","copyOutput","downloadDictionary","stateVars.currentMaskDictionary","signature","updateUnmaskDictStatus","getUnmaskSource","getUnmaskTarget","unmaskText","dictionary","source","target","input","updateUnmaskStatusDisplay","output","stats","mask","original","escapedMask","regex","matches","totalCount","sum","s","dict","normalized","loadUnmaskTextFile","stateVars.currentUnmaskDictionary","loadDictionaryFile","computed","setupDropZone","zone","handler","onDragOver","event","onDragLeave","onDrop","_b","initUnmaskFeatures","RULE_EXAMPLES","SAMPLE_DATA","fragment","index","wrapper","handle","checkbox","span","example","exampleText","initRuleDrag","items","dragIndex","placeholder","lastDropIndex","lastInsertBefore","ensurePlaceholder","removePlaceholder","clearIndicators","node","item","rect","isBefore","dropIndex","insertTarget","moved","insertIndex","toggleAllRules","shouldEnable","resetRuleOrder","existing","generateSessionId","chars","i","getNumberWidth","regenerateSessionId","maskText","newId","updateSessionIdControls","MaskingEngine","normalizeRegexPattern","escapeRegExp","row","_c","_e","_d","_f","getDictDefaultPrefix","trimmed","validatePattern","pattern","buildDictionaryRules","entries","rules","defaultPrefix","hasError","entry","createDictRow","enabled","prefix","regexLabel","removeBtn","attach","eventName","addDictRow","importBasicRulesToDict","savePreset","saveImportBackupPreset","current","formatBackupTimestamp","year","month","day","hours","minutes","DEFAULT_FETCH_IDLE_TIMEOUT_MS","fetchJsonWithTimeout","timeoutMs","controller","timer","response","fetchJsonWithIdleTimeout","idleTimeoutMs","chunks","total","idleTimer","resetIdleTimer","done","buffer","offset","chunk","text","getPrefectureList","stateVars.addressTownPrefectures","loadAddressPrefSelection","prefectures","valid","filtered","pref","saveAddressPrefSelection","selection","syncAddressPrefectureSelection","stateVars.addressSelectedPrefs","renderAddressPrefectureFilters","prefecture","handlePrefectureSelectionChange","isSelected","applyAddressPrefectureFilters","setAllPrefecturesSelection","getPrefectureFromPattern","indexAddressCityPatterns","patterns","map","collectAddressCityPatterns","values","stateVars.addressCityPatternsByPref","collectAddressTownPatterns","stateVars.addressTownPatternsByPref","buildAddressPatternChunks","escapedPatterns","addr","cityPatterns","townPatterns","stateVars.addressPatterns","renderAddressSearchResults","loadAddressDict","custom","loadCustomAddressDict","stateVars.addressCityPatterns","renderAddressDictStatus","stateVars.addressDictLoadPromise","fallback","loadLocalAddressDictFromScript","fallbackErr","loadTownAddressDict","stateVars.addressTownDictLoadPromise","list","resolve","reject","script","info","formatAddressDictVersion","version","match","query","results","limited","suffix","updateAddressDict","buildAddressPatternsFromGeolonia","now","updated","cities","city","resetAddressDict","buildAddressRules","stateVars.addressPatternChunks","prefectureCity","loadPresets","savePresets","renderPresetOptions","presets","empty","preset","option","savePresetWithPayload","loadPreset","deletePreset","ADDRESS_BLOCK_PATTERN","buildRuleRegex","PlaceholderMap","computeDictionarySignature","applyRule","placeholders","counts","numberWidth","hits","replaced","applyAddressBlockRules","blockRegex","chunkRegexes","addressPlaceholderRegex","lines","changed","line","head","middle","tail","masked","renderStats","allEntries","key","count","breakdown","attachDictionarySignature","maskTextSync","stateVars.currentSessionId","includeSessionId","dictRules","dictRule","addressRule","maskTextAsync","runId","shouldYield","yieldToBrowser","isLatest","stateVars.maskRunId","addressRules","clearInput","initTextareaSync","syncing","applyHeight","observer","initScrollSync","syncScroll","initTabs","tab","btn","panel","setPresetPanelOpen","isOpen","init"],"mappings":"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ACA,YACA,sCACA,iCACA,mBACA,+CACA,GACA,gBACA,sCACA,+BACA,mBACA,oDACA,GACA,cACA,sCACA,gCACA,mBACA,+CACA,GACA,YACA,kCACA,8BACA,mBACA,iDACA,GACA,YACA,qCACA,gCACA,mBACA,oDACA,GACA,aACA,yCACA,oCACA,mBACA,qDACJ,EAAI,KAAK;AAAA,CAAI,EACX,OAAQ,CACN,wCACA,uBACA,0BACA,qCACA,mBACA,4BACA,wBACA,GACA,sCACA,sBACA,2BACA,gCACA,mBACA,4BACA,6BACA,GACA,oCACA,kBACA,4BACA,iCACA,mBACA,4BACA,0BACA,GACA,oCACA,sBACA,2BACA,mCACA,mBACA,4BACA,0BACA,GACA,kCACA,qBACA,0BACA,uCACA,mBACA,4BACA,2BACA,GACA,wCACA,uBACA,4BACA,kCACA,mBACA,4BACA,2BACA,GACA,wCACA,uBACA,0BACA,kCACA,mBACA,4BACA,2BACA,GACA,0CACA,yBACA,8BACA,mCACA,mBACA,4BACA,2BACA,GACA,wCACA,oBACA,0BACA,kCACA,mBACA,4BACA,2BACA,GACA,sCACA,wBACA,8BACA,iCACA,mBACA,4BACA,0BACJ,EAAI,KAAK;AAAA,CAAI,EACX,QAAS,CACP,eACA,yCACA,cACA,qBACA,qBACA,gCACA,yBACA,GACA,eACA,sCACA,aACA,sBACA,qBACA,+BACA,yBACA,GACA,eACA,oCACA,YACA,mBACA,qBACA,+BACA,yBACA,GACA,eACA,mCACA,gBACA,qBACA,qBACA,+BACA,yBACA,GACA,eACA,wCACA,kBACA,sBACA,qBACA,+BACA,yBACA,GACA,eACA,wCACA,iBACA,mBACA,qBACA,+BACA,yBACA,GACA,eACA,oCACA,cACA,sBACA,qBACA,gCACA,yBACA,GACA,eACA,sCACA,iBACA,sBACA,qBACA,kCACA,yBACA,GACA,eACA,uCACA,YACA,oBACA,qBACA,gCACA,yBACA,GACA,eACA,sCACA,gBACA,sBACA,qBACA,+BACA,wBACJ,EAAI,KAAK;A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"}