(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const n={inputText:document.getElementById("inputText"),outputText:document.getElementById("outputText"),maskForwardBtn:document.getElementById("maskForwardBtn"),unmaskBackwardBtn:document.getElementById("unmaskBackwardBtn"),savePlainTextBtn:document.getElementById("savePlainTextBtn"),plainTextUploadBtn:document.getElementById("plainTextUploadBtn"),plainTextFile:document.getElementById("plainTextFile"),maskedTextUploadBtn:document.getElementById("maskedTextUploadBtn"),unmaskDictUploadBtn:document.getElementById("unmaskDictUploadBtn"),unmaskDictStatus:document.getElementById("unmaskDictStatus"),copyBtn:document.getElementById("copyBtn"),clearBtn:document.getElementById("clearBtn"),sampleSelect:document.getElementById("sampleSelect"),numberWidthRow:document.getElementById("numberWidthRow"),numberWidth:document.getElementById("numberWidth"),useRandomSessionId:document.getElementById("useRandomSessionId"),regenSessionId:document.getElementById("regenSessionId"),dictDefaultPrefix:document.getElementById("dictDefaultPrefix"),dictRows:document.getElementById("dictRows"),dictAddRow:document.getElementById("dictAddRow"),dictImportBasic:document.getElementById("dictImportBasic"),dictTableStatus:document.getElementById("dictTableStatus"),ruleList:document.getElementById("ruleList"),toggleAllBtn:document.getElementById("toggleAllBtn"),resetOrderBtn:document.getElementById("resetOrderBtn"),presetSelect:document.getElementById("presetSelect"),presetLoad:document.getElementById("presetLoad"),presetDelete:document.getElementById("presetDelete"),presetName:document.getElementById("presetName"),presetSave:document.getElementById("presetSave"),presetDock:document.getElementById("presetDock"),presetToggle:document.getElementById("presetToggle"),presetPanel:document.getElementById("presetPanel"),presetClose:document.getElementById("presetClose"),presetExport:document.getElementById("presetExport"),presetImport:document.getElementById("presetImport"),presetImportFile:document.getElementById("presetImportFile"),presetStatus:document.getElementById("presetStatus"),stats:document.getElementById("stats"),appStats:document.getElementById("appStats"),saveMaskedTextBtn:document.getElementById("saveMaskedTextBtn"),tabs:document.querySelectorAll(".tab"),tabPanels:document.querySelectorAll(".tab-panel"),useAddressDict:document.getElementById("useAddressDict"),addressDictVersion:document.getElementById("addressDictVersion"),addressDictSource:document.getElementById("addressDictSource"),addressDictCount:document.getElementById("addressDictCount"),addressDictUpdated:document.getElementById("addressDictUpdated"),addressTownDictStatus:document.getElementById("addressTownDictStatus"),addressPrefectureList:document.getElementById("addressPrefectureList"),addressPrefAll:document.getElementById("addressPrefAll"),addressPrefNone:document.getElementById("addressPrefNone"),addressSearchInput:document.getElementById("addressSearchInput"),addressSearchResults:document.getElementById("addressSearchResults"),updateAddressDict:document.getElementById("updateAddressDict"),resetAddressDict:document.getElementById("resetAddressDict"),downloadDictBtn:document.getElementById("downloadDictBtn"),unmaskTextFile:document.getElementById("unmaskTextFile"),unmaskTextDrop:document.getElementById("unmaskTextDrop"),unmaskDictFile:document.getElementById("unmaskDictFile"),unmaskDictDrop:document.getElementById("unmaskDictDrop"),unmaskStats:document.getElementById("unmaskStats")};function f(e,t=!1){n.stats.textContent=e,n.stats.classList.toggle("error",t)}function me(e){n.dictTableStatus&&(n.dictTableStatus.textContent=e||"")}function P(e,t=!1){n.presetStatus&&(n.presetStatus.textContent=e||"",n.presetStatus.classList.toggle("error",t))}const fe={company:{productName:"TextMasker",pageTitle:"TextMasker - 簡単秘匿情報マスキング",logoText:"TextMasker",eyebrow:"簡単秘匿情報マスキング",ledeLines:["業務で扱う機密情報を、ブラウザ内で安全にマスキングします。","外部へのデータ送信は行っておりませんので、ローカルにダウンロードしたりインターネット接続がなくても動作します。"],demoUrl:"https://igu0j4i21yo12u.github.io/texmask/",demoLabel:"デモサイト",repoUrl:"https://github.com/igu0j4i21yo12u/texmask",repoLabel:"GitHub",footerText:"",footerLinkUrl:"https://x.com/igu0j4i21yo12u",footerLinkLabel:"TextMasker"},personal:{productName:"TexMask",pageTitle:"TexMask - ブラウザで楽々マスキング！",logoText:"TexMask",eyebrow:"ブラウザで楽々マスキング！",ledeLines:["AIに秘匿情報を送ったりしていませんか？","このツールで秘匿化してから送ったほうが安心ですよ！","外部へのデータ送信は行っておりませんので、ローカルにダウンロードしたりインターネット接続がなくても動作します。"],demoUrl:"https://igu0j4i21yo12u.github.io/texmask/",demoLabel:"デモサイト",repoUrl:"https://github.com/igu0j4i21yo12u/texmask",repoLabel:"GitHub",footerText:"igu0j4i21yo12u.",footerLinkUrl:"https://github.com/igu0j4i21yo12u",footerLinkLabel:"TexMask"}},tt="personal";function Re(){return fe[tt]||fe.personal}function ee(){return Re().productName||"TexMask"}function K(e,t){if(!t)return;const r=document.getElementById(e);r&&(r.textContent=t)}function Y(e,t,r){const a=document.getElementById(e);if(a){if(!t){a.hidden=!0;return}a.href=t,r&&(a.textContent=r),a.hidden=!1}}function nt(){const e=Re();document.title=e.pageTitle||e.productName||document.title,K("brandTitle",e.logoText||e.productName),K("brandEyebrow",e.eyebrow);const t=document.getElementById("brandLede");t&&Array.isArray(e.ledeLines)&&(t.textContent=e.ledeLines.join(`
`)),Y("demoLink",e.demoUrl,e.demoLabel||"デモサイト"),Y("repoLink",e.repoUrl,e.repoLabel||"GitHub"),K("footerText",e.footerText),Y("footerLink",e.footerLinkUrl,e.footerLinkLabel)}const Pe="masking-web-state-v1",Be="masking-web-presets-v1",te="masking-web-address-dict-custom-v1",Ce="masking-web-address-pref-selection-v1",rt="address-dict.json",at="address-town-dict.json",st="https://geolonia.github.io/japanese-addresses/api/ja.json",Fe=2e4,ge=1200,ot=4,he=2e3,xe=50,it="転記前バックアップ",Ne=["北海道","青森県","岩手県","宮城県","秋田県","山形県","福島県","茨城県","栃木県","群馬県","埼玉県","千葉県","東京都","神奈川県","新潟県","富山県","石川県","福井県","山梨県","長野県","岐阜県","静岡県","愛知県","三重県","滋賀県","京都府","大阪府","兵庫県","奈良県","和歌山県","鳥取県","島根県","岡山県","広島県","山口県","徳島県","香川県","愛媛県","高知県","福岡県","佐賀県","長崎県","熊本県","大分県","宮崎県","鹿児島県","沖縄県"],ct=[...Ne].sort((e,t)=>t.length-e.length);let ne=null,U=[],I=null,Oe=new Map,V=null,z=null,G=null,Q=null,b=null,j=null,v=null,B=null,q=0;const h={rules:[]};function re(e){var t;return{inputText:n.inputText.value,sampleSelect:n.sampleSelect.value,useRandomSessionId:((t=n.useRandomSessionId)==null?void 0:t.checked)??!0,numberWidth:n.numberWidth.value,dictDefaultPrefix:n.dictDefaultPrefix.value,dictRows:e?e():[],rules:h.rules.map(r=>({name:r.name,enabled:r.enabled})),rulesOrder:h.rules.map(r=>r.name)}}function ae(e,t){if(!e||typeof e!="object")return{dictRowsData:null,needsRulesRender:!1};let r=null,a=!1;if(typeof e.inputText=="string"&&(n.inputText.value=e.inputText),typeof e.sampleSelect=="string"&&(n.sampleSelect.value=e.sampleSelect),typeof e.useRandomSessionId=="boolean"&&n.useRandomSessionId&&(n.useRandomSessionId.checked=e.useRandomSessionId),typeof e.numberWidth=="string"&&(n.numberWidth.value=e.numberWidth),typeof e.dictDefaultPrefix=="string"&&(n.dictDefaultPrefix.value=e.dictDefaultPrefix),Array.isArray(e.dictRows)&&(r=e.dictRows),Array.isArray(e.rules)&&t){const s=new Map(e.rules.map(o=>[o.name,o.enabled]));h.rules=t.map(o=>({...o,enabled:s.has(o.name)?s.get(o.name):!0})),a=!0}if(Array.isArray(e.rulesOrder)){const s=new Map(e.rulesOrder.map((o,i)=>[o,i]));h.rules.sort((o,i)=>{const c=s.has(o.name)?s.get(o.name):Number.MAX_SAFE_INTEGER,l=s.has(i.name)?s.get(i.name):Number.MAX_SAFE_INTEGER;return c-l})}return{dictRowsData:r,needsRulesRender:a}}function X(e){const t=re(e);return t.inputText="",t.sampleSelect="",t}function x(e){try{const t=re(e);localStorage.setItem(Pe,JSON.stringify(t))}catch(t){console.warn("Failed to persist state to localStorage:",t)}}function dt(e){try{const t=localStorage.getItem(Pe);if(!t)return{dictRowsData:null,needsRulesRender:!1};const r=JSON.parse(t);return ae(r,e)}catch(t){return console.warn("Failed to restore state from localStorage:",t),{dictRowsData:null,needsRulesRender:!1}}}function lt(e){ne=e}function ut(e){U=e}function F(e){I=e}function Ue(e){Oe=e}function pt(e){V=e}function mt(e){z=e}function ye(e){G=e}function Se(e){Q=e}function M(e){b=e}function se(e){j=e}function C(e){v=e}function L(e){B=e}function ft(){return q++,q}function gt(e){return e.replace(/[\\/:*?"<>|]/g,"_").trim()||"config"}function oe(e){const t=r=>String(r).padStart(2,"0");return`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}-${t(e.getHours())}${t(e.getMinutes())}`}function ht(){const e=n.outputText.value;if(!e){f("保存するテキストがありません。",!0);return}const t=oe(new Date),r=ee(),a=new Blob([e],{type:"text/plain"}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=`${r}_${t}_masked.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),f("マスク後テキストを保存しました。")}function xt(){const e=n.inputText.value;if(!e){f("保存するテキストがありません。",!0);return}const t=oe(new Date),r=ee(),a=new Blob([e],{type:"text/plain"}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=`${r}_${t}_plain.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),f("テキストを保存しました。")}function yt(e,t){if(!e)return;const r=new FileReader;r.onload=()=>{const a=typeof r.result=="string"?r.result:"";n.inputText.value=a,x(t)},r.onerror=()=>{f("ファイルの読み込みに失敗しました。",!0)},r.readAsText(e,"utf-8")}function St(e){return!e||typeof e!="object"?null:e.payload&&typeof e.payload=="object"?{name:e.name||"",payload:e.payload}:{name:e.name||"",payload:e}}function Et(e,t){const r=e();if(!r){f("設定名を入力してください。",!0);return}const a=X(t),s={name:r,exportedAt:new Date().toISOString(),payload:a},o=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),i=URL.createObjectURL(o),c=document.createElement("a");c.href=i,c.download=`${gt(r)}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(i),f(`設定「${r}」をJSONに保存しました。`)}function bt(e,t,r,a,s,o){if(!e)return;const i=new FileReader;i.onload=()=>{try{const c=JSON.parse(i.result),l=St(c);if(!l||!l.payload)throw new Error("invalid payload");const u=ae(l.payload,t);u.dictRowsData&&a&&a(u.dictRowsData,o),u.needsRulesRender&&r&&r(s,o),x(s),o&&o(),l.name?n.presetName.value=l.name:n.presetName.value="",f("JSON設定を読み込みました。")}catch{f("JSONの読み込みに失敗しました。",!0)}finally{n.presetImportFile.value=""}},i.onerror=()=>{f("JSONの読み込みに失敗しました。",!0),n.presetImportFile.value=""},i.readAsText(e,"utf-8")}async function Dt(){const e=n.outputText.value;if(e)try{await navigator.clipboard.writeText(e),n.copyBtn.textContent="コピー済み",setTimeout(()=>{n.copyBtn.textContent="コピー"},ge)}catch(t){console.warn("Failed to copy to clipboard:",t),n.copyBtn.textContent="失敗",setTimeout(()=>{n.copyBtn.textContent="コピー"},ge)}}async function kt(){var e;if(!v){f("マスク実行後に辞書をダウンロードできます。",!0);return}try{if(!v.signature&&((e=window.MaskingEngine)!=null&&e.computeDictionarySignature)){const o=await window.MaskingEngine.computeDictionarySignature(v);o&&(v.signature=o,_(v))}const t=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),r=URL.createObjectURL(t),a=document.createElement("a");a.href=r;const s=ee();a.download=`${s}_${oe(new Date)}_unmask.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),f("辞書をダウンロードしました。")}catch(t){f("辞書のダウンロードに失敗しました。",!0),console.error("Dictionary download failed:",t)}}function je(){return n.outputText}function vt(){return n.inputText}function ie(e){const t=je(),r=vt();if(!t||!r)return;const a=t.value||"";if(!a.trim()){r.value="",T("入力テキストが空です。");return}if(!e||!e.mappings){r.value="",T("辞書が読み込まれていません。",!0),_(null);return}let s=a;const o=[];for(const[c,l]of Object.entries(e.mappings)){const u=window.MaskingEngine.escapeRegExp(c),d=new RegExp(u,"g"),m=s.match(d);m&&(o.push({mask:c,original:l,count:m.length}),s=s.replace(d,l))}const i=o.reduce((c,l)=>c+l.count,0);r.value=s,T(`マスク解除件数: ${i}`),_(e)}function T(e,t=!1){n.unmaskStats&&(n.unmaskStats.textContent=e,n.unmaskStats.classList.toggle("error",t))}function _(e){if(!n.unmaskDictStatus)return;if(!e){n.unmaskDictStatus.textContent="ID: (なし)";return}if(typeof e.session_id=="string"&&e.session_id){n.unmaskDictStatus.textContent=`ID: ${e.session_id}`;return}const t=e.signature;if(typeof t=="string"&&t.length>0){const r=t.replace(/^sha256:/,"");n.unmaskDictStatus.textContent=`ID: ${r.slice(0,8)}`;return}n.unmaskDictStatus.textContent="ID: (なし)"}function Ee(e){if(!e)return;const t=new FileReader;t.onload=()=>{const r=typeof t.result=="string"?t.result:"",a=je();a&&(a.value=r),B&&ie(B)},t.onerror=()=>{T("テキストファイルの読み込みに失敗しました。",!0)},t.readAsText(e,"utf-8")}async function be(e){if(!e)return;const t=new FileReader;t.onload=async()=>{var r;try{const a=JSON.parse(t.result);if(!a.mappings||typeof a.mappings!="object")throw new Error("辞書フォーマットが不正です");if(a.signature)if((r=window.MaskingEngine)!=null&&r.computeDictionarySignature){const s=await window.MaskingEngine.computeDictionarySignature(a);if(!s||s!==a.signature)throw new Error("辞書の署名が一致しません")}else T("署名の検証に対応していません。",!0);L(a),ie(a),_(a),T("辞書を読み込みました。")}catch(a){T("辞書の読み込みに失敗しました。",!0),console.error("Dictionary load failed:",a),n.unmaskDictFile&&(n.unmaskDictFile.value="")}},t.onerror=()=>{T("辞書の読み込みに失敗しました。",!0),n.unmaskDictFile&&(n.unmaskDictFile.value="")},t.readAsText(e,"utf-8")}function De(e,t,r){if(!e||!t)return;const a=i=>{i.preventDefault(),e.classList.add("is-dragover")},s=()=>{e.classList.remove("is-dragover")},o=i=>{var l,u;i.preventDefault(),e.classList.remove("is-dragover");const c=(u=(l=i.dataTransfer)==null?void 0:l.files)==null?void 0:u[0];c&&r(c)};e.addEventListener("dragover",a),e.addEventListener("dragleave",s),e.addEventListener("drop",o),e.addEventListener("click",()=>t.click()),e.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),t.click())})}function Tt(){n.downloadDictBtn&&n.downloadDictBtn.addEventListener("click",kt),n.maskedTextUploadBtn&&n.unmaskTextFile&&n.maskedTextUploadBtn.addEventListener("click",()=>{n.unmaskTextFile.click()}),n.unmaskDictUploadBtn&&n.unmaskDictFile&&n.unmaskDictUploadBtn.addEventListener("click",()=>{n.unmaskDictFile.click()}),n.unmaskTextFile&&n.unmaskTextFile.addEventListener("change",()=>{var e;Ee((e=n.unmaskTextFile.files)==null?void 0:e[0]),n.unmaskTextFile.value=""}),n.unmaskDictFile&&n.unmaskDictFile.addEventListener("change",()=>{var e;be((e=n.unmaskDictFile.files)==null?void 0:e[0]),n.unmaskDictFile.value=""}),De(n.unmaskTextDrop,n.unmaskTextFile,Ee),De(n.unmaskDictDrop,n.unmaskDictFile,be),_(B)}const wt={ipv4_subnet_pair:"192.168.0.1 255.255.255.0",aws_account_id:"123456789012",azure_subscription_id:"1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",jwt_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxx.yyy",cidr_ipv4:"10.0.0.0/24 / 192.168.1.0/25",cidr_ipv6:"2001:db8::/32 / 2001:db8:1::/48 / 2001:0db8:85a3::/64",ipv6_address:"2001:db8::1 / fe80::1 / 2001:0db8:85a3:0000:0000:8a2e:0370:7334",ip_address:"192.168.0.10 / 10.0.5.12",email:"user@example.com / ops+alert@example.co.jp",fqdn:"app.internal.example.com / db-01.prod.example.co.jp",contract_number:"AB-1234 / XYZ-98765",phone_jp:"03-1234-5678 / 03 1234 5678 / (03)1234-5678 / 0120-123-456 / 090-1234-5678",phone_intl:"+1 212 555 1234 / +44 20 7946 0958 / +81 3 1234 5678 / +49-30-1234-5678",api_key:"XyZ123abcDEF456ghiJKL789mnoPQR012 / abcDEF1234567890GHIJklmnopQRSTuv",gcp_project_id:"sample-prod-001 / personal-ops-2024",postal_code_jp:"100-0001 / 123-4567"},ke={address:["顧客: さくら情報システム","担当: 佐藤 太郎 <taro.sato@example.com>","所在地: 〒100-0001 東京都千代田区千代田1-1","電話: 03-1234-5678","サーバー: web-01.internal.example.com (192.168.0.10)","","顧客: みずほデータサービス","担当: 鈴木 花子 <hanako.suzuki@example.com>","所在地: 〒150-0002 東京都渋谷区渋谷2-2","電話: 03-5678-9012","サーバー: app-02.internal.example.com (10.0.5.12)","","顧客: こだまソリューションズ","担当: 高橋 健 <ken.takahashi@example.com>","所在地: 〒530-0001 大阪府大阪市北区梅田1-1","電話: 06-1234-5678","サーバー: db-01.internal.example.com (172.16.10.20)","","顧客: しらさぎネットワーク","担当: 伊藤 愛 <ai.ito@example.com>","所在地: 〒060-0001 北海道札幌市中央区北1条西1丁目","電話: 011-234-5678","サーバー: cache-03.internal.example.com (192.168.1.25)","","顧客: つばさ工業","担当: 渡辺 翔 <sho.watanabe@example.com>","所在地: 〒460-0002 愛知県名古屋市中区丸の内2-2","電話: 052-123-4567","サーバー: api-01.internal.example.com (10.1.2.3)","","顧客: ひかり情報サービス","担当: 中村 彩 <aya.nakamura@example.com>","所在地: 〒730-0001 広島県広島市中区基町1-1","電話: 082-987-6543","サーバー: app-10.internal.example.com (192.168.10.10)","","顧客: さつきリサーチ","担当: 小林 優 <yu.kobayashi@example.com>","所在地: 〒980-0001 宮城県仙台市青葉区中央1-1","電話: 022-555-0101","サーバー: web-08.internal.example.com (10.2.3.4)","","顧客: みなみ物流","担当: 加藤 海 <kai.kato@example.com>","所在地: 〒900-0001 沖縄県那覇市久茂地1-1","電話: 098-123-4567","サーバー: log-05.internal.example.com (172.20.0.5)","","顧客: やまと通信","担当: 吉田 凛 <rin.yoshida@example.com>","所在地: 〒810-0001 福岡県福岡市中央区天神1-1","電話: 092-111-2222","サーバー: proxy-02.internal.example.com (192.168.5.5)","","顧客: もみじテクノ","担当: 山本 悠 <haruka.yamamoto@example.com>","所在地: 〒220-0001 神奈川県横浜市西区みなとみらい1-1","電話: 045-333-4444","サーバー: gateway-01.internal.example.com (10.10.10.10)"].join(`
`),config:["primary_host=app.internal.example.com","primary_ip=10.0.5.12","backup_cidr=10.0.0.0/24","support_email=helpdesk@example.com","contract=AB-1234","office_phone=03-9999-0000","ipv6_host=2001:db8::1","","auth_host=auth.internal.example.com","auth_ip=172.16.0.15","api_cidr=192.168.10.0/24","incident_mail=ops@example.com","contract=ZX-7788","office_phone=06-2222-3333","ipv6_host=2001:db8:abcd::5","","log_host=log.internal.example.com","log_ip=10.2.3.4","backup_cidr=172.20.0.0/16","support_email=desk@example.com","contract=CD-5678","office_phone=052-111-2222","ipv6_host=2001:db8:1::7","","vpn_host=vpn.internal.example.com","vpn_ip=203.0.113.14","backup_cidr=192.0.2.0/24","support_email=netops@example.com","contract=EF-9012","office_phone=045-123-9876","ipv6_host=2001:db8:2::9","","db_host=db.internal.example.com","db_ip=192.168.1.25","backup_cidr=10.1.0.0/16","support_email=db-support@example.com","contract=GH-3456","office_phone=092-555-0101","ipv6_host=2001:db8:3::11","","cache_host=cache.internal.example.com","cache_ip=10.10.10.10","backup_cidr=172.18.0.0/16","support_email=cache@example.com","contract=JK-7890","office_phone=011-777-8888","ipv6_host=2001:db8:4::13","","proxy_host=proxy.internal.example.com","proxy_ip=192.168.5.5","backup_cidr=10.3.0.0/16","support_email=proxy@example.com","contract=LM-2468","office_phone=098-333-4444","ipv6_host=2001:db8:5::15","","report_host=report.internal.example.com","report_ip=172.16.10.20","backup_cidr=192.168.20.0/24","support_email=report@example.com","contract=NP-1357","office_phone=022-111-2222","ipv6_host=2001:db8:6::17","","batch_host=batch.internal.example.com","batch_ip=10.4.5.6","backup_cidr=10.5.0.0/16","support_email=batch@example.com","contract=QR-9753","office_phone=082-555-6677","ipv6_host=2001:db8:7::19","","edge_host=edge.internal.example.com","edge_ip=203.0.113.120","backup_cidr=198.51.100.0/24","support_email=edge@example.com","contract=ST-8642","office_phone=03-5555-6666","ipv6_host=2001:db8:8::21"].join(`
`),support:["件名: VPN接続不具合","申請者: 山田 花子 <hanako.yamada@example.com>","会社: ひまわりソフト","対象IP: 203.0.113.14","連絡先: 080-1111-2222","FQDN: vpn.support.example.com","発生時刻: 2024-06-18 09:15","","件名: VPN接続不具合","申請者: 斎藤 修 <osamu.saito@example.com>","会社: きらりテクノ","対象IP: 198.51.100.45","連絡先: 090-3333-4444","FQDN: vpn.kirari.example.com","発生時刻: 2024-06-18 10:42","","件名: VPN接続不具合","申請者: 井上 直 <nao.inoue@example.com>","会社: みなと通信","対象IP: 192.0.2.23","連絡先: 070-5555-6666","FQDN: vpn.minato.example.com","発生時刻: 2024-06-18 11:05","","件名: VPN接続不具合","申請者: 森 結衣 <yui.mori@example.com>","会社: さくら情報システム","対象IP: 203.0.113.88","連絡先: 080-7777-8888","FQDN: vpn.sakura.example.com","発生時刻: 2024-06-18 11:47","","件名: VPN接続不具合","申請者: 山口 慧 <kei.yamaguchi@example.com>","会社: こだまソリューションズ","対象IP: 198.51.100.99","連絡先: 090-9999-0000","FQDN: vpn.kodama.example.com","発生時刻: 2024-06-18 12:30","","件名: VPN接続不具合","申請者: 木村 光 <hikaru.kimura@example.com>","会社: みずほデータサービス","対象IP: 192.0.2.77","連絡先: 070-1111-2222","FQDN: vpn.mizuho.example.com","発生時刻: 2024-06-18 13:05","","件名: VPN接続不具合","申請者: 池田 玲 <rei.ikeda@example.com>","会社: さつきリサーチ","対象IP: 203.0.113.150","連絡先: 080-2222-3333","FQDN: vpn.satsuki.example.com","発生時刻: 2024-06-18 13:42","","件名: VPN接続不具合","申請者: 石井 新 <arata.ishii@example.com>","会社: しらさぎネットワーク","対象IP: 198.51.100.10","連絡先: 090-4444-5555","FQDN: vpn.shirasagi.example.com","発生時刻: 2024-06-18 14:25","","件名: VPN接続不具合","申請者: 小川 渚 <nagisa.ogawa@example.com>","会社: つばさ工業","対象IP: 192.0.2.100","連絡先: 080-6666-7777","FQDN: vpn.tsubasa.example.com","発生時刻: 2024-06-18 15:10","","件名: VPN接続不具合","申請者: 高田 陸 <riku.takada@example.com>","会社: ひかり情報サービス","対象IP: 203.0.113.200","連絡先: 090-8888-9999","FQDN: vpn.hikari.example.com","発生時刻: 2024-06-18 16:00"].join(`
`)},N=[{name:"ipv4_subnet_pair",label:"IPv4 + Subnet",pattern:"\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\s+(?:255|254|252|248|240|224|192|128|0)\\.(?:255|254|252|248|240|224|192|128|0)\\.(?:255|254|252|248|240|224|192|128|0)\\.(?:255|254|252|248|240|224|192|128|0)\\b",mode:"pseudonymize",prefix:"SUBNET"},{name:"cidr_ipv4",label:"CIDR v4",pattern:"\\b(?:\\d{1,3}\\.){3}\\d{1,3}/\\d{1,2}\\b",mode:"pseudonymize",prefix:"CIDR"},{name:"cidr_ipv6",label:"CIDR v6",pattern:"(?i)(?<![A-F0-9:])(?:(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,7}:|(?:[A-F0-9]{1,4}:){1,6}:[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,5}(?::[A-F0-9]{1,4}){1,2}|(?:[A-F0-9]{1,4}:){1,4}(?::[A-F0-9]{1,4}){1,3}|(?:[A-F0-9]{1,4}:){1,3}(?::[A-F0-9]{1,4}){1,4}|(?:[A-F0-9]{1,4}:){1,2}(?::[A-F0-9]{1,4}){1,5}|[A-F0-9]{1,4}:(?:(?::[A-F0-9]{1,4}){1,6})|:(?:(?::[A-F0-9]{1,4}){1,7}|:))/\\d{1,3}(?![A-F0-9:])",mode:"pseudonymize",prefix:"CIDR6"},{name:"ipv6_address",label:"IPv6",pattern:"(?i)(?<![A-F0-9:])(?:(?:[A-F0-9]{1,4}:){7}[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,7}:|(?:[A-F0-9]{1,4}:){1,6}:[A-F0-9]{1,4}|(?:[A-F0-9]{1,4}:){1,5}(?::[A-F0-9]{1,4}){1,2}|(?:[A-F0-9]{1,4}:){1,4}(?::[A-F0-9]{1,4}){1,3}|(?:[A-F0-9]{1,4}:){1,3}(?::[A-F0-9]{1,4}){1,4}|(?:[A-F0-9]{1,4}:){1,2}(?::[A-F0-9]{1,4}){1,5}|[A-F0-9]{1,4}:(?:(?::[A-F0-9]{1,4}){1,6})|:(?:(?::[A-F0-9]{1,4}){1,7}|:))(?![A-F0-9:])",mode:"pseudonymize",prefix:"IPV6"},{name:"ip_address",label:"IPv4",pattern:"\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b",mode:"pseudonymize",prefix:"IPv4"},{name:"email",label:"Email",pattern:"(?i)[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}",mode:"pseudonymize",prefix:"EMAIL"},{name:"fqdn",label:"FQDN",pattern:"(?i)\\b(?:[A-Z0-9-]+\\.)+[A-Z]{2,}\\b",mode:"pseudonymize",prefix:"FQDN"},{name:"contract_number",label:"Contract No.",pattern:"\\b[A-Z]{2,4}-\\d{4,}\\b",mode:"pseudonymize",prefix:"CONTRACT"},{name:"phone_jp",label:"電話番号・日本",pattern:"(?<![\\d:])(?:\\(0\\d{1,4}\\)[\\s-]?\\d{2,4}[\\s-]?\\d{4}|0\\d{1,4}\\(\\d{2,4}\\)\\d{4}|0\\d{1,4}[\\s-]?\\d{2,4}[\\s-]?\\d{4}|(?:0120|0800|0570)[\\s-]?\\d{3}[\\s-]?\\d{3})(?![\\d:])",mode:"pseudonymize",prefix:"PHONEJP"},{name:"phone_intl",label:"電話番号・国番号形式",pattern:"(?<![\\d:])\\+\\d{1,3}(?:[\\s-]?\\(0\\))?(?:[\\s-]?\\d){9,14}(?![\\d:])",mode:"pseudonymize",prefix:"PHONEINTL"},{name:"azure_subscription_id",label:"Azure Subscription ID",pattern:"\\b[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\\b",mode:"pseudonymize",prefix:"AZURE"},{name:"jwt_token",label:"JWT",pattern:"eyJ[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+",mode:"pseudonymize",prefix:"JWT"},{name:"api_key",label:"API Key",pattern:"\\b[A-Za-z0-9_-]{32,}\\b",mode:"pseudonymize",prefix:"API"},{name:"gcp_project_id",label:"GCP Project ID",pattern:"\\b[a-z][a-z0-9-]{4,28}[a-z0-9]\\b",mode:"pseudonymize",prefix:"GCP"},{name:"postal_code_jp",label:"郵便番号",pattern:"\\b\\d{3}-?\\d{4}\\b",mode:"pseudonymize",prefix:"ZIP"},{name:"aws_account_id",label:"AWS Account ID",pattern:"\\b\\d{12}\\b",mode:"pseudonymize",prefix:"AWS"}];function w(e,t){n.ruleList.innerHTML="";const r=document.createDocumentFragment();h.rules.forEach((a,s)=>{const o=document.createElement("label");o.className="rule-item",o.draggable=!0,o.dataset.index=String(s);const i=document.createElement("span");i.className="rule-handle",i.textContent="⋮⋮";const c=document.createElement("input");c.type="checkbox",c.checked=a.enabled,c.addEventListener("change",()=>{h.rules[s].enabled=c.checked,x(e),t&&t()});const l=document.createElement("strong");l.className="rule-label",l.textContent=a.label;const u=document.createElement("span");u.className="rule-example";const d=wt[a.name]||"";d&&(u.textContent=` (ex. ${d})`),o.appendChild(i),o.appendChild(c),o.appendChild(l),d&&o.appendChild(u),r.appendChild(o)}),n.ruleList.appendChild(r),At(e,t)}function At(e,t){const r=Array.from(n.ruleList.querySelectorAll(".rule-item"));if(r.length===0)return;let a=null,s=null,o=null,i=!0;const c=()=>s||(s=document.createElement("div"),s.className="rule-placeholder",s),l=()=>{s&&s.parentNode&&s.parentNode.removeChild(s),s=null},u=()=>{r.forEach(d=>{d.classList.remove("drop-target","drop-before","drop-after")})};r.forEach(d=>{d.addEventListener("dragstart",m=>{a=Number(d.dataset.index),d.classList.add("dragging"),m.dataTransfer.effectAllowed="move"}),d.addEventListener("dragend",()=>{d.classList.remove("dragging"),d.classList.remove("drop-target","drop-before","drop-after"),l(),a=null,o=null}),d.addEventListener("dragover",m=>{m.preventDefault(),m.dataTransfer.dropEffect="move",u();const p=d.getBoundingClientRect(),S=m.clientY<p.top+p.height/2;d.classList.add("drop-target"),d.classList.add(S?"drop-before":"drop-after");const D=Number(d.dataset.index),y=c();S?d.parentNode.insertBefore(y,d):d.parentNode.insertBefore(y,d.nextSibling),o=D,i=S}),d.addEventListener("dragleave",()=>{d.classList.remove("drop-target","drop-before","drop-after")}),d.addEventListener("drop",m=>{m.preventDefault(),d.classList.remove("drop-target","drop-before","drop-after");const p=Number(d.dataset.index);if(Number.isNaN(a)||Number.isNaN(p)||a===p){l();return}const S=o===p?i:!0,[D]=h.rules.splice(a,1);let y=p;a<p?y=S?p-1:p:y=S?p:p+1,h.rules.splice(y,0,D),l(),x(e),w(e,t),t&&t()})}),n.ruleList.addEventListener("dragover",d=>{d.preventDefault()}),n.ruleList.addEventListener("drop",d=>{if(d.preventDefault(),Number.isNaN(a)||a===null){l();return}if(o===null||Number.isNaN(o)){l();return}const[m]=h.rules.splice(a,1);let p=o;a<o?p=i?o-1:o:p=i?o:o+1,h.rules.splice(p,0,m),l(),x(e),w(e,t),t&&t()})}function It(e,t){const r=h.rules.some(a=>!a.enabled);h.rules=h.rules.map(a=>({...a,enabled:r})),w(e,t),x(e)}function _t(e,t){h.rules=N.map(r=>{const a=h.rules.find(s=>s.name===r.name);return{...r,enabled:a?a.enabled:!0}}),x(e),w(e,t)}function ce(){const e="abcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let r=0;r<ot;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}function Me(){const e=Number.parseInt(n.numberWidth.value,10);return Number.isFinite(e)?e:3}function Lt(e){const t=ce();se(t),e&&e()}function ve(){!n.regenSessionId||!n.useRandomSessionId||(n.regenSessionId.disabled=!n.useRandomSessionId.checked)}const $e=window.MaskingEngine;if(!$e)throw new Error("masking-engine.js is not loaded.");const{normalizeRegexPattern:Rt,escapeRegExp:Pt}=$e;function g(){return n.dictRows?Array.from(n.dictRows.querySelectorAll(".dict-row")).map(e=>{var t,r,a,s,o,i;return{enabled:((t=e.querySelector(".dict-enabled"))==null?void 0:t.checked)??!0,prefix:((a=(r=e.querySelector(".dict-prefix"))==null?void 0:r.value)==null?void 0:a.trim())||"",pattern:((o=(s=e.querySelector(".dict-pattern"))==null?void 0:s.value)==null?void 0:o.trim())||"",regex:((i=e.querySelector(".dict-regex"))==null?void 0:i.checked)??!1}}):[]}function Bt(){var r;const t=(((r=n.dictDefaultPrefix)==null?void 0:r.value)||"DICT").trim();return t?t.toUpperCase():"DICT"}function Ct(e){try{const t=Rt(e);return new RegExp(t.value,t.flags),{valid:!0}}catch(t){return{valid:!1,error:t.message}}}function Ft(){const e=g(),t=[];me("");const r=Bt();let a=!1;return e.forEach((s,o)=>{if(!s.enabled||!s.pattern)return;if(s.regex&&!Ct(s.pattern).valid){me(`辞書の正規表現が不正です。(行 ${o+1})`),a=!0;return}const i=s.regex?s.pattern:Pt(s.pattern);t.push({name:`dictionary_${o}`,label:"辞書",pattern:i,isDictionary:!0,prefix:(s.prefix||r).toUpperCase()})}),a?null:t}function ze(e={},t){const r=document.createElement("div");r.className="dict-row";const a=document.createElement("input");a.type="checkbox",a.className="dict-enabled",a.checked=e.enabled??!0;const s=document.createElement("input");s.type="text",s.className="dict-prefix",s.placeholder="例: NAME",s.value=e.prefix||"";const o=document.createElement("input");o.type="text",o.className="dict-pattern",o.placeholder="例: さくら情報システム / \\d{12}",o.value=e.pattern||"";const i=document.createElement("label");i.className="toggle";const c=document.createElement("input");c.type="checkbox",c.className="dict-regex",c.checked=e.regex??!1,i.appendChild(c);const l=document.createElement("button");l.type="button",l.className="ghost small dict-remove",l.textContent="削除",l.addEventListener("click",()=>{r.remove(),x(g)});const u=(d,m="input")=>{d.addEventListener(m,()=>{x(g),t&&t()})};return u(a,"change"),u(s),u(o),u(c,"change"),r.appendChild(a),r.appendChild(s),r.appendChild(o),r.appendChild(i),r.appendChild(l),r}function J(e=[],t){if(!n.dictRows)return;n.dictRows.innerHTML="";const r=document.createDocumentFragment();(e.length?e:[{enabled:!0,prefix:"",pattern:"",regex:!1}]).forEach(s=>{r.appendChild(ze(s,t))}),n.dictRows.appendChild(r)}function Nt(e={},t){n.dictRows&&(n.dictRows.appendChild(ze(e,t)),x(g))}function Ot(e,t,r,a){if(!window.confirm(`・基本設定の各項目が、正規表現として任意辞書の末尾にコピーされます。
・基本設定の各項目がオフになります。
・転記前の設定が以下の名前でマイ設定に保存されます。
　　転記前バックアップ_YYYYmmdd-HHMM
・以上、よろしければ「OK」を押してください。`))return;Ut(r,a);const o=h.rules.map(c=>({enabled:c.enabled,prefix:c.prefix||"",pattern:c.pattern||"",regex:!0})),i=g();J([...i,...o],t),h.rules=h.rules.map(c=>({...c,enabled:!1})),e&&e(g,t),x(g),f("基本設定を辞書へ転記しました。")}function Ut(e,t){const r=t(g),a=jt(new Date),s=`${it}_${a}`;e&&e(s,r)}function jt(e){const t=c=>String(c).padStart(2,"0"),r=e.getFullYear(),a=t(e.getMonth()+1),s=t(e.getDate()),o=t(e.getHours()),i=t(e.getMinutes());return`${r}${a}${s}-${o}${i}`}const Mt=1e4;async function Te(e,t){const r=new AbortController,a=setTimeout(()=>r.abort(),t);try{const s=await fetch(e,{signal:r.signal});if(!s.ok)throw new Error(`HTTP ${s.status}`);return await s.json()}finally{clearTimeout(a)}}async function $t(e,t){if(typeof ReadableStream>"u"||typeof TextDecoder>"u")return Te(e,t);const r=new AbortController,a=await fetch(e,{signal:r.signal});if(!a.ok)throw new Error(`HTTP ${a.status}`);if(!a.body||typeof a.body.getReader!="function")return Te(e,t);const s=a.body.getReader(),o=[];let i=0,c=null;const l=()=>{c&&clearTimeout(c),c=setTimeout(()=>r.abort(),t)};l();try{for(;;){const{done:p,value:S}=await s.read();if(p)break;S&&(o.push(S),i+=S.length),l()}}finally{c&&clearTimeout(c)}const u=new Uint8Array(i);let d=0;for(const p of o)u.set(p,d),d+=p.length;const m=new TextDecoder("utf-8").decode(u);return JSON.parse(m)}const Je=window.MaskingEngine;if(!Je)throw new Error("masking-engine.js is not loaded.");const{escapeRegExp:zt}=Je;function k(){return Array.isArray(z)&&z.length?z:Ne}function He(e){try{const t=localStorage.getItem(Ce);if(!t)return new Set(e);const r=JSON.parse(t);if(!Array.isArray(r)||r.length===0)return new Set(e);const a=new Set(e),s=r.filter(o=>a.has(o));return s.length?new Set(s):new Set(e)}catch{return new Set(e)}}function de(e){try{localStorage.setItem(Ce,JSON.stringify(e))}catch{}}function O(e){if(!b)M(He(e));else{const t=new Set(e),r=Array.from(b).filter(a=>t.has(a));M(r.length?new Set(r):new Set(e))}de(Array.from(b)),le()}function le(){if(!n.addressPrefectureList)return;const e=k();b||M(He(e)),n.addressPrefectureList.innerHTML="";const t=document.createDocumentFragment();e.forEach(r=>{const a=document.createElement("label");a.className="pref-option";const s=document.createElement("input");s.type="checkbox",s.value=r,s.checked=b.has(r),s.dataset.prefecture=r;const o=document.createElement("span");o.textContent=r,a.appendChild(s),a.appendChild(o),t.appendChild(a)}),n.addressPrefectureList.appendChild(t)}function Jt(e,t,r){b||M(new Set(k())),t?b.add(e):b.delete(e),de(Array.from(b)),A(r)}function we(e,t){const r=k();M(e?new Set(r):new Set),de(Array.from(b)),le(),A(t)}function Ht(e){for(const t of ct)if(e.startsWith(t))return t;return null}function H(e){const t=new Map;e.forEach(r=>{const a=Ht(r);a&&(t.has(a)||t.set(a,[]),t.get(a).push(r))}),Ue(t)}function Wt(e){const t=[];return e.forEach(r=>{const a=Oe.get(r);a&&t.push(...a)}),t}function Vt(e){if(!V)return[];const t=[];return e.forEach(r=>{const a=V[r];a&&t.push(...a)}),t}function Zt(e){if(!Array.isArray(e)||e.length===0)return[];const t=e.map(a=>zt(a)),r=[];for(let a=0;a<t.length;a+=he)r.push(t.slice(a,a+he).join("|"));return r}function A(e){var s;const t=b??new Set(k()),r=Wt(t),a=Vt(t);lt([...r,...a]),ut(Zt(ne)),ue(),(s=n.useAddressDict)!=null&&s.checked&&e&&e()}async function We(){const e=Gt();if(e){F(e.patterns),H(I),W(e),O(k()),A();return}n.addressDictVersion&&(n.addressDictVersion.textContent="読み込み中...");try{G||ye(fetch(rt).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}));const t=await G;if(!t||!Array.isArray(t.patterns))throw new Error("invalid address dict");F(t.patterns),H(I),W({version:t.version||"unknown",updated:t.updated||"-",count:Number.isFinite(t.count)?t.count:I.length,source:"local"}),O(k()),A()}catch(t){console.warn("Failed to load address dictionary from JSON:",t),ye(null);try{const r=await Yt();F(r.patterns),H(I),W({version:r.version||"unknown",updated:r.updated||"-",count:Number.isFinite(r.count)?r.count:I.length,source:"local"}),O(k()),A()}catch(r){console.error("Failed to load address dictionary (all methods):",r),n.addressDictVersion.textContent="エラー",n.addressDictSource.textContent="データが見つかりません",F([]),Ue(new Map),A()}}}async function Kt(){if(n.addressTownDictStatus){n.addressTownDictStatus.textContent="読み込み中...";try{Q||Se(fetch(at).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}));const e=await Q;if(!e||typeof e!="object")throw new Error("invalid town dict");pt(e.patternsByPrefecture||{}),mt(Array.isArray(e.prefectures)?e.prefectures:null);const t=Number.isFinite(e.totalCount)?e.totalCount:Object.values(V).reduce((r,a)=>r+(Array.isArray(a)?a.length:0),0);n.addressTownDictStatus.textContent=`読み込み済み (${t.toLocaleString()}件)`,O(k()),A()}catch(e){console.warn("Failed to load town address dictionary:",e),Se(null),n.addressTownDictStatus.textContent="読み込み失敗"}}}function Yt(){return typeof ADDRESS_PATTERNS<"u"&&Array.isArray(ADDRESS_PATTERNS)?Promise.resolve({version:ADDRESS_DICT_VERSION,updated:ADDRESS_DICT_UPDATED,count:ADDRESS_DICT_COUNT,patterns:ADDRESS_PATTERNS}):new Promise((e,t)=>{const r=document.createElement("script");r.src="address-dict.js",r.onload=()=>{typeof ADDRESS_PATTERNS<"u"&&Array.isArray(ADDRESS_PATTERNS)?e({version:ADDRESS_DICT_VERSION,updated:ADDRESS_DICT_UPDATED,count:ADDRESS_DICT_COUNT,patterns:ADDRESS_PATTERNS}):t(new Error("address dict missing"))},r.onerror=()=>t(new Error("address dict load failed")),document.head.appendChild(r)})}function Gt(){try{const e=localStorage.getItem(te);if(!e)return null;const t=JSON.parse(e);return!t||!Array.isArray(t.patterns)?null:{version:t.version||"unknown",updated:t.updated||"-",count:t.patterns.length,source:"custom",patterns:t.patterns}}catch{return null}}function W(e){e&&(n.addressDictVersion.textContent=Qt(e.version),n.addressDictCount.textContent=e.count.toLocaleString(),n.addressDictUpdated.textContent=e.updated,e.source==="custom"?n.addressDictSource.textContent="オンライン更新":n.addressDictSource.textContent="ローカル同梱",ue())}function Qt(e){if(!e||e==="unknown")return"-";const t=e.match(/^(\d{4})-(\d{2})$/);return t?`${t[1]}年${parseInt(t[2],10)}月版`:e}function ue(e){var c;if(!n.addressSearchResults)return;const t=ne;if(!t){n.addressSearchResults.textContent="辞書を読み込み中...";return}const a=(((c=n.addressSearchInput)==null?void 0:c.value)??"").trim();if(!a){n.addressSearchResults.textContent="検索結果はここに表示されます。";return}const s=t.filter(l=>l.includes(a)),o=s.slice(0,xe);if(o.length===0){n.addressSearchResults.textContent="一致する住所がありません。";return}const i=s.length>xe?`
...`:"";n.addressSearchResults.textContent=o.join(`
`)+i}async function qt(){n.updateAddressDict.disabled=!0,n.updateAddressDict.textContent="更新中...";try{const e=await $t(st,Mt),t=Xt(e),r=new Date,a=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,s=r.toISOString().split("T")[0],o={version:a,updated:s,patterns:t,source:"geolonia"};localStorage.setItem(te,JSON.stringify(o)),F(t),H(I),W({version:a,updated:s,count:t.length,source:"custom"}),O(k()),A(),f("住所辞書を更新しました。")}catch(e){f("住所辞書の更新に失敗しました。",!0),console.error("Address dict update failed:",e)}finally{n.updateAddressDict.disabled=!1,n.updateAddressDict.textContent="更新"}}function Xt(e){const t=[];for(const[r,a]of Object.entries(e))a.forEach(s=>{t.push(`${r}${s}`)});return t}function en(e){if(window.confirm(`住所辞書をローカル同梱版に戻しますか？
オンラインで更新した辞書データは削除されます。`))try{localStorage.removeItem(te),We(),f("住所辞書を初期版に戻しました。"),e&&e()}catch{f("住所辞書のリセットに失敗しました。",!0)}}function tn(){if(!n.useAddressDict.checked)return[];const e=[];return U.length&&U.forEach(t=>{e.push({name:"address_prefecture_city",label:"住所・地域",pattern:t,mode:"pseudonymize",prefix:"ADDRESS"})}),e}function $(){try{const e=localStorage.getItem(Be);if(!e)return[];const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch(e){return console.warn("Failed to load presets from localStorage:",e),[]}}function pe(e){try{localStorage.setItem(Be,JSON.stringify(e))}catch(t){console.warn("Failed to save presets to localStorage:",t)}}function Z(){const e=$();n.presetSelect.innerHTML="";const t=document.createElement("option");t.value="",t.textContent="保存した設定を選択",n.presetSelect.appendChild(t),e.forEach(r=>{const a=document.createElement("option");a.value=r.name,a.textContent=r.name,n.presetSelect.appendChild(a)})}function nn(e){const t=n.presetName.value.trim();if(!t){P("設定名を入力してください。",!0);return}const r=$(),a=r.find(s=>s.name===t);if(a){if(!window.confirm("同名の設定を上書きしますか？"))return;a.payload=X(e),a.updatedAt=new Date().toISOString()}else r.push({name:t,payload:X(e),updatedAt:new Date().toISOString()});pe(r),Z(),n.presetSelect.value=t,P("")}function rn(e,t){const r=$();r.push({name:e,payload:t,updatedAt:new Date().toISOString()}),pe(r),Z()}function an(e,t,r,a,s){const o=n.presetSelect.value;if(!o){P("保存した設定を選択してください。",!0);return}const c=$().find(u=>u.name===o);if(!c)return;const l=ae(c.payload,e);l.dictRowsData&&r&&r(l.dictRowsData,s),l.needsRulesRender&&t&&t(a,s),x(a),P("")}function sn(){const e=n.presetSelect.value;if(!e){P("削除する設定を選択してください。",!0);return}if(!window.confirm(`設定「${e}」を削除しますか？`))return;const r=$().filter(a=>a.name!==e);pe(r),Z(),P("")}function on(){const e=n.presetName.value.trim()||n.presetSelect.value.trim();return e||null}const cn="(?:[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目s*[0-9０-９一二三四五六七八九十百千〇零]{1,3}番s*[0-9０-９一二三四五六七八九十百千〇零]{1,3}号?|[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目s*[0-9０-９一二三四五六七八九十百千〇零]{1,3}(?:番|号)|[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目|[東西南北]?[0-9０-９一二三四五六七八九十百千〇零]{1,3}条[東西南北]?[0-9０-９一二三四五六七八九十百千〇零]{1,3}丁目?|[0-9０-９一二三四五六七八九十百千〇零]{1,3}(?:[-‐ー－]|の)[0-9０-９一二三四五六七八九十百千〇零]{1,3}(?:(?:[-‐ー－]|の)[0-9０-９一二三四五六七八九十百千〇零]{1,3})?)(?![0-9０-９])",Ve=window.MaskingEngine;if(!Ve)throw new Error("masking-engine.js is not loaded.");const{buildRuleRegex:dn,PlaceholderMap:Ze,computeDictionarySignature:Ae}=Ve;function R(e,t,r,a){if(!t.pattern)return e;const s=Me(),o=t._compiledRegex||(t._compiledRegex=dn(t));let i=0;const c=e.replace(o,l=>(i+=1,r.get(t.name,l,t.prefix,s)));return i&&(a[t.name]=(a[t.name]||0)+i),c}function Ke(e,t,r){if(!U.length)return e;const a=Me(),s=new RegExp(cn,"g"),o=U.map(d=>new RegExp(d)),i=/\{\{[^}]*:ADDRESS:\d+\}\}/,c=e.split(/\r?\n/);let l=!1;const u=c.map(d=>{if(!d.includes("所在地")&&!d.includes("所在地：")&&!d.includes("所在地:")||!(i.test(d)||o.some(y=>y.test(d))))return d;let p=0;const D=d.replace(s,y=>(p+=1,t.get("address_block",y,"ADDRESS_BLOCK",a))).replace(/(\{\{[^}]*:ZIP:\d+\}\})\s+(?=\{\{[^}]*:ADDRESS:\d+\}\})/g,"$1").replace(/(\{\{[^}]*:ADDRESS:\d+\}\})([^\s\{]{1,30})(\{\{[^}]*:ADDRESS_BLOCK:\d+\}\})/g,(y,Qe,qe,Xe)=>{const et=t.get("address_mid",qe,"ADDRESS_MID",a);return r.address_mid=(r.address_mid||0)+1,`${Qe}${et}${Xe}`});return p&&(r.address_block=(r.address_block||0)+p,l=!0),D});return l?u.join(`
`):e}function Ye(e){const t=[];h.rules.filter(s=>e[s.name]).forEach(s=>{t.push(`${s.label}: ${e[s.name]}`)});for(const[s,o]of Object.entries(e))if(!h.rules.some(c=>c.name===s)){let c=s;s.startsWith("dictionary_")?c="辞書":s.startsWith("address_")&&(c="住所"),t.push(`${c}: ${o}`)}const r=Object.values(e).reduce((s,o)=>s+o,0),a=t.length?t.join(" / "):"なし";f(`総マスク数: ${r} （内訳: ${a}）`)}async function Ge(e){if(!Ae||!e)return;const t=await Ae(e);t&&(e.signature=t,C(e),L(e),typeof window.updateUnmaskDictStatus=="function"&&window.updateUnmaskDictStatus(e))}function ln(e,t,r){var c;j||se(ce());const a=((c=n.useRandomSessionId)==null?void 0:c.checked)??!0,s=new Ze(j,a),o={};let i=e;try{const l=t();if(l===null)return!1;l.forEach(m=>{i=R(i,m,s,o)}),r().forEach(m=>{i=R(i,m,s,o)}),i=Ke(i,s,o),h.rules.forEach(m=>{m.enabled&&(i=R(i,m,s,o))}),n.outputText.value=i,Ye(o);const d=s.getDictionary();return C(d),L(d),typeof window.updateUnmaskDictStatus=="function"&&window.updateUnmaskDictStatus(d),Ge(d),!0}catch{return f("正規表現の形式が不正です。",!0),!1}}async function un(e,t,r,a){var m;const s=e.length>Fe,o=()=>new Promise(p=>setTimeout(p,0)),i=()=>t===q;j||se(ce());const c=((m=n.useRandomSessionId)==null?void 0:m.checked)??!0,l=new Ze(j,c),u={};let d=e;try{const p=r();if(p===null)return;for(const y of p)if(d=R(d,y,l,u),s&&(await o(),!i()))return;const S=a();for(const y of S)if(d=R(d,y,l,u),s&&(await o(),!i()))return;d=Ke(d,l,u);for(const y of h.rules)if(y.enabled&&(d=R(d,y,l,u),s&&(await o(),!i())))return;if(!i())return;n.outputText.value=d,Ye(u);const D=l.getDictionary();C(D),L(D),typeof window.updateUnmaskDictStatus=="function"&&window.updateUnmaskDictStatus(D),Ge(D)}catch{f("正規表現の形式が不正です。",!0)}}function Ie(e,t){const r=n.inputText.value||"",a=ft();if(!r.trim()){n.outputText.value="",f("入力テキストが空です。"),C(null),L(null),typeof window.updateUnmaskDictStatus=="function"&&window.updateUnmaskDictStatus(null);return}if(r.length>Fe){f("マスク処理中..."),un(r,a,e,t);return}ln(r,e,t)}function E(){}function pn(){n.inputText.value="",n.outputText.value="",n.sampleSelect&&(n.sampleSelect.value=""),f(""),x(g),C(null),L(null),_(null)}function mn(){if(!n.inputText||!n.outputText)return;let e=!1;const t=(r,a)=>{e||(e=!0,a.style.height=`${r.offsetHeight}px`,e=!1)};if(typeof ResizeObserver<"u"){const r=new ResizeObserver(a=>{a.forEach(s=>{s.target===n.inputText?t(n.inputText,n.outputText):s.target===n.outputText&&t(n.outputText,n.inputText)})});r.observe(n.inputText),r.observe(n.outputText)}else n.inputText.addEventListener("mouseup",()=>t(n.inputText,n.outputText)),n.outputText.addEventListener("mouseup",()=>t(n.outputText,n.inputText)),n.inputText.addEventListener("touchend",()=>t(n.inputText,n.outputText)),n.outputText.addEventListener("touchend",()=>t(n.outputText,n.inputText))}function fn(){if(!n.inputText||!n.outputText)return;let e=!1;const t=(r,a)=>{e||(e=!0,a.scrollTop=r.scrollTop,a.scrollLeft=r.scrollLeft,e=!1)};n.inputText.addEventListener("scroll",()=>t(n.inputText,n.outputText)),n.outputText.addEventListener("scroll",()=>t(n.outputText,n.inputText))}function gn(){n.tabs.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;n.tabs.forEach(r=>{r.classList.toggle("is-active",r===e),r.setAttribute("aria-selected",r===e?"true":"false")}),n.tabPanels.forEach(r=>{r.classList.toggle("is-active",r.dataset.tabPanel===t)}),n.appStats&&n.appStats.classList.toggle("is-hidden",t!=="work"),t!=="work"&&f("")})})}function _e(e){!n.presetDock||!n.presetToggle||!n.presetPanel||(n.presetDock.classList.toggle("is-open",!!e),n.presetToggle.setAttribute("aria-expanded",e?"true":"false"),n.presetPanel.setAttribute("aria-hidden",e?"false":"true"))}function Le(){nt(),Object.defineProperty(window,"currentMaskDictionary",{get:()=>v,set:r=>C(r)}),Object.defineProperty(window,"currentUnmaskDictionary",{get:()=>B,set:r=>L(r)}),window.updateUnmaskDictStatus=_,h.rules=N.map(r=>({...r,enabled:!0}));const{dictRowsData:e,needsRulesRender:t}=dt(N);n.dictRows&&n.dictRows.children.length===0&&J(e||[],E),w(g,E),Z(),le(),We(),Kt(),n.maskForwardBtn&&n.maskForwardBtn.addEventListener("click",()=>Ie(Ft,tn)),n.unmaskBackwardBtn&&n.unmaskBackwardBtn.addEventListener("click",()=>{ie(B)}),n.copyBtn&&n.copyBtn.addEventListener("click",Dt),n.clearBtn&&n.clearBtn.addEventListener("click",pn),mn(),fn(),n.sampleSelect&&n.sampleSelect.addEventListener("change",()=>{const r=n.sampleSelect.value;r&&ke[r]&&(n.inputText.value=ke[r],x(g))}),n.presetSave.addEventListener("click",()=>nn(g)),n.presetLoad.addEventListener("click",()=>an(N,w,J,g,E)),n.presetDelete.addEventListener("click",sn),n.presetExport.addEventListener("click",()=>Et(on,g)),n.presetImport.addEventListener("click",()=>n.presetImportFile.click()),n.presetImportFile.addEventListener("change",()=>{var r;bt((r=n.presetImportFile.files)==null?void 0:r[0],N,w,J,g,E)}),n.presetSelect.addEventListener("change",()=>{n.presetName.value=n.presetSelect.value}),n.inputText.addEventListener("input",()=>{x(g)}),n.numberWidth.addEventListener("change",()=>{x(g)}),n.useRandomSessionId&&n.useRandomSessionId.addEventListener("change",()=>{ve(),x(g)}),n.regenSessionId&&n.regenSessionId.addEventListener("click",()=>Lt(Ie)),n.saveMaskedTextBtn&&n.saveMaskedTextBtn.addEventListener("click",ht),n.savePlainTextBtn&&n.savePlainTextBtn.addEventListener("click",xt),n.plainTextUploadBtn&&n.plainTextFile&&(n.plainTextUploadBtn.addEventListener("click",()=>{n.plainTextFile.click()}),n.plainTextFile.addEventListener("change",()=>{var r;yt((r=n.plainTextFile.files)==null?void 0:r[0],g),n.plainTextFile.value=""})),n.dictAddRow&&n.dictAddRow.addEventListener("click",()=>{Nt({enabled:!0,prefix:"",pattern:"",regex:!1},E)}),n.dictImportBasic&&n.dictImportBasic.addEventListener("click",()=>Ot(w,E,rn,re)),n.dictDefaultPrefix.addEventListener("input",()=>{x(g)}),n.toggleAllBtn.addEventListener("click",()=>It(g,E)),n.resetOrderBtn.addEventListener("click",()=>_t(g,E)),n.useAddressDict&&n.useAddressDict.addEventListener("change",E),n.updateAddressDict&&n.updateAddressDict.addEventListener("click",()=>qt()),n.resetAddressDict&&n.resetAddressDict.addEventListener("click",()=>en(E)),n.addressSearchInput&&n.addressSearchInput.addEventListener("input",()=>{ue()}),n.addressPrefectureList&&n.addressPrefectureList.addEventListener("change",r=>{const a=r.target;a instanceof HTMLInputElement&&a.dataset.prefecture&&Jt(a.dataset.prefecture,a.checked,E)}),n.addressPrefAll&&n.addressPrefAll.addEventListener("click",()=>{we(!0,E)}),n.addressPrefNone&&n.addressPrefNone.addEventListener("click",()=>{we(!1,E)}),n.presetToggle&&n.presetToggle.addEventListener("click",()=>{var a;const r=(a=n.presetDock)==null?void 0:a.classList.contains("is-open");_e(!r)}),n.presetClose&&n.presetClose.addEventListener("click",()=>{_e(!1)}),x(g),gn(),ve(),Tt()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Le):Le();
//# sourceMappingURL=index-eY-9Bz-5.js.map
